<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[è®°å½•ä¸€æ¬¡æ‰“åŒ…å¤±è´¥é—®é¢˜å®šä½]]></title>
      <url>/chengasd.github.io/2019/01/20/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/</url>
      <content type="html"><![CDATA[<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/blog/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/unsplash-Steven%20Lewis.jpg" alt=""><br><a id="more"></a></p>
<h2 id="sales-system-backend-æ‰“åŒ…å¤±è´¥é—®é¢˜"><a href="#sales-system-backend-æ‰“åŒ…å¤±è´¥é—®é¢˜" class="headerlink" title="sales-system-backend æ‰“åŒ…å¤±è´¥é—®é¢˜"></a>sales-system-backend æ‰“åŒ…å¤±è´¥é—®é¢˜</h2><h3 id="å·¥ç¨‹æ¶‰åŠæŠ€æœ¯"><a href="#å·¥ç¨‹æ¶‰åŠæŠ€æœ¯" class="headerlink" title="å·¥ç¨‹æ¶‰åŠæŠ€æœ¯"></a>å·¥ç¨‹æ¶‰åŠæŠ€æœ¯</h3><p>gradleæ‰“åŒ…<br>groovy ç‰ˆæœ¬ï¼šgroovy-all:2.4.6<br>jdk ç‰ˆæœ¬ï¼š æœ¬åœ° 1.8.0_101-b13<br>          æµ‹è¯•ç¯å¢ƒ openjdk:8-jre</p>
<h3 id="ç°è±¡"><a href="#ç°è±¡" class="headerlink" title="ç°è±¡"></a>ç°è±¡</h3><p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/blog/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/1.jpg" alt=""><br>æœ¬åœ°è¿è¡Œç¯å¢ƒæ­£å¸¸ï¼Œæµ‹è¯•ç¯å¢ƒjenkinsä¸€ç›´å‘å¸ƒä¸æˆåŠŸï¼Œé”™è¯¯æç¤ºæ˜¯ä¸æ”¯æŒTYPE_USEï¼Œæœç´¢è¯¥æ–‡ä»¶ä»£ç ä¸­å¹¶æœªä½¿ç”¨åˆ°ã€‚<br>çœ‹ä¸Šæ¬¡æäº¤çš„ä»£ç å¹¶æ— é—®é¢˜ï¼Œä¹Ÿæœªæ¶‰åŠåˆ°MerchantAuditController.groovyæ–‡ä»¶çš„æ”¹åŠ¨ã€‚<br>å½“åˆå¶ç„¶å‡çº§äº†sales-system-service-apiçš„åŒ…å‘ç°å¯ä»¥è§£å†³é—®é¢˜ï¼Œä»¥ä¸ºæ˜¯æµ‹è¯•ç¯å¢ƒæ‹‰ä¸åˆ°æœ€æ–°çš„sales-<br>system-apiåŒ…è€Œå¯¼è‡´ï¼Œä¸Šçº¿å®Œåæ²¡å†è·Ÿè¿›ã€‚<br>å½“åˆä¸Šçº¿ä»£ç æ¯”è¾ƒï¼š<a href="https://git.wosai-inc.com/shouqianba/sales-system-backend/commit/e0eb37335403ecda775cfbb178aea87befa85e7e" target="_blank" rel="noopener">https://git.wosai-inc.com/shouqianba/sales-system-backend/commit/e0eb37335403ecda775cfbb178aea87befa85e7e</a></p>
<h3 id="æœ¬åœ°é—®é¢˜é‡ç°"><a href="#æœ¬åœ°é—®é¢˜é‡ç°" class="headerlink" title="æœ¬åœ°é—®é¢˜é‡ç°"></a>æœ¬åœ°é—®é¢˜é‡ç°</h3><p>ä»Šå¤©å› ä¸ºéœ€è¦å¼€å‘sales-system-backendé¡¹ç›®ï¼Œæ‹‰ä¸‹æœ€æ–°ä»£ç åï¼Œå‘ç°æœ¬åœ°ä¹Ÿå¯åŠ¨ä¸äº†äº†ï¼ŒæŠ¥é”™å’Œä¸Šæ¬¡jenkinsæ‰“åŒ…æŠ¥é”™æ˜¯ä¸€è‡´çš„ã€‚æŒ‰ç…§ä¸Šæ¬¡å‡çº§sales-system-serviceçš„è§£å†³æ–¹æ¡ˆä¹Ÿè§£å†³ä¸äº†é—®é¢˜ï¼Œå¯ä»¥æ¨æ–­ä¸Šæ¬¡çš„çŒœæƒ³æ˜¯é”™è¯¯çš„ã€‚<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/blog/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/2.jpg" alt=""></p>
<h3 id="é—®é¢˜å®šä½"><a href="#é—®é¢˜å®šä½" class="headerlink" title="é—®é¢˜å®šä½"></a>é—®é¢˜å®šä½</h3><p>ç¬¬ä¸€æ­¥ï¼šæ ¹æ®å…³é”®å­—TYPE_USEæœç´¢,hibernateè¯¥å·¥ç¨‹æœªä½¿ç”¨åˆ°ï¼Œæ‰€ä»¥å¯ä»¥æ’é™¤è¿™å‡ ä¸ªåŒ…ã€‚æœ€æœ‰å¯èƒ½çš„å°±æ˜¯ç¬¬ä¸€ä¸ªåŒ…ï¼ŒTYPE_USEæ˜¯1.8å¼•å…¥çš„æ–°æ³¨è§£ç±»å‹ã€‚<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/blog/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/3.jpg" alt=""></p>
<p>ç¬¬äºŒæ­¥ï¼šæŸ¥çœ‹MerchantAuditControlleræ˜¯å¦æœ‰åœ°æ–¹ç”¨åˆ°è¿™ä¸ªåŒ…ï¼Œå› ä¸ºæ˜¯æ³¨è§£ç›¸å…³çš„ï¼Œæ‰€ä»¥åªç”¨æŸ¥çœ‹ä»£ç ä¸­çš„æ‰€æœ‰æ³¨è§£ç±»ã€‚å…¶ä¸­å‘ç°submitæ–¹æ³•ä¸­æœ‰ä¸ªå‚æ•°æ ¡éªŒçš„æ³¨è§£Validä¼šç”¨åˆ°ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">@RedisLockAnnotation(lockKey = &quot;MerchantAuditController.submit&quot; , lockTime = 3000)</span><br><span class="line">    void submit(@PathVariable(&quot;id&quot;) String id, @RequestBody @Valid MerchantAuditSubmitRequest submitRequest) &#123;</span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Target(&#123; METHOD, FIELD, CONSTRUCTOR, PARAMETER, TYPE_USE &#125;)</span><br><span class="line">@Retention(RUNTIME)</span><br><span class="line">@Documented</span><br><span class="line">public @interface Valid &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æŸ¥çœ‹@Validçš„æºç ï¼Œå‘ç°å…¶æ˜¯validation-api:2.0.1.FinalåŒ…ä¸­çš„ä»£ç ã€‚<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/blog/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/4.jpg" alt=""></p>
<p>ç¬¬ä¸‰æ­¥ï¼šçŒœæƒ³å°è¯•é™çº§å¼•å…¥çš„validation-apiåŒ…ï¼Œå»é™¤1.8çš„ç‰¹æ€§ã€‚<br>åœ¨build.gradleä¸­æœªæ‰¾åˆ°æœ‰ç›´æ¥å¼•ç”¨çš„åœ°æ–¹ï¼Œåº”è¯¥æ˜¯å…¶å®ƒåŒ…å…³è”å¼•å…¥çš„ã€‚æŸ¥çœ‹gradleå¼•å…¥çš„ä¾èµ–å…³ç³»<br>ä¸‹é¢ä¾èµ–å…³ç³»çš„å·²ç»åˆ é™¤å¤§éƒ¨åˆ†ï¼Œå¯ä»¥å‘ç°å¼•ç”¨çš„validation-apiéƒ½æŒ‡å‘äº†2.0.1.Finalç‰ˆæœ¬ï¼Œè€Œå®ƒæ˜¯ç”±sales-system-service-apiåŒ…ä¸­çš„datum-hub-apiåŒ…å¼•å…¥ï¼Œå¯ä»¥å‘ç°datum-hubå·¥ç¨‹è¯¥åŒ…æ˜¯ç”¨çš„releaseç‰ˆæœ¬ã€‚</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">------------------------------------------------------------</span><br><span class="line">Project :sales-system-backend</span><br><span class="line">------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">archives - Configuration for archive artifacts.</span><br><span class="line">No dependencies</span><br><span class="line"></span><br><span class="line">asciidoctor</span><br><span class="line">+--- org.asciidoctor:asciidoctorj:1.5.3.2</span><br><span class="line">|    +--- org.jruby:jruby-complete:1.7.21</span><br><span class="line">|    \--- com.beust:jcommander:1.35</span><br><span class="line">\--- org.asciidoctor:asciidoctorj-groovy-dsl:1.0.0.preview2</span><br><span class="line">     +--- org.codehaus.groovy:groovy-all:1.8.9 -&gt; 2.4.9</span><br><span class="line">     \--- org.asciidoctor:asciidoctorj:1.5.1 -&gt; 1.5.3.2 (*)</span><br><span class="line"></span><br><span class="line">compile - Compile classpath for source set &apos;main&apos;.</span><br><span class="line">+--- project :sales-system-backend-api</span><br><span class="line">|    +--- com.github.briandilley.jsonrpc4j:jsonrpc4j:1.5.3 (*)</span><br><span class="line">|    +--- com.wosai.upay:upay-common:1.0.0-SNAPSHOT -&gt; 1.0.1-SNAPSHOT</span><br><span class="line">|    \--- org.projectlombok:lombok:1.16.16 -&gt; 1.16.14</span><br><span class="line">+--- org.springframework.boot:spring-boot-starter-web:1.4.5.RELEASE</span><br><span class="line">|    +--- org.hibernate:hibernate-validator:5.2.4.Final</span><br><span class="line">|    |    +--- javax.validation:validation-api:1.1.0.Final -&gt; 2.0.1.Final</span><br><span class="line">+--- com.wosai.sales:sales-system-service-api:0.5.10-SNAPSHOT</span><br><span class="line">|    +--- com.github.briandilley.jsonrpc4j:jsonrpc4j:1.5.3 (*)</span><br><span class="line">|    +--- com.wosai.upay:upay-common:1.0.0-SNAPSHOT -&gt; 1.0.1-SNAPSHOT</span><br><span class="line">|    +--- org.projectlombok:lombok:1.16.16 -&gt; 1.16.14</span><br><span class="line">|    \--- com.wosai.data:datum-hub-api:0.0.5-SNAPSHOT</span><br><span class="line">|         +--- javax.validation:validation-api:latest.release -&gt; 2.0.1.Final</span><br><span class="line">|         +--- org.apache.commons:commons-lang3:3.5</span><br><span class="line">|         +--- com.github.briandilley.jsonrpc4j:jsonrpc4j:1.5.3 (*)</span><br><span class="line">|         +--- com.wosai.upay:upay-common:1.0.1-SNAPSHOT</span><br><span class="line">|         +--- org.projectlombok:lombok:1.16.20 -&gt; 1.16.14</span><br><span class="line">|         \--- com.fasterxml.jackson.core:jackson-databind:2.8.9 -&gt; 2.8.7 (*)</span><br><span class="line">+--- com.wosai.sales:sales-system-push-api:0.0.1-SNAPSHOT</span><br><span class="line">|    +--- javax.validation:validation-api:1.1.0.Final -&gt; 2.0.1.Final</span><br><span class="line">|    +--- com.fasterxml.jackson.core:jackson-databind:2.8.9 -&gt; 2.8.7 (*)</span><br><span class="line">|    +--- com.github.briandilley.jsonrpc4j:jsonrpc4j:1.5.0 -&gt; 1.5.3 (*)</span><br><span class="line">|    +--- com.wosai.upay:upay-common:1.0.0-SNAPSHOT -&gt; 1.0.1-SNAPSHOT</span><br><span class="line">|    \--- org.projectlombok:lombok:1.16.12 -&gt; 1.16.14</span><br><span class="line">+--- com.wosai.loan:loan-proxy-api:1.0.2-SNAPSHOT</span><br><span class="line">|    +--- com.wosai.upay:upay-common:1.0.0-SNAPSHOT -&gt; 1.0.1-SNAPSHOT</span><br><span class="line">|    |    \--- org.slf4j:slf4j-api:1.7.21 -&gt; 1.7.24</span><br><span class="line">|    \--- javax.validation:validation-api:1.0.0.GA -&gt; 2.0.1.Final</span><br></pre></td></tr></table></figure>
<p>ç¬¬å››æ­¥ï¼šæ ¹æ®çŒœæƒ³æ‹‰datum-hubçš„ä»£ç åï¼Œç›´æ¥æ›´æ–°apiåŒ…å¼•ç”¨çš„validation-apiç‰ˆæœ¬å·åˆ°1.1.0.Finalã€‚<br>åˆ†åˆ«deploy datum-hubå·¥ç¨‹å’Œsales-system-serviceå·¥ç¨‹ã€‚ç„¶ååœ¨sales-system-backendå·¥ç¨‹é‡æ–°è½½å…¥sales-system-service-apiåŒ…ï¼Œæ­£å¸¸å¯åŠ¨å·¥ç¨‹<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/blog/%E8%AE%B0%E5%BD%95%E4%B8%80%E6%AC%A1%E6%89%93%E5%8C%85%E5%A4%B1%E8%B4%A5%E9%97%AE%E9%A2%98%E5%AE%9A%E4%BD%8D/5.jpg" alt=""></p>
<h3 id="é—®é¢˜è§£å†³"><a href="#é—®é¢˜è§£å†³" class="headerlink" title="é—®é¢˜è§£å†³"></a>é—®é¢˜è§£å†³</h3><p>æ ¹æ®ä¸Šé¢çš„å®šä½ç»“æœå¯ä»¥å¾—å‡ºsales-system-backendå¯åŠ¨ä¸äº†çš„æ ¹æœ¬åŸå› æ˜¯å› ä¸ºdatum-hubå¼•å…¥çš„validation-apiåŒ…ä¸­åŒ…å«äº†1.8çš„ç‰¹æ€§å¯¼è‡´groovyæ–‡ä»¶åˆå§‹åŒ–ä¸äº†æŠ¥é”™ã€‚æŸ¥çœ‹groovyç‰ˆæœ¬å·2.4.6å®é™…æ˜¯å·²ç»æ”¯æŒjava8äº†ã€‚ çŒœæƒ³ä¼šä¸ä¼šæ˜¯groovyè¯¥ç‰ˆæœ¬çš„ä¸€ä¸ªbugå¯¼è‡´çš„ã€‚<br>æœç„¶åœ¨apacheå®˜ç½‘ä¸Šæ‰¾åˆ°äº†å¯¹åº”çš„ä¿®å¤è®°å½•ã€‚ å¯¹åº”çš„ä¿®å¤ç‰ˆæœ¬å·æ˜¯2.5.0-beta-2<br><a href="https://issues.apache.org/jira/browse/GROOVY-8226" target="_blank" rel="noopener">å®˜ç½‘issuesè®°å½•</a></p>
<p>è§£å†³æ–¹æ¡ˆï¼š<br>1ã€å°è¯•å‡çº§sales-system-backendçš„groovyç‰ˆæœ¬åˆ°2.5.5ç¨³å®šç‰ˆæœ¬ï¼Œå‘ç°è¿˜ä¼šå¼•å…¥å…¶å®ƒgroovyé”™è¯¯ï¼Œå·²è§£å†³ã€‚å‚è€ƒ<a href="https://github.com/spring-projects/spring-boot/issues/13444" target="_blank" rel="noopener">https://github.com/spring-projects/spring-boot/issues/13444</a>           <a href="https://ofnir.net/posts/using-groovy-25-with-springboot.html" target="_blank" rel="noopener">https://ofnir.net/posts/using-groovy-25-with-springboot.html</a><br>springbootå¼•å…¥groovy 2.5ç‰ˆæœ¬åœ¨build.gradleçš„é¡¶éƒ¨éœ€è¦å®šä¹‰groovy.versionæ‰ä¼šå¼•å…¥<br>2ã€æš‚æ—¶é™çº§datum-hubä¸­çš„validation-apiç‰ˆæœ¬å·<br>å»ºè®®ä½¿ç”¨çš„ç¬¬ä¸‰æ–¹åŒ…æŒ‡å®šç‰ˆæœ¬å·ï¼Œé¿å…å†æ¬¡é‡åˆ°è¿™ç§å¼•ç”¨æœ€æ–°çš„åŒ…è€Œåº•å±‚ä¸æ”¯æŒå¯¼è‡´å·¥ç¨‹æ— æ³•å¯åŠ¨ã€‚</p>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> é—®é¢˜å®šä½ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ²¡æœ‰ç†¬ä¸è¿‡çš„é»‘å¤œï¼Œæ²¡æœ‰ç­‰ä¸æ¥çš„é»æ˜ï¼Œä½ å¥½2019ï¼]]></title>
      <url>/chengasd.github.io/2018/12/26/%E6%B2%A1%E6%9C%89%E7%86%AC%E4%B8%8D%E8%BF%87%E7%9A%84%E9%BB%91%E5%A4%9C%EF%BC%8C%E6%B2%A1%E6%9C%89%E7%AD%89%E4%B8%8D%E6%9D%A5%E7%9A%84%E9%BB%8E%E6%98%8E%EF%BC%8C%E4%BD%A0%E5%A5%BD2019%EF%BC%81/</url>
      <content type="html"><![CDATA[<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/blog/%E4%BD%A0%E5%A5%BD2019/calvin-chou-189026-unsplash.jpg" alt=""></p>
<h2 id="18å¹´æ€»ç»“"><a href="#18å¹´æ€»ç»“" class="headerlink" title="18å¹´æ€»ç»“"></a>18å¹´æ€»ç»“</h2><p>é©å‘½å°šæœªæˆåŠŸï¼ŒåŒå¿—ä»é¡»åŠªåŠ›ï¼Œæœªæ¥æŒ‡æ—¥å¯æœŸ<br><a id="more"></a></p>
<h3 id="è£¸è¾å›å®¶"><a href="#è£¸è¾å›å®¶" class="headerlink" title="è£¸è¾å›å®¶"></a>è£¸è¾å›å®¶</h3><p>18å¹´ä¸€è·¯åå·ï¼Œè‡ªå¹´åˆå°±æ‰“ç®—ä»åˆ†æœŸä¹è¾èŒã€‚<br>å…¶å®é™¤äº†å·¥ä½œå¿™ç‚¹ï¼Œé¢†å¯¼&amp;è€å¸æœºä»¬å¾…æˆ‘éƒ½å¾ˆå¥½ï¼Œ<br>åªä¸è¿‡å½“åˆå…¥èŒå’Œhråœ¨å¹´ç»ˆå¥–ä¸Šå‡ºäº†ç‚¹åå·®ï¼Œå¿ƒé‡Œæœ‰ç‚¹å¤±è½ï¼Œ<br>å†åŠ ä¸Šæ·±æ¼‚3å¹´ï¼Œè€äººä»¬ä¸€ä¸ªä¸ªç¦»å»ï¼Œèº«å¿ƒæœ‰ç‚¹ç–²æƒ«ã€‚<br>æ‰€ä»¥è¿˜æ˜¯å†³å®šåœ¨3æœˆåº•è£¸è¾å›äº†å®¶ã€‚ç¦»èŒæ‰‹ç»­åŠå®Œç¬¬äºŒå¤©å°±é£å›äº†æ— é”¡ã€‚</p>
<h3 id="æ‰¾å·¥ä½œ"><a href="#æ‰¾å·¥ä½œ" class="headerlink" title="æ‰¾å·¥ä½œ"></a>æ‰¾å·¥ä½œ</h3><p>4æœˆä¸Šæ—¬ä¸€è¾¹æ³¡åœ¨å¸‚å›¾ä¹¦é¦†ï¼Œä¸€è¾¹æŒ‚ç®€å†é¢è¯•ã€‚<br>è‡ªå·±å®šçš„ç›®æ ‡ï¼Œå…ˆåœ¨æ— é”¡ã€è‹å·æ‰¾ï¼Œæ‰¾ä¸åˆ°å†å»ä¸Šæµ·ï¼Œå†ç„¶åå»æ­å·ã€‚<br>å—äº¬å› ä¸º17å¹´å»è‹å®é¢è¿‡ï¼Œè–ªèµ„ç»™ä¸äº†å¤ªé«˜ï¼Œ<br>ç½‘ä¸Šè¯´å—äº¬è½¯ä»¶æ°›å›´ä¹Ÿä¸å¥½ï¼Œé‚ä»Šå¹´æ”¾å¼ƒå»å—äº¬æ‰¾äº†ï¼Œæœ‰ç‚¹åæ‚”ã€‚<br>è‹å·æŠ•äº†ä¸¤å®¶ï¼Œç¬¬ä¸€å®¶åšè¶³å½©ï¼Œå¬è¯´æ²¡è¿‡å‡ ä¸ªæœˆå°±è£å‘˜äº†ä¸€åŠï¼Œåº†å¹¸å½“åˆå¿ä½äº†æ²¡å»ã€‚<br>è¿›äº†ç°åœ¨ä¸€å®¶åšèšåˆæ”¯ä»˜çš„ã€‚<br>å½“åˆä¹ŸåŒæ—¶åœ¨é¢è¯•é˜¿é‡Œï¼Œå½“æ—¶è‡ªå·±å¿ƒé‡Œå®åœ¨æŠµè§¦åŠ ç­ï¼Œä¹Ÿå°±æ²¡å†ç»§ç»­é¢ä¸‹å»ã€‚<br>è¿˜æ˜¯è¦æ„Ÿè°¢é˜¿é‡Œçš„é¢è¯•å®˜ï¼Œç»™äº†å¾ˆå¤šæ„è§ï¼Œå®åŠ›æ˜¯çœŸçš„å¼ºã€‚<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/blog/%E4%BD%A0%E5%A5%BD2019/jared-erondu-21325-unsplash.jpg" alt=""></p>
<h3 id="ç°å·¥ä½œ"><a href="#ç°å·¥ä½œ" class="headerlink" title="ç°å·¥ä½œ"></a>ç°å·¥ä½œ</h3><p>ç°åœ¨åœ¨ä¸€å®¶èšåˆæ”¯ä»˜å…¬å¸åšå†…éƒ¨CRMï¼Œè°ˆä¸ä¸Šå¤šé«˜å¤§ä¸Šï¼Œ<br>ä½†ä¸ªäººæ—¶é—´çš„ç¡®å¤šäº†å¾ˆå¤šï¼Œå¯ä»¥è‡ªå·±å»äº†è§£å­¦ä¹ å¾ˆå¤šä¸œè¥¿ï¼Œ<br>ä»Dockerã€Pythonã€Nodeâ€¦ä¸€æ­¥ä¸€æ­¥æ‘¸ç´¢åˆ°ç•¥æ‡‚å†åˆ°ç†Ÿæ‚‰çš„è¿‡ç¨‹ï¼Œæ…¢æ…¢çš„ç§¯ç´¯ç»éªŒï¼Œ<br>è™½ç„¶æ¯”ä¸ä¸Šå»å¤§å…¬å¸ç§¯ç´¯ç»éªŒæ¥çš„å¿«ï¼Œä½†é€‚åˆè‡ªå·±çš„ç”Ÿæ´»æ‰æ˜¯æœ€å¥½çš„ã€‚<br>ä¸»è¦è°è®©æˆ‘æ‡’å‘¢ã€‚ğŸ˜„</p>
<h3 id="ç¬¬ä¸€è¾†è½¦"><a href="#ç¬¬ä¸€è¾†è½¦" class="headerlink" title="ç¬¬ä¸€è¾†è½¦"></a>ç¬¬ä¸€è¾†è½¦</h3><p>ä¹‹å‰æ²¡æ€ä¹ˆå…³æ³¨è¿‡è½¦ï¼Œç”±äºæ¯æ¬¡å›å®¶ä¸æ–¹ä¾¿ï¼Œ<br>æ‰€ä»¥10æœˆä»½å¼€å§‹æ‰“ç®—è´­ç½®è½¦è¾†ã€‚<br>è‡ªå·±æ¯”ä»·ä¿¡èµ–å“ç‰Œï¼Œæ‰€ä»¥ä¹Ÿæ²¡æ€ä¹ˆçœ‹ï¼Œå°±å†³å®šä¹°ä¸°ç”°çš„äº†ã€‚<br>ä¸€çœ‹æ˜¯æ˜¯æ‰“ç®—ä¹°å‡¯ç¾ç‘ï¼Œåæ¥å¿ƒé‡Œè·¯ç¨‹åˆå˜æˆäº†å¡ç½—æ‹‰åŒæ“ã€‚<br>æ¯•ç«Ÿè‡ªå·±å¯¹äºè±ªè½¦é¢å­è¿™ç§å¹¶ä¸æ„Ÿå†’ï¼Œè‡ªå·±å¼€å®ç”¨å°±è¡Œäº†ã€‚<br>å»4Såº—è®¢è½¦çš„æ—¶å€™ä¹Ÿå®åœ¨å†²åŠ¨ï¼Œåªæ¯”è¾ƒäº†ä¸¤å®¶ï¼Œ<br>è¿‡æ—©é€éœ²äº†è‡ªå·±çš„å¿ƒç†ä»·ä½ï¼Œå¯¼è‡´è¢«4Såº—é”€å”®å‘äº†ä¸€ç¬”ã€‚<br>å¿ƒæ€å´©äº†ä¸¤å¤©ï¼Œç°åœ¨æ€»ç®—ç¼“äº†è¿‡æ¥ã€‚<br>åæ¥è‡ªå·±åˆç®—äº†ç¬”è´¦ï¼Œå¼€è½¦çš„èŠ±é”€éƒ½å¤Ÿæ¯å¤©æ‰“è½¦æ¥å›ä¸Šä¸‹ç­äº†Orzã€‚<br>åœè½¦è´¹çœŸçš„æ˜¯è´µçš„ä¸€Bã€‚</p>
<h3 id="å¦ä¸€ä¼´"><a href="#å¦ä¸€ä¼´" class="headerlink" title="å¦ä¸€ä¼´"></a>å¦ä¸€ä¼´</h3><p>ä¾æ—§å¯»è§…ä¸­</p>
<h3 id="ä¹¦å•"><a href="#ä¹¦å•" class="headerlink" title="ä¹¦å•"></a>ä¹¦å•</h3><blockquote>
<p><strong>ã€Šå·¨äººçš„é™¨è½ã€‹ â™¥â™¥â™¥â™¥</strong><br>ä¸–çºªä¸‰éƒ¨æ›²ç¬¬ä¸€éƒ¨ï¼Œä¸»è¦è®²è¿°äº†ä¸€æˆ˜çš„å‰åï¼Œè‹±æ³•ä¿„å¾·äº”ä¸ªå®¶åº­å¤šä¸ªä»»åŠ¡äº¤ç»‡å†ä¸€èµ·ï¼Œå°±åƒä¹¦ä¸­å†™çš„ï¼Œä¸€æˆ˜æ‰“ç€æ‰“ç€ä¹Ÿè®¸äº¤æˆ˜åŒæ–¹éƒ½å¿˜äº†å‘åŠ¨æˆ˜äº‰çš„æ ¹æœ¬åŸå› ï¼Œåªæ˜¯è§‰å¾—åœ¨è¿™åœºæˆ˜äº‰ä¸‹å„è‡ªä¸èƒ½è®¤è¾“ã€‚å¯¹äºåˆ—å®æ˜¯å¦æ˜¯å¾·å›½é—´è°è¿™ä¸€äº‹ï¼Œè¿˜æ˜¯ä¿æŒæ€€ç–‘ã€‚<br><strong>ã€Šé˜¿å¼¥é™€ä½› ä¹ˆä¹ˆå“’ã€‹ â™¥â™¥â™¥</strong><br>å¹´åˆçœ‹çš„å¤§å†°ç¬¬äºŒæœ¬ä¹¦ï¼Œå¤§éƒ¨åˆ†å¿˜äº†ä¹¦ä¸­çš„äººç‰©å’Œæ•…äº‹ã€‚<br><strong>ã€ŠSpringæºç æ·±åº¦è§£æã€‹ â™¥â™¥â™¥</strong><br>4æœˆä»½æ±‚èŒæ—¶å€™çœ‹çš„ï¼Œå¯¹äºspringçš„åŸç†ä¹‹å‰ä¹Ÿçœ‹è¿‡å¾ˆå¤šåšå®¢ï¼Œèƒ½æ‡‚ä½†æ˜¯ä¸çŸ¥é“æ€ä¹ˆè·Ÿåˆ«äººè¡¨è¿°å‡ºæ¥ã€‚è¿™æœ¬ä¹¦è¿˜æ˜¯å¸®åŠ©å¾ˆå¤§ï¼Œå¯ä»¥å¾ˆæ¸…æ™°çš„äº†è§£springçš„åŸç†çŸ¥è¯†ã€‚<br><strong>ã€Šé¸Ÿå“¥çš„Linuxç§æˆ¿èœã€‹ â™¥â™¥â™¥â™¥â™¥</strong><br>ä¹‹å‰çœ‹ç€ä¹¦çš„åšåº¦ä¸€ç›´æŠµåˆ¶ç¿»çœ‹è¿™æœ¬ã€‚å·¥ä½œä¸­éœ€è¦æ¥è§¦Linuxå‘½ä»¤å°±ä¹°äº†è¿™æœ¬ä¹¦ï¼Œè¿˜æ­£åœ¨çœ‹ï¼Œæœ‰ç§ç›¸è§æ¨æ™šçš„æ„Ÿè§‰ã€‚<br><strong>ã€ŠSpring Bootå®æˆ˜ã€‹ â™¥â™¥â™¥</strong><br>å¹³æ—¶äº†è§£Spring Bootçš„åŠŸèƒ½çš„å·¥å…·ä¹¦ã€‚</p>
</blockquote>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/blog/%E4%BD%A0%E5%A5%BD2019/unsplash-Charles%20Forerunner.jpg" alt="é»æ˜"></p>
<h2 id="19å¹´å±•æœ›"><a href="#19å¹´å±•æœ›" class="headerlink" title="19å¹´å±•æœ›"></a>19å¹´å±•æœ›</h2><p>äººç”Ÿä¸‰é‡å¢ƒç•Œ:çœ‹å±±æ˜¯å±±ï¼Œçœ‹å±±ä¸æ˜¯å±±ï¼Œçœ‹å±±è¿˜æ˜¯å±±ã€‚<br>è®²è¿°äº†äººç”Ÿä»æ‡µæ‡‚åˆ°è¿·èŒ«å†åˆ°å¼€æ‚Ÿçš„è·¯ç¨‹ï¼Œè¶Šæ¥è¶Šè§‰å¾—ç¼ºå°‘å½“åˆçš„ç«¥çœŸæ°”æ¯ï¼Œå˜å¾—ä¹Ÿè¶Šæ¥è¶Šç°å®ã€‚åº”è¯¥æ˜¯æå‰è¿›å…¥äº†ç¬¬ä¸‰å¢ƒç•Œå§ã€‚</p>
<h3 id="è€å¹´äººçš„æ„¿æœ›"><a href="#è€å¹´äººçš„æ„¿æœ›" class="headerlink" title="è€å¹´äººçš„æ„¿æœ›"></a>è€å¹´äººçš„æ„¿æœ›</h3><ul>
<li style="list-style: none"><input type="checkbox"> äº²äºº&amp;è‡ªå·±éƒ½å¥å¥åº·åº· </li>
<li style="list-style: none"><input type="checkbox"> å†™ä¸€æœ¬gitbookè¯»ä¹¦ç¬”è®°&amp;åšå®¢æ¯æœˆæ›´æ–°ä¸€ç¯‡</li>
<li style="list-style: none"><input type="checkbox"> åšæŒæ¯å‘¨è¯»ä¹¦&amp;è¿åŠ¨çš„ä¹ æƒ¯</li>
<li style="list-style: none"><input type="checkbox"> å¯èƒ½çš„è¯(æˆ¿ä»·é™åˆ°åˆç†èŒƒå›´)è€ƒè™‘è´­ç½®æˆ¿å­</li>
<li style="list-style: none"><input type="checkbox"> å‘Šåˆ«å•èº«?!?!</li>
</ul>
]]></content>
      
        <categories>
            
            <category> ç”Ÿæ´» </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Btraceä½¿ç”¨]]></title>
      <url>/chengasd.github.io/2018/07/30/Btrace%E4%BD%BF%E7%94%A8/</url>
      <content type="html"><![CDATA[<h3 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h3><p>BTraceæ˜¯sunå…¬å¸æ¨å‡ºçš„ä¸€æ¬¾Java åŠ¨æ€ã€å®‰å…¨è¿½è¸ªï¼ˆç›‘æ§ï¼‰å·¥å…·ï¼Œå¯ä»¥åœ¨ä¸ç”¨é‡å¯çš„æƒ…å†µä¸‹ç›‘æ§ç³»ç»Ÿè¿è¡Œæƒ…å†µï¼Œæ–¹ä¾¿çš„è·å–ç¨‹åºè¿è¡Œæ—¶çš„æ•°æ®ä¿¡æ¯ï¼Œå¦‚æ–¹æ³•å‚æ•°ã€è¿”å›å€¼ã€å…¨å±€å˜é‡å’Œå †æ ˆä¿¡æ¯ç­‰ï¼Œå¹¶ä¸”åšåˆ°æœ€å°‘çš„ä¾µå…¥ï¼Œå ç”¨æœ€å°‘çš„ç³»ç»Ÿèµ„æºã€‚<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Btrace%E4%BD%BF%E7%94%A8/1.jpg" alt=""><br><a id="more"></a></p>
<p>ç”±äºBtraceä¼šæŠŠè„šæœ¬é€»è¾‘ç›´æ¥ä¾µå…¥åˆ°è¿è¡Œçš„ä»£ç ä¸­ï¼Œæ‰€ä»¥åœ¨ä½¿ç”¨ä¸Šåšå¾ˆå¤šé™åˆ¶ï¼š</p>
<ol>
<li>ä¸èƒ½åˆ›å»ºå¯¹è±¡</li>
<li>ä¸èƒ½åˆ›å»ºæ•°ç»„</li>
<li>ä¸èƒ½æŠ›å‡ºå’Œæ•è·å¼‚å¸¸</li>
<li>ä¸èƒ½è°ƒç”¨ä»»ä½•å¯¹è±¡æ–¹æ³•å’Œé™æ€æ–¹æ³•</li>
<li>ä¸èƒ½ç»™ç›®æ ‡ç¨‹åºä¸­çš„ç±»é™æ€å±æ€§å’Œå¯¹è±¡çš„å±æ€§è¿›è¡Œèµ‹å€¼</li>
<li>ä¸èƒ½æœ‰å¤–éƒ¨ã€å†…éƒ¨å’ŒåµŒå¥—ç±»</li>
<li>ä¸èƒ½æœ‰åŒæ­¥å—å’ŒåŒæ­¥æ–¹æ³•</li>
<li>ä¸èƒ½æœ‰å¾ªç¯(for, while, do..while)</li>
<li>ä¸èƒ½ç»§æ‰¿ä»»ä½•çš„ç±»</li>
<li>ä¸èƒ½å®ç°æ¥å£</li>
<li>ä¸èƒ½åŒ…å«assertæ–­è¨€è¯­å¥</li>
</ol>
<blockquote>
<p>æ ¹æ®å®˜æ–¹å£°æ˜ï¼Œä¸æ°å½“çš„ä½¿ç”¨BTraceå¯èƒ½å¯¼è‡´JVMå´©æºƒï¼Œå¦‚åœ¨BTraceè„šæœ¬ä½¿ç”¨é”™è¯¯çš„classæ–‡ä»¶ï¼Œæ‰€ä»¥åœ¨ä¸Šç”Ÿäº§ç¯å¢ƒä¹‹å‰ï¼ŒåŠ¡å¿…åœ¨æœ¬åœ°å……åˆ†çš„éªŒè¯è„šæœ¬çš„æ­£ç¡®æ€§!!</p>
</blockquote>
<h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><p>1ã€ä¸‹è½½<br>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/btraceio/btrace" target="_blank" rel="noopener">Btrace</a><br>2ã€è§£å‹ç¼©<br>3ã€è®¾ç½®ç¯å¢ƒå˜é‡</p>
<p>vim ~/.bash_profile</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">BTRACE_HOME=/Users/yinchengjian/local/btrace-bin-1.3.11</span><br><span class="line">export BTRACE_HOME</span><br><span class="line">export PATH=$PATH:$BTRACE_HOME/bin</span><br></pre></td></tr></table></figure>
<p>source ~/.bash_profile</p>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><p>1ã€jps ï¼šæŸ¥è¯¢å¯¹åº”javaåº”ç”¨pid<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Btrace%E4%BD%BF%E7%94%A8/2.jpg" alt=""></p>
<p>2ã€æ‰§è¡Œbtraceå‘½ä»¤  -v   ä»£è¡¨è¾“å‡ºdegugæ—¥å¿—</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Btrace -v -p 2021 43471  BtraceTest1.java</span><br></pre></td></tr></table></figure>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Btrace%E4%BD%BF%E7%94%A8/3.jpg" alt=""></p>
<h4 id="ç›‘æ§æ–¹æ³•æ‰§è¡Œæ—¶é—´"><a href="#ç›‘æ§æ–¹æ³•æ‰§è¡Œæ—¶é—´" class="headerlink" title="ç›‘æ§æ–¹æ³•æ‰§è¡Œæ—¶é—´"></a>ç›‘æ§æ–¹æ³•æ‰§è¡Œæ—¶é—´</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * ç›‘æ§ä¸€ä¸ªæ–¹æ³•çš„æ‰§è¡Œæ—¶é—´</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> orderId        å…¥å‚</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> probeClassName ç±»å</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> pmn            æ–¹æ³•å</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> duration       è€—æ—¶ï¼Œå•ä½çº³ç§’</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> map            ç»“æœmap</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@OnMethod</span>(clazz = <span class="string">"com.wosai.upay.remit.service.RemitOrderServiceImpl"</span>, method = <span class="string">"getRemitOrder"</span>, location = <span class="meta">@Location</span>(Kind.RETURN))</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">printMethodRunTime</span><span class="params">(String orderId, @ProbeClassName String probeClassName, @ProbeMethodName String pmn, @Duration <span class="keyword">long</span> duration,</span></span></span><br><span class="line"><span class="function"><span class="params">                                       @Return Map map)</span> </span>&#123;</span><br><span class="line">     println(<span class="string">"\nç›‘æ§æ‰§è¡Œæ—¶é—´-------------start\n"</span>);</span><br><span class="line">     println(probeClassName + pmn + <span class="string">",duration:"</span> + duration / <span class="number">1000000</span> + <span class="string">" ms"</span>);</span><br><span class="line">     println(<span class="string">"input: "</span> + orderId);</span><br><span class="line">     println(<span class="string">"output: "</span> + map);</span><br><span class="line">     <span class="keyword">if</span> (matches(<span class="string">"12345"</span>, orderId)) &#123;</span><br><span class="line">         println(<span class="string">"orderIdå‘½ä¸­"</span>);</span><br><span class="line">     &#125;</span><br><span class="line">     println(<span class="string">"\nç›‘æ§æ‰§è¡Œæ—¶é—´-------------end\n"</span>);</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="ç›‘æ§æ–¹æ³•æœ‰æ²¡æœ‰æ‰§è¡Œåˆ°144è¡Œ"><a href="#ç›‘æ§æ–¹æ³•æœ‰æ²¡æœ‰æ‰§è¡Œåˆ°144è¡Œ" class="headerlink" title="ç›‘æ§æ–¹æ³•æœ‰æ²¡æœ‰æ‰§è¡Œåˆ°144è¡Œ"></a>ç›‘æ§æ–¹æ³•æœ‰æ²¡æœ‰æ‰§è¡Œåˆ°144è¡Œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OnMethod</span>(clazz = <span class="string">"com.wosai.upay.remit.service.RemitOrderServiceImpl"</span>, location = <span class="meta">@Location</span>(value = Kind.LINE, line = <span class="number">144</span>))</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onBind</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">"æ‰§è¡Œåˆ°ç¬¬144è¡Œ"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æŸ¥çœ‹å¯¹è±¡å®ä¾‹çš„å±æ€§å€¼"><a href="#æŸ¥çœ‹å¯¹è±¡å®ä¾‹çš„å±æ€§å€¼" class="headerlink" title="æŸ¥çœ‹å¯¹è±¡å®ä¾‹çš„å±æ€§å€¼"></a>æŸ¥çœ‹å¯¹è±¡å®ä¾‹çš„å±æ€§å€¼</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * æŸ¥çœ‹å¯¹è±¡çš„å®ä¾‹å±æ€§å€¼</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> self</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@OnMethod</span>(clazz = <span class="string">"com.wosai.upay.remit.service.RemitOrderServiceImpl"</span>, method = <span class="string">"getRemitOrder"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getSelfValue</span><span class="params">(@Self Object self)</span> </span>&#123;</span><br><span class="line">    println(<span class="string">"\næŸ¥çœ‹å¯¹è±¡çš„å®ä¾‹å±æ€§å€¼-------------start\n"</span>);</span><br><span class="line">    Field field = field(<span class="string">"com.wosai.upay.remit.service.RemitOrderServiceImpl"</span>, <span class="string">"configCenter"</span>);</span><br><span class="line">    Object object = get(field, self);</span><br><span class="line">    println(object);</span><br><span class="line">    println(<span class="string">"\næŸ¥çœ‹å¯¹è±¡çš„å®ä¾‹å±æ€§å€¼-------------end\n"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ç›‘æ§hashMapæ‰©å®¹è¿‡ç¨‹"><a href="#ç›‘æ§hashMapæ‰©å®¹è¿‡ç¨‹" class="headerlink" title="ç›‘æ§hashMapæ‰©å®¹è¿‡ç¨‹"></a>ç›‘æ§hashMapæ‰©å®¹è¿‡ç¨‹</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç›‘æ§hashMapæ‰©å®¹è¿‡ç¨‹</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> probeClass</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> probeMethod</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> self</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> newCapacity</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@OnMethod</span>(clazz = <span class="string">"java.util.HashMap"</span>, method = <span class="string">"resize"</span>,</span><br><span class="line">        location = <span class="meta">@Location</span>(value = Kind.CALL, clazz = <span class="string">"/.*/"</span>, method = <span class="string">"/.*/"</span>))</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">traceMapExpandCapacity</span><span class="params">(@ProbeClassName String probeClass, @ProbeMethodName String probeMethod,</span></span></span><br><span class="line"><span class="function"><span class="params">                                          @Self Object self, <span class="keyword">int</span> newCapacity)</span> </span>&#123;</span><br><span class="line">    String point = Strings.strcat(Strings.strcat(probeClass, <span class="string">"."</span>), probeMethod);<span class="comment">//java/util/HashMap.resize</span></span><br><span class="line">    Class clazz = classForName(<span class="string">"java.util.HashMap"</span>);</span><br><span class="line">    println(Strings.strcat(point, <span class="string">"======"</span>));</span><br><span class="line">    <span class="comment">//è·å–å®ä¾‹protectedå˜é‡</span></span><br><span class="line">    Map.Entry[] table = (Map.Entry[]) get(field(clazz, <span class="string">"table"</span>, <span class="keyword">true</span>), self);</span><br><span class="line">    <span class="keyword">int</span> threshold = getInt(field(clazz, <span class="string">"threshold"</span>, <span class="keyword">true</span>), self);</span><br><span class="line">    <span class="keyword">int</span> size = getInt(field(clazz, <span class="string">"size"</span>, <span class="keyword">true</span>), self);</span><br><span class="line">    println(Strings.strcat(<span class="string">"newCapacity:"</span>, str(newCapacity)));</span><br><span class="line">    println(Strings.strcat(<span class="string">"table.length:"</span>, str(table.length)));</span><br><span class="line">    println(Strings.strcat(<span class="string">"size:"</span>, str(size)));</span><br><span class="line">    println(Strings.strcat(<span class="string">"threshold:"</span>, str(threshold)));</span><br><span class="line">    println(Strings.strcat(point, <span class="string">"------------"</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="ç›‘æ§å“ªä¸ªæ–¹æ³•æ‰§è¡Œäº†system-gc"><a href="#ç›‘æ§å“ªä¸ªæ–¹æ³•æ‰§è¡Œäº†system-gc" class="headerlink" title="ç›‘æ§å“ªä¸ªæ–¹æ³•æ‰§è¡Œäº†system.gc"></a>ç›‘æ§å“ªä¸ªæ–¹æ³•æ‰§è¡Œäº†system.gc</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * åˆ†æå“ªä¸ªæ–¹æ³•æ‰§è¡Œäº†System.gc()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@OnMethod</span>(clazz = <span class="string">"java.lang.System"</span> , method = <span class="string">"gc"</span> , location = <span class="meta">@Location</span>(Kind.ENTRY))</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">onSystemGC</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">"System GC"</span>);</span><br><span class="line">    jstack();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ¯éš”15ç§’ç›‘æ§æ–¹æ³•çš„æ‰§è¡Œæ¬¡æ•°"><a href="#æ¯éš”15ç§’ç›‘æ§æ–¹æ³•çš„æ‰§è¡Œæ¬¡æ•°" class="headerlink" title="æ¯éš”15ç§’ç›‘æ§æ–¹æ³•çš„æ‰§è¡Œæ¬¡æ•°"></a>æ¯éš”15ç§’ç›‘æ§æ–¹æ³•çš„æ‰§è¡Œæ¬¡æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ç»Ÿè®¡æ–¹æ³•çš„è°ƒç”¨æ¬¡æ•°ï¼Œä¸”æ¯éš”15ç§’æ‰“å°è°ƒç”¨æ¬¡æ•°</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Export</span></span><br><span class="line"><span class="keyword">static</span> AtomicLong counter = <span class="keyword">new</span> AtomicLong();</span><br><span class="line"></span><br><span class="line"><span class="meta">@OnMethod</span>(clazz = <span class="string">"com.wosai.upay.remit.service.RemitOrderServiceImpl"</span>, method = <span class="string">"getRemitOrder"</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">testCountRun</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    counter.getAndIncrement();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@OnTimer</span>(<span class="number">1000</span>*<span class="number">15</span>)</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    println(<span class="string">"count:"</span> + counter.get());</span><br><span class="line">    counter.set(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="æ¯éš”4ç§’æ£€æŸ¥æ˜¯å¦æœ‰æ­»é”äº§ç”Ÿ"><a href="#æ¯éš”4ç§’æ£€æŸ¥æ˜¯å¦æœ‰æ­»é”äº§ç”Ÿ" class="headerlink" title="æ¯éš”4ç§’æ£€æŸ¥æ˜¯å¦æœ‰æ­»é”äº§ç”Ÿ"></a>æ¯éš”4ç§’æ£€æŸ¥æ˜¯å¦æœ‰æ­»é”äº§ç”Ÿ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * æ¯éš”4ç§’æ£€æµ‹æ˜¯å¦æœ‰æ­»é”äº§ç”Ÿï¼Œå¹¶æ‰“å°äº§ç”Ÿæ­»é”çš„ç›¸å…³ç±»ä¿¡æ¯ã€å¯¹åº”çš„ä»£ç è¡Œã€çº¿ç¨‹ä¿¡æ¯ï¼Œä»£ç å¦‚ä¸‹ã€‚</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"> <span class="meta">@OnTimer</span>(<span class="number">4000</span>)</span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">trace6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     deadlocks();</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<h4 id="è¾“å‡º"><a href="#è¾“å‡º" class="headerlink" title="è¾“å‡º"></a>è¾“å‡º</h4><p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Btrace%E4%BD%BF%E7%94%A8/4.jpg" alt=""></p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://www.jianshu.com/p/dbb3a8b5c92f" target="_blank" rel="noopener">å¦‚ä½•åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨Btraceè¿›è¡Œè°ƒè¯•</a><br><a href="http://www.importnew.com/26495.html" target="_blank" rel="noopener">BtraceåŸç†æµ…æ</a></p>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Btrace </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[abå‹æµ‹]]></title>
      <url>/chengasd.github.io/2018/07/27/ab%E5%8E%8B%E6%B5%8B/</url>
      <content type="html"><![CDATA[<h3 id="1ã€å‚æ•°è¯´æ˜"><a href="#1ã€å‚æ•°è¯´æ˜" class="headerlink" title="1ã€å‚æ•°è¯´æ˜"></a>1ã€å‚æ•°è¯´æ˜</h3><p>-n  å³requestsï¼Œå‹æµ‹çš„æ€»è¯·æ±‚æ•°<br>-c  å³concurrencyï¼Œå‹æµ‹çš„å¹¶å‘æ•°<br>-t  å³timelimitï¼Œç­‰å¾…å“åº”çš„æœ€å¤§æ—¶é—´<br>-p  å³postfileï¼Œæ¨¡æ‹Ÿpostè¯·æ±‚ï¼Œé…åˆ-Tä½¿ç”¨<br>-T  å³content-typeï¼Œpostæ•°æ®æ‰€ä½¿ç”¨çš„Content-Typeå¤´ä¿¡æ¯ï¼Œå¦‚â€™application/jsonâ€™<br>-C  æ·»åŠ cookieä¿¡æ¯<br>-H  æ·»åŠ ä»»æ„çš„è¯·æ±‚å¤´<br>-e  filenameï¼Œè¾“å‡ºåˆ°å¯¹åº”csvæ–‡ä»¶ä¸­</p>
<p><img 27="" 2018="" src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/ab%E5%8E%8B%E6%B5%8B/1.jpg" alt="<img src=" chengasd.github.io="" 07="" abå‹æµ‹="" 1.jpg"="">"><br><a id="more"></a></p>
<h3 id="2ã€æ¨¡æ‹Ÿgetè¯·æ±‚"><a href="#2ã€æ¨¡æ‹Ÿgetè¯·æ±‚" class="headerlink" title="2ã€æ¨¡æ‹Ÿgetè¯·æ±‚"></a>2ã€æ¨¡æ‹Ÿgetè¯·æ±‚</h3><p>ç›´æ¥åœ¨urlåé¢å¸¦å‚æ•°å³å¯<br>ab -c 10 -n 10 <a href="http://www.xxxx.api.com/?gid=2" target="_blank" rel="noopener">http://www.xxxx.api.com/?gid=2</a></p>
<h3 id="3ã€æ¨¡æ‹Ÿpostè¯·æ±‚"><a href="#3ã€æ¨¡æ‹Ÿpostè¯·æ±‚" class="headerlink" title="3ã€æ¨¡æ‹Ÿpostè¯·æ±‚"></a>3ã€æ¨¡æ‹Ÿpostè¯·æ±‚</h3><p>éœ€åœ¨è¯·æ±‚ç›®å½•å†…æ–°å»ºpost.txtæ–‡ä»¶åŠ ä¸Šè¯·æ±‚å‚æ•°<br>ab -n 40  -c 10 -p â€˜post.txtâ€™ -T â€˜application/jsonâ€™ â€˜<a href="http://10.0.2.228:9204/osp/api/remit/findRemitOrders" target="_blank" rel="noopener">http://10.0.2.228:9204/osp/api/remit/findRemitOrders</a>â€˜</p>
<h3 id="4ã€å¸¸è§é—®é¢˜"><a href="#4ã€å¸¸è§é—®é¢˜" class="headerlink" title="4ã€å¸¸è§é—®é¢˜"></a>4ã€å¸¸è§é—®é¢˜</h3><h4 id="4-1-å‹æµ‹éœ€è¦ç™»é™†ç”¨æˆ·"><a href="#4-1-å‹æµ‹éœ€è¦ç™»é™†ç”¨æˆ·" class="headerlink" title="4-1 å‹æµ‹éœ€è¦ç™»é™†ç”¨æˆ·"></a>4-1 å‹æµ‹éœ€è¦ç™»é™†ç”¨æˆ·</h4><p>å…ˆç”¨è´¦æˆ·å’Œå¯†ç ç™»å½•åï¼Œç”¨å¼€å‘è€…å·¥å…·æ‰¾åˆ°æ ‡è¯†è¿™ä¸ªä¼šè¯çš„Cookieå€¼ï¼ˆSession IDï¼‰è®°ä¸‹æ¥</p>
<h4 id="4-2-å‹æµ‹éœ€è¦å¤šä¸ªç™»é™†ç”¨æˆ·"><a href="#4-2-å‹æµ‹éœ€è¦å¤šä¸ªç™»é™†ç”¨æˆ·" class="headerlink" title="4-2 å‹æµ‹éœ€è¦å¤šä¸ªç™»é™†ç”¨æˆ·"></a>4-2 å‹æµ‹éœ€è¦å¤šä¸ªç™»é™†ç”¨æˆ·</h4><p>å¦‚æœåªç”¨åˆ°ä¸€ä¸ªCookieï¼Œé‚£ä¹ˆåªéœ€é”®å…¥å‘½ä»¤ï¼š<br>ab ï¼n 100 ï¼C keyï¼value <a href="http://test.com/" target="_blank" rel="noopener">http://test.com/</a></p>
<p>å¦‚æœéœ€è¦å¤šä¸ªCookieï¼Œå°±ç›´æ¥è®¾Headerï¼š<br>ab -n 100 -H â€œCookie: Key1=Value1; Key2=Value2â€ <a href="http://test.com/" target="_blank" rel="noopener">http://test.com/</a></p>
<h3 id="5ã€ç»“æœè§£é‡Š"><a href="#5ã€ç»“æœè§£é‡Š" class="headerlink" title="5ã€ç»“æœè§£é‡Š"></a>5ã€ç»“æœè§£é‡Š</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">ab -n 40  -c 10 -p &apos;post.txt&apos; -T &apos;application/json&apos; &apos;http://10.0.2.228:9204/osp/api/remit/findRemitOrders&apos;</span><br><span class="line">This is ApacheBench, Version 2.3 &lt;$Revision: 1826891 $&gt;</span><br><span class="line">Copyright 1996 Adam Twiss, Zeus Technology Ltd, http://www.zeustech.net/</span><br><span class="line">Licensed to The Apache Software Foundation, http://www.apache.org/</span><br><span class="line"></span><br><span class="line">Benchmarking 10.0.2.228 (be patient).....done</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Server Software:        Jetty(6.1.22)</span><br><span class="line">Server Hostname:        10.0.2.228          (æœåŠ¡å™¨ä¸»æœºå)</span><br><span class="line">Server Port:            9204                (æœåŠ¡å™¨ç«¯å£)</span><br><span class="line"></span><br><span class="line">Document Path:          /osp/api/remit/findRemitOrders  ï¼ˆæµ‹è¯•urlï¼‰</span><br><span class="line">Document Length:        9330 bytes</span><br><span class="line"></span><br><span class="line">Concurrency Level:      10                  ï¼ˆå¹¶å‘æ•°ï¼‰</span><br><span class="line">Time taken for tests:   0.974 seconds        (å‹åŠ›æµ‹è¯•æ¶ˆè€—çš„æ€»æ—¶é—´)</span><br><span class="line">Complete requests:      40                   (å‹åŠ›æµ‹è¯•çš„æ€»æ¬¡æ•°)</span><br><span class="line">Failed requests:        0                    (å¤±è´¥æ¬¡æ•°)</span><br><span class="line">Total transferred:      390541 bytes         </span><br><span class="line">Total body sent:        8160</span><br><span class="line">HTML transferred:       373200 bytes</span><br><span class="line">Requests per second:    41.08 [#/sec] (mean) </span><br><span class="line">                        (ååç‡ï¼šå¹³å‡æ¯ç§’è¯·æ±‚æ•°)ç›¸å½“äº LR ä¸­çš„æ¯ç§’äº‹åŠ¡æ•°</span><br><span class="line">Time per request:       243.432 [ms] (mean)  </span><br><span class="line">                (å¹¶å‘ç”¨æˆ·(è¿™é‡Œæ˜¯10)éƒ½è¯·æ±‚ä¸€æ¬¡çš„å¹³å‡æ—¶é—´ï¼‰ç›¸å½“äº LR ä¸­çš„å¹³å‡äº‹åŠ¡å“åº”æ—¶é—´</span><br><span class="line">Time per request:       24.343 [ms] (mean, across all concurrent requests)</span><br><span class="line">                        (æœåŠ¡å™¨å¹³å‡è¯·æ±‚å¤„ç†æ—¶é—´)</span><br><span class="line">Transfer rate:          391.68 [Kbytes/sec] received</span><br><span class="line">                        8.18 kb/s sent</span><br><span class="line">                        399.86 kb/s total</span><br><span class="line"></span><br><span class="line">Connection Times (ms)</span><br><span class="line">              min  mean[+/-sd] median   max</span><br><span class="line">Connect:        0    0   0.2      0       1</span><br><span class="line">Processing:   143  190  27.1    188     249</span><br><span class="line">Waiting:      143  189  27.0    187     249</span><br><span class="line">Total:        144  190  27.1    188     250</span><br><span class="line"></span><br><span class="line">Percentage of the requests served within a certain time (ms)</span><br><span class="line">  50%    188         (è¯·æ±‚å¤„ç†æ—¶é—´çš„åˆ†å¸ƒæƒ…å†µ) è¿™é‡Œ50%è¯·æ±‚åœ¨188mså†…</span><br><span class="line">  66%    195</span><br><span class="line">  75%    202</span><br><span class="line">  80%    216</span><br><span class="line">  90%    239</span><br><span class="line">  95%    247</span><br><span class="line">  98%    250</span><br><span class="line">  99%    250</span><br><span class="line"> 100%    250 (longest request)</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> å‹æµ‹ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Javaçº¿ç¨‹å­¦ä¹ ä¸€]]></title>
      <url>/chengasd.github.io/2018/02/13/Java%E7%BA%BF%E7%A8%8B%E5%AD%A6%E4%B9%A0%E4%B8%80/</url>
      <content type="html"><![CDATA[<h2 id="å¦‚ä½•å®ç°ä¸€ä¸ªçº¿ç¨‹"><a href="#å¦‚ä½•å®ç°ä¸€ä¸ªçº¿ç¨‹" class="headerlink" title="å¦‚ä½•å®ç°ä¸€ä¸ªçº¿ç¨‹"></a>å¦‚ä½•å®ç°ä¸€ä¸ªçº¿ç¨‹</h2><p>å®ç°javaçº¿ç¨‹çš„æ–¹æ³•æœ‰ä¸‰ç§ï¼š<br>1ã€ç»§æ‰¿Threadç±»ï¼Œé‡å†™run()æ–¹æ³•<br>2ã€å®ç°Runnableæ¥å£ï¼Œå®ç°run()æ–¹æ³•<br>3ã€å®ç°Callableæ¥å£ï¼Œå®ç°call()æ–¹æ³•<br><a id="more"></a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThreadTest</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * å®ç°çº¿ç¨‹çš„æ–¹æ³•</span></span><br><span class="line"><span class="comment">     * 1ã€ç»§æ‰¿Threadç±»ï¼Œé‡å†™runæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * 2ã€å®ç°Runnableæ¥å£ï¼Œå®ç°runæ–¹æ³•</span></span><br><span class="line"><span class="comment">     * 3ã€ä½¿ç”¨Callableå’ŒFetureæ¥å£åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        Thread1 thread1 = <span class="keyword">new</span> Thread1();</span><br><span class="line">        Thread2 thread2 = <span class="keyword">new</span> Thread2();</span><br><span class="line">        thread1.run();</span><br><span class="line">        thread2.run();</span><br><span class="line">        <span class="comment">//ç¬¬ä¸‰ç§å†™æ³•</span></span><br><span class="line">        Callable&lt;String&gt; callable = <span class="keyword">new</span> Callable&lt;String&gt;() &#123;</span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="string">"ç¬¬ä¸‰ç§ä½¿ç”¨Callableå’ŒFetureæ¥å£åˆ›å»ºçº¿ç¨‹"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        FutureTask&lt;String&gt; thread3 = <span class="keyword">new</span> FutureTask&lt;String&gt;(callable);</span><br><span class="line">        <span class="keyword">new</span> Thread(thread3).start();</span><br><span class="line">        System.out.println(thread3.get());</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread1</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"ç¬¬1ç§ï¼šç»§æ‰¿Threadç±»ï¼Œé‡å†™runæ–¹æ³•"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Thread2</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">"ç¬¬2ç§ï¼šå®ç°Runnableæ¥å£ï¼Œå®ç°runæ–¹æ³•"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Runnableå’ŒCallableçš„åŒºåˆ«"><a href="#Runnableå’ŒCallableçš„åŒºåˆ«" class="headerlink" title="Runnableå’ŒCallableçš„åŒºåˆ«"></a>Runnableå’ŒCallableçš„åŒºåˆ«</h3><p>1ã€å®ç°æ–¹æ³•ä¸åŒï¼Œrunnableç”¨run()æ–¹æ³•ï¼Œcallableç”¨call()æ–¹æ³•ã€‚<br>2ã€callableçš„ä»»åŠ¡æ‰§è¡Œå®Œåå¯è¿”å›å€¼ï¼Œè€Œrunnableæ²¡æœ‰ã€‚<br>3ã€callæ–¹æ³•å¯ä»¥æŠ›å‡ºå¼‚å¸¸ï¼Œè€Œrunæ–¹æ³•ä¸è¡Œã€‚<br>4ã€callableæ”¯æŒèŒƒå‹ï¼Œrunnableä¸æ”¯æŒã€‚<br>5ã€callableä»»åŠ¡å¯ä»¥è¿”å›ä¸€ä¸ªfutureå¯¹è±¡ï¼Œè¡¨ç¤ºå¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚<br>å…³äºfutureå¯¹è±¡è§ä¸‹èŠ‚ã€‚</p>
<h2 id="futureæ¨¡å¼"><a href="#futureæ¨¡å¼" class="headerlink" title="futureæ¨¡å¼"></a>futureæ¨¡å¼</h2><h3 id="futureå®šä¹‰"><a href="#futureå®šä¹‰" class="headerlink" title="futureå®šä¹‰"></a>futureå®šä¹‰</h3><p>futureå°±æ˜¯å¯¹äºå…·ä½“çš„Runnableæˆ–è€…Callableä»»åŠ¡çš„æ‰§è¡Œç»“æœè¿›è¡Œå–æ¶ˆã€æŸ¥è¯¢æ˜¯å¦å®Œæˆã€è·å–ç»“æœã€è®¾ç½®ç»“æœæ“ä½œã€‚<br>1ã€å¦‚æœçº¿ç¨‹æ²¡æœ‰æ‰§è¡Œå®Œï¼Œfuture.get()å¯èƒ½ä¼šé˜»å¡å½“å‰çº¿ç¨‹æ‰§è¡Œã€‚<br>2ã€å¦‚æœçº¿ç¨‹å‡ºç°å¼‚å¸¸ï¼Œfuture.get()ä¼šæŠ›å‡ºInterruptedExceptionæˆ–è€…ExecutionExceptionå¼‚å¸¸ã€‚<br>3ã€å¦‚æœçº¿ç¨‹å·²ç»å–æ¶ˆäº†ï¼Œä¼šæŠ›å‡ºCancellationExceptionï¼Œå–æ¶ˆç”±cancelæ–¹æ³•æ‰§è¡Œã€‚<br>4ã€isDoneç¡®å®šä»»åŠ¡æ˜¯å¦æ­£å¸¸å®Œæˆè¿˜æ˜¯è¢«å–æ¶ˆäº†ï¼Œå¦‚æœçº¿ç¨‹è®¡ç®—å®Œæˆã€‚å°±ä¸èƒ½å†å–æ¶ˆçº¿ç¨‹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Future</span>&lt;<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//è¿˜æ²¡è®¡ç®—å®Œï¼Œå¯ä»¥å–æ¶ˆè®¡ç®—è¿‡ç¨‹</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">cancel</span><span class="params">(<span class="keyword">boolean</span> mayInterruptIfRunning)</span></span>;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­è®¡ç®—æ˜¯å¦è¢«å–æ¶ˆ</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isCancelled</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//åˆ¤æ–­æ˜¯å¦è®¡ç®—å®Œ</span></span><br><span class="line">    <span class="function"><span class="keyword">boolean</span> <span class="title">isDone</span><span class="params">()</span></span>;</span><br><span class="line">    <span class="comment">//è·å–è®¡ç®—ç»“æœï¼ˆå¦‚æœè¿˜æ²¡è®¡ç®—å®Œï¼Œä¹Ÿæ˜¯å¿…é¡»ç­‰å¾…çš„ï¼‰</span></span><br><span class="line">    <span class="function">V <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException</span>;</span><br><span class="line">    <span class="comment">//é˜»å¡ä¸€å®šæ—¶é—´ç­‰å¾…ä»»åŠ¡å®Œæˆï¼Œå¹¶è¿”å›ä»»åŠ¡æ‰§è¡Œç»“æœï¼Œè¶…è¿‡æ—¶é—´æœªè¿”å›ç»“æœä¼šæŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="function">V <span class="title">get</span><span class="params">(<span class="keyword">long</span> timeout, TimeUnit unit)</span></span></span><br><span class="line"><span class="function">        <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h3><p>Demoå¦‚ä¸‹<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FutureTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">        <span class="keyword">long</span> startTime = System.currentTimeMillis();</span><br><span class="line">        <span class="comment">//ç¬¬ä¸€æ­¥ä¸‹å•</span></span><br><span class="line">        Callable&lt;Buy&gt; buyCallable = <span class="keyword">new</span> Callable&lt;Buy&gt;() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> Buy <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">"ç¬¬ä¸€æ­¥: Appä¸‹å•ä¹°å¤–å–"</span>);</span><br><span class="line">                System.out.println(<span class="string">"ç¬¬ä¸€æ­¥: ç­‰å¾…é€è´§"</span>);</span><br><span class="line">                Thread.sleep(<span class="number">5000</span>);  <span class="comment">// æ¨¡æ‹Ÿé€è´§æ—¶é—´</span></span><br><span class="line">                System.out.println(<span class="string">"ç¬¬ä¸€æ­¥ï¼šå¿«é€’é€åˆ°"</span>);</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> Buy(<span class="string">"è›‹ç‚’é¥­"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        FutureTask&lt;Buy&gt; buyTask = <span class="keyword">new</span> FutureTask&lt;Buy&gt;(buyCallable);</span><br><span class="line">        <span class="keyword">new</span> Thread(buyTask).start();</span><br><span class="line">        Thread.sleep(<span class="number">2000</span>);       <span class="comment">// ç­‰å¾…ç©æ¸¸æˆ</span></span><br><span class="line">        System.out.println(<span class="string">"ç¬¬äºŒæ­¥ï¼šç‹è€…æ‰“ç»“æŸäº†"</span>);</span><br><span class="line">        <span class="comment">// ç¬¬ä¸‰æ­¥ è”ç³»å¿«é€’å°å“¥ï¼Œè¿˜è¦å¤šä¹…ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (!buyTask.isDone()) &#123;  <span class="comment">// è”ç³»å¿«é€’å‘˜ï¼Œè¯¢é—®æ˜¯å¦åˆ°è´§</span></span><br><span class="line">            System.out.println(<span class="string">"ç¬¬ä¸‰æ­¥ï¼šè”ç³»äº†å¿«é€’å°å“¥ï¼Œé—®å¤–å–è¦å¤šä¹…ã€‚"</span>);</span><br><span class="line">            Random random = <span class="keyword">new</span> Random();</span><br><span class="line">            <span class="keyword">if</span> (random.nextInt(<span class="number">2</span>) &gt;= <span class="number">1</span>)&#123;</span><br><span class="line">                System.out.println(<span class="string">"ç¬¬ä¸‰æ­¥: ä»Šå¤©çªç„¶å¿ƒæƒ…ä¸çˆ½ï¼Œæˆ‘è¦å–æ¶ˆè®¢å•äº†ã€‚"</span>);</span><br><span class="line">                buyTask.cancel(<span class="keyword">true</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (buyTask.isCancelled()) &#123;</span><br><span class="line">                System.out.println(<span class="string">"ç¬¬å››æ­¥ï¼šè”ç³»å–å®¶å–æ¶ˆè®¢å•ã€‚"</span>);</span><br><span class="line">                <span class="comment">//future.get()ä¼šæŠ›å‡ºCancellationException</span></span><br><span class="line">                System.out.println(<span class="string">"ç¬¬äº”æ­¥ï¼šå–æ¶ˆæˆåŠŸäº†ï¼Œè‡ªå·±å‡ºå»åƒå§"</span>);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">"ç¬¬å››æ­¥: å¤–å–"</span>+buyTask.get().getName()+<span class="string">"é€åˆ°"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">"æ€»å…±ç”¨æ—¶"</span> + (System.currentTimeMillis() - startTime) + <span class="string">"ms"</span>);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Buy</span> </span>&#123;</span><br><span class="line">        <span class="keyword">private</span>  String name ;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="title">Buy</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">            <span class="keyword">this</span>.name = name;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//...</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="futureTask"><a href="#futureTask" class="headerlink" title="futureTask"></a>futureTask</h3><p>é¦–å…ˆäº†è§£stateçŠ¶æ€çš„å‡ ä¸ªå€¼å®šä¹‰</p>
<blockquote>
<p>private volatile int state;<br>private static final int NEW          = 0; //åˆå§‹çŠ¶æ€<br>private static final int COMPLETING   = 1; //çº¿ç¨‹æ‰§è¡Œä¸­é—´çŠ¶æ€<br>private static final int NORMAL       = 2; //ä»»åŠ¡å®Œæˆ å·²setç»“æœ<br>private static final int EXCEPTIONAL  = 3; //æŠ›å‡ºå¼‚å¸¸<br>private static final int CANCELLED    = 4; //ä»»åŠ¡å–æ¶ˆ<br>private static final int INTERRUPTING = 5; //çº¿ç¨‹ä¸­æ–­çŠ¶æ€è¢«è®¾ç½®tureï¼Œä½†çº¿ç¨‹æœªå“åº”ä¸­æ–­<br>private static final int INTERRUPTED  = 6; //ä»»åŠ¡å·²è¢«ä¸­æ–­</p>
</blockquote>
<p>1ã€æ‰§è¡Œè¿‡ç¨‹é¡ºåˆ©å®Œæˆï¼šNEW -&gt; COMPLETING -&gt; NORMAL<br>2ã€æ‰§è¡Œè¿‡ç¨‹å‡ºç°å¼‚å¸¸ï¼šNEW -&gt; COMPLETING -&gt; EXCEPTIONAL<br>3ã€æ‰§è¡Œè¿‡ç¨‹è¢«å–æ¶ˆï¼šNEW -&gt; CANCELLED<br>4ã€æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¸­æ–­ï¼šNEW -&gt; INTERRUPTING -&gt; INTERRUPTED</p>
<h4 id="run-æ–¹æ³•"><a href="#run-æ–¹æ³•" class="headerlink" title="run()æ–¹æ³•"></a>run()æ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (state != NEW ||</span><br><span class="line">            !UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, runnerOffset,</span><br><span class="line">                                         <span class="keyword">null</span>, Thread.currentThread()))</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Callable&lt;V&gt; c = callable;   <span class="comment">//1ã€æ„é€ å‡½æ•°ä¼ å…¥è‡ªå·±çš„callableå¯¹è±¡</span></span><br><span class="line">            <span class="keyword">if</span> (c != <span class="keyword">null</span> &amp;&amp; state == NEW) &#123;</span><br><span class="line">                V result;</span><br><span class="line">                <span class="keyword">boolean</span> ran;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    result = c.call();  <span class="comment">//2ã€æ‰§è¡Œcallæ–¹æ³•</span></span><br><span class="line">                    ran = <span class="keyword">true</span>;</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Throwable ex) &#123;</span><br><span class="line">                    result = <span class="keyword">null</span>;</span><br><span class="line">                    ran = <span class="keyword">false</span>;</span><br><span class="line">                    setException(ex);   <span class="comment">//3ã€å‡ºç°å¼‚å¸¸</span></span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (ran)</span><br><span class="line">                    set(result);        <span class="comment">//4ã€è®¾ç½®ç»“æœ</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            runner = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">int</span> s = state;</span><br><span class="line">            <span class="keyword">if</span> (s &gt;= INTERRUPTING)</span><br><span class="line">                handlePossibleCancellationInterrupt(s);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="get-æ–¹æ³•"><a href="#get-æ–¹æ³•" class="headerlink" title="get()æ–¹æ³•"></a>get()æ–¹æ³•</h4><p>å½“çº¿ç¨‹çŠ¶æ€ä¸ºnewæˆ–è€…completingçŠ¶æ€æ—¶ï¼Œæ„å»ºé˜Ÿåˆ—çš„WaitNodeèŠ‚ç‚¹å…ƒç´ ï¼Œå¹¶å°†è¯¥èŠ‚ç‚¹å­˜å…¥åŒæ­¥ç­‰å¾…é˜Ÿåˆ—ï¼ŒåŒæ—¶é˜»å¡å½“å‰çº¿ç¨‹ç­‰å¾…è¿è¡Œä¸»ä»»åŠ¡çš„çº¿ç¨‹å”¤é†’è¯¥èŠ‚ç‚¹ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException </span>&#123;</span><br><span class="line">     <span class="keyword">int</span> s = state;</span><br><span class="line">     <span class="keyword">if</span> (s &lt;= COMPLETING)  <span class="comment">//1ã€å¦‚æœçº¿ç¨‹è¿˜æ²¡æœ‰æ‰§è¡Œå®Œæˆï¼Œåˆ™è°ƒç”¨é˜»å¡æ–¹æ³•awaitDone</span></span><br><span class="line">         s = awaitDone(<span class="keyword">false</span>, <span class="number">0L</span>);</span><br><span class="line">     <span class="keyword">return</span> report(s);</span><br><span class="line"> &#125;</span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">int</span> <span class="title">awaitDone</span><span class="params">(<span class="keyword">boolean</span> timed, <span class="keyword">long</span> nanos)</span></span></span><br><span class="line"><span class="function">     <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">     <span class="keyword">final</span> <span class="keyword">long</span> deadline = timed ? System.nanoTime() + nanos : <span class="number">0L</span>;</span><br><span class="line">     WaitNode q = <span class="keyword">null</span>;</span><br><span class="line">     <span class="keyword">boolean</span> queued = <span class="keyword">false</span>;</span><br><span class="line">     <span class="keyword">for</span> (;;) &#123;</span><br><span class="line">         <span class="keyword">if</span> (Thread.interrupted()) &#123;</span><br><span class="line">             removeWaiter(q);</span><br><span class="line">             <span class="keyword">throw</span> <span class="keyword">new</span> InterruptedException();</span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line">         <span class="keyword">int</span> s = state;</span><br><span class="line">         <span class="keyword">if</span> (s &gt; COMPLETING) &#123;   <span class="comment">//å¦‚æœçº¿ç¨‹æ‰§è¡Œå®Œæˆ–è€…å–æ¶ˆ</span></span><br><span class="line">             <span class="keyword">if</span> (q != <span class="keyword">null</span>)</span><br><span class="line">                 q.thread = <span class="keyword">null</span>;</span><br><span class="line">             <span class="keyword">return</span> s;</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (s == COMPLETING) </span><br><span class="line"> <span class="comment">//å¦‚æœstate=COMPLETINGï¼Œåˆ™ä½¿ç”¨yieldï¼Œå› ä¸ºæ­¤çŠ¶æ€çš„æ—¶é—´ç‰¹åˆ«çŸ­ï¼Œé€šè¿‡yieldæ¯”æŒ‚èµ·å“åº”æ›´å¿«ã€‚</span></span><br><span class="line">             Thread.yield();</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (q == <span class="keyword">null</span>)</span><br><span class="line">             q = <span class="keyword">new</span> WaitNode();   <span class="comment">//åˆ›å»ºWaitNodeç±»</span></span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (!queued)</span><br><span class="line">             <span class="comment">//æŠŠå½“å‰èŠ‚ç‚¹å…¥ç­‰å¾…é˜Ÿåˆ—</span></span><br><span class="line">             queued = UNSAFE.compareAndSwapObject(<span class="keyword">this</span>, waitersOffset,</span><br><span class="line">                                                  q.next = waiters, q);</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (timed) &#123;</span><br><span class="line">             <span class="comment">//é˜»å¡æŒ‡å®šæ—¶é—´</span></span><br><span class="line">             nanos = deadline - System.nanoTime();</span><br><span class="line">             <span class="keyword">if</span> (nanos &lt;= <span class="number">0L</span>) &#123;</span><br><span class="line">                 removeWaiter(q);</span><br><span class="line">                 <span class="keyword">return</span> state;</span><br><span class="line">             &#125;</span><br><span class="line">             LockSupport.parkNanos(<span class="keyword">this</span>, nanos);</span><br><span class="line">         &#125;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             <span class="comment">//é˜»å¡å½“å‰çº¿ç¨‹</span></span><br><span class="line">             LockSupport.park(<span class="keyword">this</span>);</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Javaè¿›é˜¶åŸºç¡€ </tag>
            
            <tag> çº¿ç¨‹ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[TreeMap-1.8]]></title>
      <url>/chengasd.github.io/2018/02/04/TreeMap-1-8/</url>
      <content type="html"><![CDATA[<h3 id="çº¢é»‘æ ‘"><a href="#çº¢é»‘æ ‘" class="headerlink" title="çº¢é»‘æ ‘"></a>çº¢é»‘æ ‘</h3><h4 id="çº¢é»‘æ ‘ç‰¹å¾"><a href="#çº¢é»‘æ ‘ç‰¹å¾" class="headerlink" title="çº¢é»‘æ ‘ç‰¹å¾"></a>çº¢é»‘æ ‘ç‰¹å¾</h4><p>1ã€æ¯ä¸ªèŠ‚ç‚¹ä¸æ˜¯çº¢è‰²å°±æ˜¯é»‘è‰²<br>2ã€æ ¹èŠ‚ç‚¹æ€»æ˜¯é»‘è‰²çš„<br>3ã€å¦‚æœèŠ‚ç‚¹æ˜¯çº¢è‰²çš„ï¼Œé‚£ä¹ˆä»–çš„å­èŠ‚ç‚¹å¿…é¡»æ˜¯çº¢è‰²çš„<br>4ã€ä»æ ¹èŠ‚ç‚¹åˆ°å¶å­èŠ‚ç‚¹æˆ–è€…ç©ºå­èŠ‚ç‚¹æ¯æ¡è·¯å¾„çš„é»‘è‰²èŠ‚ç‚¹æ•°å¿…é¡»ç›¸åŒã€‚<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/TreeMap-1-8/1.jpg" alt=""><br><a id="more"></a></p>
<blockquote>
<p>åœ¨çº¢é»‘æ ‘ä¸­æ’å…¥çš„èŠ‚ç‚¹éƒ½æ˜¯çº¢è‰²çš„ã€‚ why?</p>
</blockquote>
<p>å› ä¸ºæ’å…¥ä¸€ä¸ªçº¢è‰²èŠ‚ç‚¹æ¯”æ’å…¥ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹è¿èƒŒè§„åˆ™çš„å¯èƒ½æ€§æ›´å°ï¼Œå› ä¸ºæ’å…¥ä¸€ä¸ªé»‘è‰²èŠ‚ç‚¹ä¼šè¿èƒŒè§„åˆ™4ï¼Œè€Œæ’å…¥çº¢è‰²èŠ‚ç‚¹åªæœ‰ä¸€åŠçš„æœºä¼šè¿èƒŒè§„åˆ™3ã€‚</p>
<blockquote>
<p>å¦‚ä½•ä¿®æ­£çº¢é»‘æ ‘ï¼Ÿ</p>
</blockquote>
<p>ä¿®å¤è¿‡ç¨‹ï¼&gt; å…ˆå˜è‰² ï¼&gt; å·¦æ—‹ =&gt; å³æ—‹</p>
<blockquote>
<p>å¦‚ä½•å¯»æ‰¾åˆ°ç»™å®šèŠ‚ç‚¹tçš„åç»§(å³å¤§äºtçš„æœ€å°å…ƒç´ )</p>
</blockquote>
<p>1ã€tçš„å³å­©å­ä¸ä¸ºç©ºï¼Œåˆ™tçš„åç»§æ˜¯å…¶å³å­æ ‘ä¸­æœ€å°çš„å…ƒç´ ã€‚<br>2ã€tçš„å³å­©å­ä¸ºç©ºï¼Œåˆ™tçš„åç»§æ˜¯å…¶æŸ¥ç¥–çˆ¶èŠ‚ç‚¹ä¸­ç¬¬ä¸€ä¸ªå¾€å·¦èµ°çš„å…ƒç´ <br>3ã€è¯¦è§successoré™æ€æ–¹æ³•</p>
<h3 id="æˆå‘˜æ–¹æ³•"><a href="#æˆå‘˜æ–¹æ³•" class="headerlink" title="æˆå‘˜æ–¹æ³•"></a>æˆå‘˜æ–¹æ³•</h3><h4 id="å·¦æ—‹rotateLeft"><a href="#å·¦æ—‹rotateLeft" class="headerlink" title="å·¦æ—‹rotateLeft"></a>å·¦æ—‹rotateLeft</h4><p>è¢«æ—‹è½¬çš„èŠ‚ç‚¹p å·¦æ—‹åå°†å˜æˆä¸€ä¸ªå·¦èŠ‚ç‚¹ã€‚<br>              k = p.parent           k<br>            /                       /<br>           p                       r<br>          / \                     / \<br>         lx  r      â€”â€“&gt;       p  rr<br>            / \                 / \<br>           lr rr               lx lr<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateLeft</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">     <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">         Entry&lt;K,V&gt; r = p.right;</span><br><span class="line">         p.right = r.left;</span><br><span class="line">         <span class="keyword">if</span> (r.left != <span class="keyword">null</span>)</span><br><span class="line">             r.left.parent = p;</span><br><span class="line">         r.parent = p.parent;</span><br><span class="line">         <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">             root = r;</span><br><span class="line">         <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.left == p)</span><br><span class="line">             p.parent.left = r;</span><br><span class="line">         <span class="keyword">else</span></span><br><span class="line">             p.parent.right = r;</span><br><span class="line">         r.left = p;</span><br><span class="line">         p.parent = r;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/TreeMap-1-8/left.jpg" alt=""></p>
<h4 id="å³æ—‹rotateRight"><a href="#å³æ—‹rotateRight" class="headerlink" title="å³æ—‹rotateRight"></a>å³æ—‹rotateRight</h4><p>è¢«æ—‹è½¬çš„èŠ‚ç‚¹p å³æ—‹åå°†å˜æˆä¸€ä¸ªå³èŠ‚ç‚¹ã€‚</p>
<pre><code>      k = p.parent        k            
     /                   / 
    p                   l 
   / \                 / \ 
  l  pr   -----&gt;      ll  p 
 / \                     / \ 
ll  lr                  lr pr 
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">rotateRight</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; l = p.left;</span><br><span class="line">            p.left = l.right;</span><br><span class="line">            <span class="keyword">if</span> (l.right != <span class="keyword">null</span>) l.right.parent = p;</span><br><span class="line">            l.parent = p.parent;</span><br><span class="line">            <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>)</span><br><span class="line">                root = l;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (p.parent.right == p)</span><br><span class="line">                p.parent.right = l;</span><br><span class="line">            <span class="keyword">else</span> p.parent.left = l;</span><br><span class="line">            l.right = p;</span><br><span class="line">            p.parent = l;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/TreeMap-1-8/right.jpg" alt=""></p>
<h4 id="è·å–å…ƒç´ getEntry"><a href="#è·å–å…ƒç´ getEntry" class="headerlink" title="è·å–å…ƒç´ getEntry"></a>è·å–å…ƒç´ getEntry</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title">getEntry</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//first:ä»æ ¹åŸºç‚¹å¼€å§‹éå†</span></span><br><span class="line">    Entry&lt;K,V&gt; p = root;</span><br><span class="line">    <span class="keyword">while</span> (p != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">int</span> cmp = k.compareTo(p.key);</span><br><span class="line">        <span class="comment">//second:æ¯”è¾ƒ  1ã€å°çš„åˆ™åœ¨å·¦è¾¹left</span></span><br><span class="line">        <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">            p = p.left;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">        <span class="comment">//2ã€å¤§çš„åˆ™åœ¨å³è¾¹</span></span><br><span class="line">            p = p.right;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="å¯»æ‰¾åç»§èŠ‚ç‚¹successoræ–¹æ³•"><a href="#å¯»æ‰¾åç»§èŠ‚ç‚¹successoræ–¹æ³•" class="headerlink" title="å¯»æ‰¾åç»§èŠ‚ç‚¹successoræ–¹æ³•"></a>å¯»æ‰¾åç»§èŠ‚ç‚¹successoræ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &lt;K,V&gt; TreeMap.<span class="function">Entry&lt;K,V&gt; <span class="title">successor</span><span class="params">(Entry&lt;K,V&gt; t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (t == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (t.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="comment">//æƒ…å†µ1 ï¼š å¦‚æœtæœ‰å³å­©å­ï¼Œåˆ™åç»§èŠ‚ç‚¹åˆ™ä¸ºå³å­©å­ä¸­æœ€å°çš„å…ƒç´ ã€‚ ä¸€è·¯å¾€å·¦æŸ¥</span></span><br><span class="line">        Entry&lt;K,V&gt; p = t.right;</span><br><span class="line">        <span class="keyword">while</span> (p.left != <span class="keyword">null</span>)</span><br><span class="line">            p = p.left;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//æƒ…å†µ2 ï¼š å¦‚æœtæ²¡æœ‰å³å­©å­ï¼Œåˆ™ä¸€ç›´æŸ¥ç¥–çˆ¶èŠ‚ç‚¹ï¼Œåç»§èŠ‚ç‚¹åˆ™ä¸ºç¬¬ä¸€ä¸ªå¾€å·¦èµ°çš„å…ƒç´ </span></span><br><span class="line">        Entry&lt;K,V&gt; p = t.parent;</span><br><span class="line">        Entry&lt;K,V&gt; ch = t;</span><br><span class="line">        <span class="keyword">while</span> (p != <span class="keyword">null</span> &amp;&amp; ch == p.right) &#123;</span><br><span class="line">            ch = p;</span><br><span class="line">            p = p.parent;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/TreeMap-1-8/o.png" alt=""></p>
<h4 id="æ’å…¥ä¿®æ­£fixAfterInsertion"><a href="#æ’å…¥ä¿®æ­£fixAfterInsertion" class="headerlink" title="æ’å…¥ä¿®æ­£fixAfterInsertion"></a>æ’å…¥ä¿®æ­£fixAfterInsertion</h4><p>å…·ä½“ä»£ç æµç¨‹å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterInsertion</span><span class="params">(Entry&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//1ã€æ–°åŠ çš„èŠ‚ç‚¹ä¸ºçº¢è‰²</span></span><br><span class="line">        x.color = RED;</span><br><span class="line">        <span class="comment">//2ã€å¦‚æœçˆ¶èŠ‚ç‚¹ä¸ºçº¢è‰²</span></span><br><span class="line">        <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; x != root &amp;&amp; x.parent.color == RED) &#123;</span><br><span class="line">            <span class="keyword">if</span> (parentOf(x) == leftOf(parentOf(parentOf(x)))) &#123;</span><br><span class="line">                Entry&lt;K,V&gt; y = rightOf(parentOf(parentOf(x)));</span><br><span class="line">                <span class="comment">//3ã€yä¸ºxæ–°èŠ‚ç‚¹çš„å”å”èŠ‚ç‚¹ ä¸”ä¸ºçº¢è‰²   </span></span><br><span class="line">                <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                    <span class="comment">// å˜è‰²åœºæ™¯ çˆ¶èŠ‚ç‚¹å˜é»‘ï¼Œå”å”èŠ‚ç‚¹å˜é»‘ç¥–çˆ¶èŠ‚ç‚¹å˜çº¢</span></span><br><span class="line">                    setColor(parentOf(x), BLACK);         </span><br><span class="line">                    setColor(y, BLACK);                   </span><br><span class="line">                    setColor(parentOf(parentOf(x)), RED); </span><br><span class="line">                    x = parentOf(parentOf(x));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="comment">//4ã€å”å”èŠ‚ç‚¹ä¸ºé»‘è‰²</span></span><br><span class="line">                    <span class="keyword">if</span> (x == rightOf(parentOf(x))) &#123;</span><br><span class="line">                        <span class="comment">//4-1 å¦‚æœxèŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹çš„å³å­èŠ‚ç‚¹ ï¼Œåˆ™ä»¥çˆ¶èŠ‚ç‚¹åšå·¦æ—‹æ“ä½œ</span></span><br><span class="line">                        x = parentOf(x);</span><br><span class="line">                        rotateLeft(x);</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="comment">//4-2 å¦‚æœxèŠ‚ç‚¹ä¸ºçˆ¶èŠ‚ç‚¹çš„å·¦å­èŠ‚ç‚¹ ï¼Œå…ˆå°†çˆ¶èŠ‚ç‚¹è®¾é»‘ ï¼Œç¥–çˆ¶èŠ‚ç‚¹è®¾çº¢ï¼ŒæŒ‰ç¥–çˆ¶èŠ‚ç‚¹åšå³æ—‹æ“ä½œ</span></span><br><span class="line">                    setColor(parentOf(x), BLACK);</span><br><span class="line">                    setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                    rotateRight(parentOf(parentOf(x)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Entry&lt;K,V&gt; y = leftOf(parentOf(parentOf(x)));</span><br><span class="line">                <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                    setColor(parentOf(x), BLACK);</span><br><span class="line">                    setColor(y, BLACK);</span><br><span class="line">                    setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                    x = parentOf(parentOf(x));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">                        x = parentOf(x);</span><br><span class="line">                        rotateRight(x);</span><br><span class="line">                    &#125;</span><br><span class="line">                    setColor(parentOf(x), BLACK);</span><br><span class="line">                    setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                    rotateLeft(parentOf(parentOf(x)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        root.color = BLACK;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<img src="/chengasd.github.io/2018/02/04/TreeMap-1-8/1.jpg">
<h4 id="åˆ é™¤å…ƒç´ deleteEntry"><a href="#åˆ é™¤å…ƒç´ deleteEntry" class="headerlink" title="åˆ é™¤å…ƒç´ deleteEntry"></a>åˆ é™¤å…ƒç´ deleteEntry</h4><p>é€»è¾‘ä¸»è¦ï¼š1ã€æ‰¾å‡ºåˆ é™¤èŠ‚ç‚¹å¯¹åº”çš„åç»§èŠ‚ç‚¹ã€‚<br>        2ã€å°†åç»§èŠ‚ç‚¹çš„å†…å®¹è¦†ç›–åˆ°åˆ é™¤åŠèŠ‚ç‚¹ã€‚<br>        3ã€åˆ é™¤åç»§èŠ‚ç‚¹ä½ç½®çš„å†…å®¹ï¼Œå¹¶ä¿®æ”¹çˆ¶å­èŠ‚ç‚¹é—´å¼•ç”¨å…³ç³»çš„å˜æ›´ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">deleteEntry</span><span class="params">(Entry&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">        modCount++;     <span class="comment">//1ã€ç»“æ„ä¿®æ”¹æ¬¡æ•°++</span></span><br><span class="line">        size--;         <span class="comment">//2ã€æ€»å…ƒç´ ä¸ªæ•°ï¼ï¼</span></span><br><span class="line">        <span class="comment">//1ã€å¦‚æœåˆ é™¤çš„èŠ‚ç‚¹æœ‰å­©å­èŠ‚ç‚¹ï¼Œåˆ™æ‰¾å‡ºåç»§èŠ‚ç‚¹</span></span><br><span class="line">        <span class="keyword">if</span> (p.left != <span class="keyword">null</span> &amp;&amp; p.right != <span class="keyword">null</span>) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; s = successor(p);</span><br><span class="line">            p.key = s.key;</span><br><span class="line">            p.value = s.value;</span><br><span class="line">            <span class="comment">//2ã€å°†è¦åˆ é™¤èŠ‚ç‚¹å’Œåç»§èŠ‚ç‚¹çš„å€¼æ›¿æ¢ä¸‹ï¼Œé¢œè‰²ä¸æ›¿æ¢ã€‚</span></span><br><span class="line">            p = s;</span><br><span class="line">        &#125; </span><br><span class="line">        <span class="comment">//3ã€å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹(æœ‰åç»§èŠ‚ç‚¹åˆ™ä¸ºåç»§èŠ‚ç‚¹ä½ç½®)æœ‰å­©å­èŠ‚ç‚¹ï¼Œåˆ™å…³è”è¯¥å­©å­èŠ‚ç‚¹ã€‚</span></span><br><span class="line">        Entry&lt;K,V&gt; replacement = (p.left != <span class="keyword">null</span> ? p.left : p.right);</span><br><span class="line">        <span class="keyword">if</span> (replacement != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="comment">//4ã€å°†åç»§èŠ‚ç‚¹ä½ç½®çš„çˆ¶èŠ‚ç‚¹å…³è”è¯¥å­©å­èŠ‚ç‚¹</span></span><br><span class="line">            ...</span><br><span class="line">            <span class="comment">//5ã€å¦‚æœåç»§èŠ‚ç‚¹çš„é¢œè‰²æ˜¯é»‘è‰²çš„ï¼Œåˆ™è¦åšè°ƒæ•´ã€‚</span></span><br><span class="line">            <span class="keyword">if</span> (p.color == BLACK)</span><br><span class="line">                fixAfterDeletion(replacement);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (p.parent == <span class="keyword">null</span>) &#123; </span><br><span class="line">            root = <span class="keyword">null</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="comment">//6ã€å¦‚æœè¦åˆ é™¤çš„èŠ‚ç‚¹(æœ‰åç»§èŠ‚ç‚¹åˆ™ä¸ºåç»§èŠ‚ç‚¹ä½ç½®)æ²¡æœ‰å­©å­èŠ‚ç‚¹</span></span><br><span class="line">            <span class="comment">//å¦‚æœæ˜¯é»‘è‰²çš„ä¹Ÿåšé¢œè‰²è°ƒæ•´</span></span><br><span class="line">            <span class="keyword">if</span> (p.color == BLACK)</span><br><span class="line">                fixAfterDeletion(p);</span><br><span class="line">            <span class="comment">//7ã€ä»å°†çˆ¶èŠ‚ç‚¹çš„å­©å­èŠ‚ç‚¹å†…å®¹å‰”é™¤æ‰</span></span><br><span class="line">            <span class="keyword">if</span> (p.parent != <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="keyword">if</span> (p == p.parent.left)</span><br><span class="line">                    p.parent.left = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (p == p.parent.right)</span><br><span class="line">                    p.parent.right = <span class="keyword">null</span>;</span><br><span class="line">                p.parent = <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="åˆ é™¤ä¿®æ­£fixAfterDeletion"><a href="#åˆ é™¤ä¿®æ­£fixAfterDeletion" class="headerlink" title="åˆ é™¤ä¿®æ­£fixAfterDeletion"></a>åˆ é™¤ä¿®æ­£fixAfterDeletion</h4><p>å…·ä½“ä»£ç å¦‚ä¸‹ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterDeletion</span><span class="params">(Entry&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (x != root &amp;&amp; colorOf(x) == BLACK) &#123;</span><br><span class="line">        <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; sib = rightOf(parentOf(x));</span><br><span class="line">            <span class="comment">//æƒ…å†µ1:</span></span><br><span class="line">            <span class="keyword">if</span> (colorOf(sib) == RED) &#123;</span><br><span class="line">                <span class="comment">//1ã€å¦‚æœç°åœ¨çš„å…„å¼ŸèŠ‚ç‚¹æ˜¯çº¢è‰²çš„</span></span><br><span class="line">                <span class="comment">//2ã€å°†å…„å¼ŸèŠ‚ç‚¹è®¾ä¸ºé»‘è‰²çš„ï¼Œçˆ¶èŠ‚ç‚¹è®¾ä¸ºçº¢è‰²çš„ã€‚</span></span><br><span class="line">                setColor(sib, BLACK);</span><br><span class="line">                setColor(parentOf(x), RED);</span><br><span class="line">                <span class="comment">//3ã€å·¦æ—‹è¯¥çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">                rotateLeft(parentOf(x));</span><br><span class="line">                sib = rightOf(parentOf(x));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//æƒ…å†µ2:</span></span><br><span class="line">            <span class="keyword">if</span> (colorOf(leftOf(sib))  == BLACK &amp;&amp;</span><br><span class="line">                colorOf(rightOf(sib)) == BLACK) &#123;</span><br><span class="line">                setColor(sib, RED);</span><br><span class="line">                x = parentOf(x);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">if</span> (colorOf(rightOf(sib)) == BLACK) &#123;</span><br><span class="line">                <span class="comment">//æƒ…å†µ3:</span></span><br><span class="line">                    setColor(leftOf(sib), BLACK);</span><br><span class="line">                    setColor(sib, RED);</span><br><span class="line">                    rotateRight(sib);</span><br><span class="line">                    sib = rightOf(parentOf(x));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//æƒ…å†µ4:</span></span><br><span class="line">                setColor(sib, colorOf(parentOf(x)));</span><br><span class="line">                setColor(parentOf(x), BLACK);</span><br><span class="line">                setColor(rightOf(sib), BLACK);</span><br><span class="line">                rotateLeft(parentOf(x));</span><br><span class="line">                x = root;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123; </span><br><span class="line">            <span class="comment">//å¯¹ç§°ï¼Œå¤„ç†ç±»ä¼¼ã€‚            </span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    setColor(x, BLACK);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/TreeMap-1-8/delete.png" alt=""></p>
<h3 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h3><p><a href="https://www.cnblogs.com/CarpenterLee/p/5503882.html" target="_blank" rel="noopener">å²ä¸Šæœ€æ¸…æ™°çš„çº¢é»‘æ ‘è®²è§£</a></p>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> æºç  </tag>
            
            <tag> TreeMap </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[HashMap-1.8ç‰ˆ]]></title>
      <url>/chengasd.github.io/2018/01/28/HashMap-1-8%E7%89%88/</url>
      <content type="html"><![CDATA[<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/HashMap-1-8%E7%89%88/1.jpg" alt=""></p>
<a id="more"></a>
<h2 id="Mapå…³ç³»ç»§æ‰¿å›¾"><a href="#Mapå…³ç³»ç»§æ‰¿å›¾" class="headerlink" title="Mapå…³ç³»ç»§æ‰¿å›¾"></a>Mapå…³ç³»ç»§æ‰¿å›¾</h2><p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/HashMap-1-8%E7%89%88/2.png" alt=""></p>
<h2 id="HashMap-1-8æºç åˆ†æ"><a href="#HashMap-1-8æºç åˆ†æ" class="headerlink" title="HashMap 1.8æºç åˆ†æ"></a>HashMap 1.8æºç åˆ†æ</h2><p>HashMapåœ¨1.8ç‰ˆæœ¬ä¸­æ˜¯æœ‰æ•°ç»„ï¼‹é“¾è¡¨ï¼‹çº¢é»‘æ ‘å®ç°çš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/HashMap-1-8%E7%89%88/3.png" alt=""></p>
<h3 id="æˆå‘˜å˜é‡"><a href="#æˆå‘˜å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡"></a>æˆå‘˜å˜é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ–å®¹é‡ 2çš„å››æ¬¡æ–¹ é»˜è®¤16  </span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br><span class="line"><span class="comment">// æœ€å¤§å®¹é‡å€¼</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"><span class="comment">// åŠ è½½å› å­ é»˜è®¤0.75</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"><span class="comment">// (1.8)ä¸€ä¸ªæ¡¶çš„æ ‘åŒ–é˜ˆå€¼ </span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br><span class="line"><span class="comment">// (1.8)ä¸€ä¸ªæ ‘çš„é“¾è¡¨è¿˜åŸé˜ˆå€¼ å°†çº¢é»‘æ ‘è½¬å˜ä¸ºé“¾è¡¨</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;</span><br><span class="line"><span class="comment">// (1.8)å½“éœ€è¦å°†è§£å†³ hash å†²çªçš„é“¾è¡¨è½¬å˜ä¸ºçº¢é»‘æ ‘æ—¶ï¼Œéœ€è¦åˆ¤æ–­ä¸‹æ­¤æ—¶æ•°ç»„å®¹é‡ï¼Œè‹¥æ˜¯ç”±äºæ•°ç»„å®¹é‡å¤ªå°       </span></span><br><span class="line"><span class="comment">//ï¼ˆå°äºã€€MIN_TREEIFY_CAPACITYã€€ï¼‰å¯¼è‡´çš„ hash å†²çªå¤ªå¤šï¼Œåˆ™ä¸è¿›è¡Œé“¾è¡¨è½¬å˜ä¸ºçº¢é»‘æ ‘æ“ä½œ</span></span><br><span class="line"><span class="comment">// è½¬ä¸ºåˆ©ç”¨resize() å‡½æ•°å¯¹ã€€hashMap æ‰©å®¹</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>;</span><br><span class="line"><span class="comment">// ä¿å­˜Node&lt;K,V&gt;èŠ‚ç‚¹çš„æ•°ç»„</span></span><br><span class="line"><span class="keyword">transient</span> Node&lt;K,V&gt;[] table;</span><br><span class="line"><span class="comment">// ç”±hashMap ä¸­ Node&lt;K,V&gt;ã€€èŠ‚ç‚¹æ„æˆçš„ set</span></span><br><span class="line"><span class="keyword">transient</span> Set&lt;Map.Entry&lt;K,V&gt;&gt; entrySet;</span><br><span class="line"><span class="comment">// k/væ˜ å°„å…³ç³»çš„æ•°é‡</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size; </span><br><span class="line"> <span class="comment">// è¿™ä¸ªHashMapç»“æ„å˜åŒ–(k\væ˜ å°„å…³ç³»æ•°é‡æ”¹å˜ï¼Œæˆ–è€…rehash)çš„æ¬¡æ•°,</span></span><br><span class="line"><span class="comment">// ç”¨æ¥å®ç°HashMapçš„iteratorçš„fail-fastç‰¹ç‚¹</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> modCount; </span><br><span class="line"><span class="comment">// é˜ˆå€¼ ï¼ å®¹é‡ï¼ŠåŠ è½½å› å­ ,å½“HashMapçš„ä¸‹ä¸€ä¸ªå…ƒç´ size&gt;=thresholdæ—¶,ä¼šè¿›è¡Œrehashæ“ä½œ</span></span><br><span class="line"><span class="keyword">int</span> threshold;</span><br><span class="line"><span class="comment">// è®°å½• hashMap è£…è½½å› å­</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br></pre></td></tr></table></figure>
<h3 id="å†…éƒ¨ç±»"><a href="#å†…éƒ¨ç±»" class="headerlink" title="å†…éƒ¨ç±»"></a>å†…éƒ¨ç±»</h3><p><strong>NodeèŠ‚ç‚¹</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> hash;     <span class="comment">//hashå€¼</span></span><br><span class="line">    <span class="keyword">final</span> K key;        <span class="comment">//keyå€¼</span></span><br><span class="line">    V value;            <span class="comment">//valueå€¼</span></span><br><span class="line">    Node&lt;K,V&gt; next;     <span class="comment">//ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="comment">//ä¿å­˜ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¹¶æŒæœ‰æŒ‡å‘ä¸‹ä¸€ä¸ªé”®å€¼å¯¹çš„å¼•ç”¨ï¼Œæ„æˆäº†å•å‘é“¾è¡¨äº†ã€‚</span></span><br><span class="line">    Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">        <span class="keyword">this</span>.hash = hash;</span><br><span class="line">        <span class="keyword">this</span>.key = key;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">        <span class="keyword">this</span>.next = next;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">            Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line">            <span class="keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class="line">                Objects.equals(value, e.getValue()))</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Treenode</strong><br>çº¢é»‘æ ‘ç›¸å…³çš„å­˜å‚¨ç»“æ„</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">TreeNode&lt;K,V&gt; extends LinkedHashMap.Entry&lt;K,V&gt; &#123;</span><br><span class="line">    TreeNode&lt;K,V&gt; parent;  <span class="comment">// å­˜å‚¨å½“å‰èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹</span></span><br><span class="line">    TreeNode&lt;K,V&gt; left;    <span class="comment">// å­˜å‚¨å½“å‰èŠ‚ç‚¹çš„å·¦å­©å­</span></span><br><span class="line">    TreeNode&lt;K,V&gt; right;   <span class="comment">// å­˜å‚¨å½“å‰èŠ‚ç‚¹çš„å³å­©å­</span></span><br><span class="line">    TreeNode&lt;K,V&gt; prev;    <span class="comment">// å­˜å‚¨å½“å‰èŠ‚ç‚¹çš„å‰ä¸€ä¸ªå­©å­</span></span><br><span class="line">    <span class="keyword">boolean</span> red;           <span class="comment">// å­˜å‚¨å½“å‰èŠ‚ç‚¹çš„é¢œè‰²ï¼ˆçº¢ã€é»‘ï¼‰</span></span><br><span class="line">    TreeNode(<span class="keyword">int</span> hash, K key, V val, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">        <span class="keyword">super</span>(hash, key, val, next);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//  è·å–æ ¹èŠ‚ç‚¹</span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> TreeNode&lt;K,V&gt; <span class="title">root</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> &lt;K,V&gt; <span class="function"><span class="keyword">void</span> <span class="title">moveRootToFront</span><span class="params">(Node&lt;K,V&gt;[] tab, TreeNode&lt;K,V&gt; root)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">final</span> TreeNode&lt;K,V&gt; <span class="title">find</span><span class="params">(<span class="keyword">int</span> h, Object k, Class&lt;?&gt; kc)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">final</span> TreeNode&lt;K,V&gt; <span class="title">getTreeNode</span><span class="params">(<span class="keyword">int</span> h, Object k)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">tieBreakOrder</span><span class="params">(Object a, Object b)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">treeify</span><span class="params">(Node&lt;K,V&gt;[] tab)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">final</span> Node&lt;K,V&gt; <span class="title">untreeify</span><span class="params">(HashMap&lt;K,V&gt; map)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// çº¢é»‘æ•°putå…ƒç´ </span></span><br><span class="line">    <span class="function"><span class="keyword">final</span> TreeNode&lt;K,V&gt; <span class="title">putTreeVal</span><span class="params">(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   <span class="keyword">int</span> h, K k, V v)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">removeTreeNode</span><span class="params">(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab,</span></span></span><br><span class="line"><span class="function"><span class="params">                              <span class="keyword">boolean</span> movable)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">split</span><span class="params">(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> index, <span class="keyword">int</span> bit)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// çº¢é»‘æ ‘ç›¸å…³æ“ä½œ   è¯¦è§treemapè®²è§£</span></span><br><span class="line">    <span class="comment">// å·¦æ—‹æ“ä½œ:</span></span><br><span class="line">    <span class="comment">// 1. å°†yçš„å·¦å­èŠ‚ç‚¹èµ‹ç»™xçš„å³å­èŠ‚ç‚¹,å¹¶å°†xèµ‹ç»™yå·¦å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹(yå·¦å­èŠ‚ç‚¹éç©ºæ—¶) </span></span><br><span class="line">    <span class="comment">// 2. å°†xçš„çˆ¶èŠ‚ç‚¹p(éç©ºæ—¶)èµ‹ç»™yçš„çˆ¶èŠ‚ç‚¹ï¼ŒåŒæ—¶æ›´æ–°pçš„å­èŠ‚ç‚¹ä¸ºy(å·¦æˆ–å³) </span></span><br><span class="line">    <span class="comment">// 3. å°†yçš„å·¦å­èŠ‚ç‚¹è®¾ä¸ºxï¼Œå°†xçš„çˆ¶èŠ‚ç‚¹è®¾ä¸ºy </span></span><br><span class="line">    <span class="comment">// å·¦æ—‹ç¤ºæ„å›¾ï¼šå¯¹èŠ‚ç‚¹xè¿›è¡Œå·¦æ—‹ 1ã€x.right = y.left  2ã€y.parent = x.parent , p.left = y 3ã€y.left = x ,x.parent = y</span></span><br><span class="line">    <span class="comment">//      p                       p </span></span><br><span class="line">    <span class="comment">//    /                       / </span></span><br><span class="line">    <span class="comment">//   x                       y </span></span><br><span class="line">    <span class="comment">//  / \                     / \ </span></span><br><span class="line">    <span class="comment">// lx  y      -----&gt;       x  ry </span></span><br><span class="line">    <span class="comment">//    / \                 / \ </span></span><br><span class="line">    <span class="comment">//   ly ry               lx ly </span></span><br><span class="line">    <span class="keyword">static</span> &lt;K,V&gt; <span class="function">TreeNode&lt;K,V&gt; <span class="title">rotateLeft</span><span class="params">(TreeNode&lt;K,V&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">                                          TreeNode&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> &lt;K,V&gt; <span class="function">TreeNode&lt;K,V&gt; <span class="title">rotateRight</span><span class="params">(TreeNode&lt;K,V&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">                                           TreeNode&lt;K,V&gt; p)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> &lt;K,V&gt; <span class="function">TreeNode&lt;K,V&gt; <span class="title">balanceInsertion</span><span class="params">(TreeNode&lt;K,V&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">                                                TreeNode&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> &lt;K,V&gt; <span class="function">TreeNode&lt;K,V&gt; <span class="title">balanceDeletion</span><span class="params">(TreeNode&lt;K,V&gt; root,</span></span></span><br><span class="line"><span class="function"><span class="params">                                               TreeNode&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">static</span> &lt;K,V&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">checkInvariants</span><span class="params">(TreeNode&lt;K,V&gt; t)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ„é€ å‡½æ•°"><a href="#æ„é€ å‡½æ•°" class="headerlink" title="æ„é€ å‡½æ•°"></a>æ„é€ å‡½æ•°</h3><blockquote>
<p>1ã€æŒ‡å®šåˆå§‹å®¹é‡å’ŒåŠ è½½å› å­<br>2ã€æŒ‡å®šåˆå§‹å®¹é‡ï¼Œé‡‡ç”¨é»˜è®¤å› å­<br>3ã€æ‰€æœ‰æ•°æ®éƒ½é‡‡ç”¨é»˜è®¤æ•°æ®</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity, <span class="keyword">float</span> loadFactor)</span> </span>&#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="comment">//è¿”å›æœ€æ¥è¿‘initialCapacityçš„2çš„å¹‚ï¼Œè‹¥æŒ‡å®šåˆå§‹å®¹é‡ä¸ºï¼™ï¼Œåˆ™å®é™… hashMapå®¹é‡ä¸º16*/</span></span><br><span class="line">    <span class="keyword">this</span>.threshold = tableSizeFor(initialCapacity);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">tableSizeFor</span><span class="params">(<span class="keyword">int</span> cap)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = cap - <span class="number">1</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">1</span>;  <span class="comment">//å½“ nï¼8 (1 0 0)æ—¶ï¼Œ &gt;&gt;&gt;1 = 4 (0 1 0) |=12 (1 1 0) </span></span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">2</span>;  <span class="comment">//a|b,å³æŠŠaå’ŒbåšæŒ‰ä½æˆ–   &gt;&gt;&gt;ä»£è¡¨æ— ç¬¦å·å³ç§»</span></span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">4</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">8</span>;</span><br><span class="line">    n |= n &gt;&gt;&gt; <span class="number">16</span>;</span><br><span class="line">    <span class="keyword">return</span> (n &lt; <span class="number">0</span>) ? <span class="number">1</span> : (n &gt;= MAXIMUM_CAPACITY) ? MAXIMUM_CAPACITY : n + <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æˆå‘˜æ–¹æ³•"><a href="#æˆå‘˜æ–¹æ³•" class="headerlink" title="æˆå‘˜æ–¹æ³•"></a>æˆå‘˜æ–¹æ³•</h3><h4 id="putå¢åŠ å…ƒç´ "><a href="#putå¢åŠ å…ƒç´ " class="headerlink" title="putå¢åŠ å…ƒç´ "></a>putå¢åŠ å…ƒç´ </h4><p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/HashMap-1-8%E7%89%88/4.png" alt="putå…ƒç´ æµç¨‹å›¾"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">  <span class="comment">// 1ã€å¢åŠ å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2ã€è®¡ç®—hashå€¼ </span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="comment">// a^b aå¼‚æˆ–b  1^0 ï¼ 1</span></span><br><span class="line">    <span class="comment">//key çš„ hashã€€å€¼çš„è®¡ç®—æ˜¯é€šè¿‡hashCode()çš„é«˜16ä½å¼‚æˆ–ä½16ä½å®ç°çš„ï¼š</span></span><br><span class="line">    <span class="comment">//(h = k.hashCode()) ^ (h &gt;&gt;&gt; 16)ï¼Œä¸»è¦æ˜¯ä»é€Ÿåº¦ã€åŠŸæ•ˆã€è´¨é‡æ¥è€ƒè™‘çš„ï¼Œ</span></span><br><span class="line">    <span class="comment">//è¿™ä¹ˆåšåœ¨æ•°ç»„çš„lengthæ¯”è¾ƒå°çš„æ—¶å€™ï¼Œä¹Ÿèƒ½ä¿è¯è€ƒè™‘åˆ°é«˜ä½Bitéƒ½å‚ä¸åˆ°Hashçš„è®¡ç®—ä¸­ï¼ŒåŒæ—¶ä¸ä¼šæœ‰å¤ªå¤§çš„å¼€é”€</span></span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3ã€å¢åŠ å…ƒç´  onlyIfAbsent ï¼trueæ—¶ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¸æ”¹å˜å·²æœ‰å…ƒç´ å€¼ã€‚</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">boolean</span> onlyIfAbsent,</span></span></span><br><span class="line"><span class="function"><span class="params">               <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    Node&lt;K,V&gt;[] tab; Node&lt;K,V&gt; p; <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="comment">// tabä¸ºç©ºæ—¶åˆ™åˆ›å»º</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">// 4ã€è®¡ç®—æ’å…¥çš„æ•°ç»„ä¸‹æ ‡ iï¼ (n - 1) &amp; hash ï¼ŒæŒ‰ä½ä¸è¿ç®—  ä¸ºä»€ä¹ˆä¸æ˜¯ï¼…nå–è†œè¿ç®—ï¼Ÿ</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        <span class="comment">// å¦‚æœè¯¥æ•°ç»„ä¸‹æœªæœ‰èŠ‚ç‚¹ï¼Œç›´æ¥æ–°å»º</span></span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        Node&lt;K,V&gt; e; K k;</span><br><span class="line">        <span class="comment">// 5.1ã€æ•°ç»„ä¸‹æœ‰èŠ‚ç‚¹ ï¼Œåˆ¤æ–­keyæ˜¯å¦ç­‰äºå¤´èŠ‚ç‚¹p ï¼Œç›´æ¥è¦†ç›–ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">// 5.2ã€å¦‚æœä¸ºçº¢é»‘æ ‘æ—¶</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            e = ((TreeNode&lt;K,V&gt;)p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 5.3ã€å½“ä¸ºå•å‘é“¾è¡¨æ—¶</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    <span class="comment">// æ’å…¥è¯¥å…ƒç´ </span></span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="comment">// é“¾è¡¨é•¿åº¦å¤§äº8è½¬æ¢ä¸ºçº¢é»‘æ ‘è¿›è¡Œå¤„ç†</span></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">// keyå·²ç»å­˜åœ¨ç›´æ¥è¦†ç›–value</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 6ã€å¾…æ’å…¥çš„å…ƒç´ å·²ç»å­˜åœ¨ onlyIfAbsent åˆ¤æ–­æ˜¯å¦éœ€è¦è¦†ç›–å€¼ ï¼Œ trueä¸ºä¸è¦†ç›–</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// modCountï¼‹ï¼‹ åŒ1.7 ç”¨äºåˆ¤æ–­å¤šçº¿ç¨‹ä¸‹å¿«é€Ÿå¤±è´¥</span></span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="comment">// è¶…è¿‡å®¹é‡ å°±æ‰©å®¹</span></span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        resize();</span><br><span class="line">    <span class="comment">// æ’å…¥åå›è°ƒ</span></span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 7ã€åœ¨çº¢é»‘æ ‘å¢åŠ å…ƒç´ </span></span><br><span class="line"><span class="function"><span class="keyword">final</span> TreeNode&lt;K,V&gt; <span class="title">putTreeVal</span><span class="params">(HashMap&lt;K,V&gt; map, Node&lt;K,V&gt;[] tab,</span></span></span><br><span class="line"><span class="function"><span class="params">                                   <span class="keyword">int</span> h, K k, V v)</span> </span>&#123;</span><br><span class="line">        Class&lt;?&gt; kc = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">boolean</span> searched = <span class="keyword">false</span>;</span><br><span class="line">        TreeNode&lt;K,V&gt; root = (parent != <span class="keyword">null</span>) ? root() : <span class="keyword">this</span>;</span><br><span class="line">        <span class="comment">//7.1ã€ä»æ ¹èŠ‚ç‚¹æŸ¥æ‰¾åˆé€‚çš„æ’å…¥ä½ç½®</span></span><br><span class="line">        <span class="keyword">for</span> (TreeNode&lt;K,V&gt; p = root;;) &#123;</span><br><span class="line">            <span class="keyword">int</span> dir, ph; K pk;</span><br><span class="line">            <span class="keyword">if</span> ((ph = p.hash) &gt; h)</span><br><span class="line">                dir = -<span class="number">1</span>;   <span class="comment">//7.2ã€ dirå°äº0 ï¼Œ æ¥ä¸‹æ¥æŸ¥æ‰¾å½“å‰èŠ‚ç‚¹å·¦å­©å­</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (ph &lt; h)</span><br><span class="line">                dir = <span class="number">1</span>;    <span class="comment">//7.2ã€ dirå¤§äº0 ï¼Œ æ¥ä¸‹æ¥æŸ¥æ‰¾å½“å‰èŠ‚ç‚¹å³å­©å­</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((pk = p.key) == k || (k != <span class="keyword">null</span> &amp;&amp; k.equals(pk)))</span><br><span class="line">                <span class="comment">//7.2ã€ ä»£è¡¨hash å€¼ç›¸åŒï¼Œkeyå€¼ç›¸åŒ</span></span><br><span class="line">                <span class="keyword">return</span> p;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> ((kc == <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">                      (kc = comparableClassFor(k)) == <span class="keyword">null</span>) ||</span><br><span class="line">                     (dir = compareComparables(kc, k, pk)) == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">/*  æ»¡è¶³ä¸€ä¸‹å‡ ç‚¹</span></span><br><span class="line"><span class="comment">                1ã€å½“å‰èŠ‚ç‚¹ä¸å¾…æ’å…¥èŠ‚ç‚¹ã€€keyã€€ä¸åŒ,ã€€hash å€¼ç›¸åŒ</span></span><br><span class="line"><span class="comment">                2ã€ï½‹æ˜¯ä¸å¯æ¯”è¾ƒçš„ï¼Œå³ï½‹å¹¶æœªå®ç°ã€€comparable&lt;K&gt;ã€€æ¥å£</span></span><br><span class="line"><span class="comment">                ï¼ˆè‹¥ k å®ç°äº†comparable&lt;K&gt;ã€€æ¥å£ï¼ŒcomparableClassForï¼ˆkï¼‰è¿”å›çš„æ˜¯ï½‹çš„ã€€class,è€Œä¸æ˜¯ã€€nullï¼‰</span></span><br><span class="line"><span class="comment">               3ã€æˆ–è€…ã€€compareComparables(kc, k, pk)ã€€è¿”å›å€¼ä¸º 0</span></span><br><span class="line"><span class="comment">ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€(pk ä¸ºç©ºæˆ–è€…æŒ‰ç…§ k.compareTo(pk) è¿”å›å€¼ä¸ºï¼ï¼Œå¯èƒ½æ˜¯ç”±äºã€€ï½‹çš„compareTo æ–¹æ³•å®ç°ä¸å½“å¼•èµ·çš„ï¼Œ</span></span><br><span class="line"><span class="comment">ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€ã€€compareTo åˆ¤å®šç›¸ç­‰ï¼Œè€Œä¸Šä¸ª else ifã€€ä¸­ã€€equals åˆ¤å®šä¸ç­‰)*/</span></span><br><span class="line">                <span class="keyword">if</span> (!searched) &#123;</span><br><span class="line">                <span class="comment">//åœ¨ä»¥å½“å‰èŠ‚ç‚¹ä¸ºæ ¹çš„æ•´ä¸ªæ ‘ä¸Šæœç´¢æ˜¯å¦å­˜åœ¨å¾…æ’å…¥èŠ‚ç‚¹ï¼ˆåªä¼šæœç´¢ä¸€æ¬¡ï¼‰</span></span><br><span class="line">                    TreeNode&lt;K,V&gt; q, ch;</span><br><span class="line">                    searched = <span class="keyword">true</span>;</span><br><span class="line">                    <span class="keyword">if</span> (((ch = p.left) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">                         (q = ch.find(h, k, kc)) != <span class="keyword">null</span>) ||</span><br><span class="line">                        ((ch = p.right) != <span class="keyword">null</span> &amp;&amp;</span><br><span class="line">                         (q = ch.find(h, k, kc)) != <span class="keyword">null</span>))</span><br><span class="line">                         <span class="comment">//è‹¥æ ‘ä¸­å­˜åœ¨å¾…æ’å…¥èŠ‚ç‚¹ï¼Œç›´æ¥è¿”å›</span></span><br><span class="line">                        <span class="keyword">return</span> q;</span><br><span class="line">                &#125;</span><br><span class="line">                dir = tieBreakOrder(k, pk);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            TreeNode&lt;K,V&gt; xp = p;</span><br><span class="line">            <span class="keyword">if</span> ((p = (dir &lt;= <span class="number">0</span>) ? p.left : p.right) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                <span class="comment">//8ã€æ‰¾åˆ°äº†å¾…æ’å…¥çš„ä½ç½®ï¼Œxp ä¸ºå¾…æ’å…¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ï¼ŒTreeNodeèŠ‚ç‚¹ä¸­æ—¢å­˜åœ¨æ ‘çŠ¶å…³ç³»ï¼Œä¹Ÿå­˜åœ¨é“¾å¼å…³ç³»ï¼Œå¹¶ä¸”æ˜¯åŒç«¯é“¾è¡¨</span></span><br><span class="line">                Node&lt;K,V&gt; xpn = xp.next;</span><br><span class="line">                TreeNode&lt;K,V&gt; x = map.newTreeNode(h, k, v, xpn);</span><br><span class="line">                <span class="keyword">if</span> (dir &lt;= <span class="number">0</span>)</span><br><span class="line">                    xp.left = x;  <span class="comment">// xpèŠ‚ç‚¹çš„å·¦å­©å­å®šä¹‰ä¸ºx</span></span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    xp.right = x;</span><br><span class="line">                xp.next = x;</span><br><span class="line">                x.parent = x.prev = xp;</span><br><span class="line">                <span class="keyword">if</span> (xpn != <span class="keyword">null</span>)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)xpn).prev = x;</span><br><span class="line">                <span class="comment">//9ã€æ’å…¥èŠ‚ç‚¹åè¿›è¡ŒäºŒå‰æ ‘çš„å¹³è¡¡æ“ä½œ</span></span><br><span class="line">                moveRootToFront(tab, balanceInsertion(root, x));</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<h4 id="resizeæ–¹æ³•"><a href="#resizeæ–¹æ³•" class="headerlink" title="resizeæ–¹æ³•"></a>resizeæ–¹æ³•</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">final</span> Node&lt;K,V&gt;[] resize() &#123;</span><br><span class="line">    Node&lt;K,V&gt;[] oldTab = table;</span><br><span class="line">    <span class="keyword">int</span> oldCap = (oldTab == <span class="keyword">null</span>) ? <span class="number">0</span> : oldTab.length;</span><br><span class="line">    <span class="keyword">int</span> oldThr = threshold;</span><br><span class="line">    <span class="keyword">int</span> newCap, newThr = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (oldCap &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (oldCap &gt;= MAXIMUM_CAPACITY) &#123;</span><br><span class="line">            threshold = Integer.MAX_VALUE;</span><br><span class="line">            <span class="keyword">return</span> oldTab;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> ((newCap = oldCap &lt;&lt; <span class="number">1</span>) &lt; MAXIMUM_CAPACITY &amp;&amp;</span><br><span class="line">                 oldCap &gt;= DEFAULT_INITIAL_CAPACITY)</span><br><span class="line">            newThr = oldThr &lt;&lt; <span class="number">1</span>; <span class="comment">// double threshold</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (oldThr &gt; <span class="number">0</span>) <span class="comment">// initial capacity was placed in threshold</span></span><br><span class="line">        newCap = oldThr;</span><br><span class="line">    <span class="keyword">else</span> &#123;               <span class="comment">// zero initial threshold signifies using defaults</span></span><br><span class="line">        newCap = DEFAULT_INITIAL_CAPACITY;</span><br><span class="line">        newThr = (<span class="keyword">int</span>)(DEFAULT_LOAD_FACTOR * DEFAULT_INITIAL_CAPACITY);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (newThr == <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">float</span> ft = (<span class="keyword">float</span>)newCap * loadFactor;</span><br><span class="line">        newThr = (newCap &lt; MAXIMUM_CAPACITY &amp;&amp; ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY ?</span><br><span class="line">                  (<span class="keyword">int</span>)ft : Integer.MAX_VALUE);</span><br><span class="line">    &#125;</span><br><span class="line">    threshold = newThr;</span><br><span class="line">    <span class="meta">@SuppressWarnings</span>(&#123;<span class="string">"rawtypes"</span>,<span class="string">"unchecked"</span>&#125;)</span><br><span class="line">        Node&lt;K,V&gt;[] newTab = (Node&lt;K,V&gt;[])<span class="keyword">new</span> Node[newCap];</span><br><span class="line">    table = newTab;</span><br><span class="line">    <span class="keyword">if</span> (oldTab != <span class="keyword">null</span>) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; oldCap; ++j) &#123;</span><br><span class="line">            Node&lt;K,V&gt; e;</span><br><span class="line">            <span class="keyword">if</span> ((e = oldTab[j]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">                oldTab[j] = <span class="keyword">null</span>;</span><br><span class="line">                <span class="keyword">if</span> (e.next == <span class="keyword">null</span>)</span><br><span class="line">                    newTab[e.hash &amp; (newCap - <span class="number">1</span>)] = e;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (e <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">                    ((TreeNode&lt;K,V&gt;)e).split(<span class="keyword">this</span>, newTab, j, oldCap);</span><br><span class="line">                <span class="keyword">else</span> &#123; <span class="comment">// preserve order</span></span><br><span class="line">                    Node&lt;K,V&gt; loHead = <span class="keyword">null</span>, loTail = <span class="keyword">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; hiHead = <span class="keyword">null</span>, hiTail = <span class="keyword">null</span>;</span><br><span class="line">                    Node&lt;K,V&gt; next;</span><br><span class="line">                    <span class="keyword">do</span> &#123;</span><br><span class="line">                        next = e.next;</span><br><span class="line">                        <span class="keyword">if</span> ((e.hash &amp; oldCap) == <span class="number">0</span>) &#123;</span><br><span class="line">                            <span class="keyword">if</span> (loTail == <span class="keyword">null</span>)</span><br><span class="line">                                loHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                loTail.next = e;</span><br><span class="line">                            loTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">else</span> &#123;</span><br><span class="line">                            <span class="keyword">if</span> (hiTail == <span class="keyword">null</span>)</span><br><span class="line">                                hiHead = e;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                hiTail.next = e;</span><br><span class="line">                            hiTail = e;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125; <span class="keyword">while</span> ((e = next) != <span class="keyword">null</span>);</span><br><span class="line">                    <span class="keyword">if</span> (loTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        loTail.next = <span class="keyword">null</span>;</span><br><span class="line">                        newTab[j] = loHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span> (hiTail != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        hiTail.next = <span class="keyword">null</span>;</span><br><span class="line">                        newTab[j + oldCap] = hiHead;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> newTab;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="treeifyBinæ–¹æ³•è½¬çº¢é»‘æ•°"><a href="#treeifyBinæ–¹æ³•è½¬çº¢é»‘æ•°" class="headerlink" title="treeifyBinæ–¹æ³•è½¬çº¢é»‘æ•°"></a>treeifyBinæ–¹æ³•è½¬çº¢é»‘æ•°</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">treeifyBin</span><span class="params">(Node&lt;K,V&gt;[] tab, <span class="keyword">int</span> hash)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n, index; Node&lt;K,V&gt; e;</span><br><span class="line">    <span class="comment">//å¦‚æœæ•°ç»„é•¿åº¦å°äº64 åªæ˜¯æ‰©å®¹ï¼Œä¸ä¼šè½¬æˆçº¢é»‘æ•°</span></span><br><span class="line">    <span class="keyword">if</span> (tab == <span class="keyword">null</span> || (n = tab.length) &lt; MIN_TREEIFY_CAPACITY)</span><br><span class="line">        resize();</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> ((e = tab[index = (n - <span class="number">1</span>) &amp; hash]) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        TreeNode&lt;K,V&gt; hd = <span class="keyword">null</span>, tl = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="comment">//å°†è¯¥èŠ‚ç‚¹è½¬æ¢ä¸ºæ•°èŠ‚ç‚¹</span></span><br><span class="line">            TreeNode&lt;K,V&gt; p = replacementTreeNode(e, <span class="keyword">null</span>);</span><br><span class="line">            <span class="keyword">if</span> (tl == <span class="keyword">null</span>)     <span class="comment">//ç¡®å®šå¤´èŠ‚ç‚¹</span></span><br><span class="line">                hd = p;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                p.prev = tl;</span><br><span class="line">                tl.next = p;</span><br><span class="line">            &#125;</span><br><span class="line">            tl = p;</span><br><span class="line">        &#125; <span class="keyword">while</span> ((e = e.next) != <span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//è®©æ¡¶çš„ç¬¬ä¸€ä¸ªå…ƒç´ æŒ‡å‘æ–°å»ºçš„çº¢é»‘æ ‘å¤´ç»“ç‚¹ï¼Œä»¥åè¿™ä¸ªæ¡¶é‡Œçš„å…ƒç´ å°±æ˜¯çº¢é»‘æ ‘è€Œä¸æ˜¯é“¾è¡¨äº†</span></span><br><span class="line">        <span class="keyword">if</span> ((tab[index] = hd) != <span class="keyword">null</span>)</span><br><span class="line">            hd.treeify(tab);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="å‚è€ƒ"><a href="#å‚è€ƒ" class="headerlink" title="å‚è€ƒ"></a>å‚è€ƒ</h2><p><a href="https://tech.meituan.com/java-hashmap.html" target="_blank" rel="noopener">ç¾å›¢ï¼Java 8ç³»åˆ—ä¹‹é‡æ–°è®¤è¯†HashMap</a></p>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> æºç  </tag>
            
            <tag> HashMap </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[HashMap-1.7ç‰ˆ]]></title>
      <url>/chengasd.github.io/2018/01/11/HashMap-1-7/</url>
      <content type="html"><![CDATA[<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/HashMap-1-7/1.jpg" alt=""></p>
<h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><p>1ã€HashMapæ˜¯åŸºäºæ•°ç»„+é“¾è¡¨çš„ç»“æ„ç»„æˆã€‚<br>æ•°ç»„çš„ç‰¹ç‚¹ï¼šè¿ç»­ç©ºé—´ï¼Œå¯»å€è¿…é€Ÿï¼Œä½†æ˜¯åœ¨åˆ é™¤æˆ–è€…æ·»åŠ å…ƒç´ çš„æ—¶å€™éœ€è¦æœ‰è¾ƒå¤§å¹…åº¦çš„ç§»åŠ¨ï¼Œæ‰€ä»¥æŸ¥è¯¢é€Ÿåº¦å¿«ï¼Œå¢åˆ è¾ƒæ…¢ã€‚<br>é“¾è¡¨çš„ç‰¹ç‚¹ï¼šç©ºé—´ä¸è¿ç»­ï¼Œå¯»å€å›°éš¾ï¼Œå¢åˆ å…ƒç´ åªéœ€ä¿®æ”¹æŒ‡é’ˆï¼Œæ‰€ä»¥æŸ¥è¯¢æ…¢ã€å¢åˆ å¿«ã€‚<br>2ã€HashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼ŒHashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œä½†é€šè¿‡synchronizedå…³é”®å­—å®ç°ï¼Œæ•ˆç‡ä¸é«˜ã€‚<br>3ã€HashMapçš„é”®å’Œå€¼éƒ½å…è®¸æœ‰nullå€¼å­˜åœ¨ï¼Œè€ŒHashTableåˆ™ä¸è¡Œã€‚<br>4ã€HashMapç»§æ‰¿è‡ªAbstractMap<k,v>ï¼Œè€ŒHashTableç»§æ‰¿è‡ªDictionary<k,v><br><a id="more"></a></k,v></k,v></p>
<p>æ¨èä¸€ä¸ªåœ¨çº¿æ•°æ®ç»“æ„æ“ä½œåŠ¨ç”»å›¾çš„è¿æ¥<br><a href="https://www.cs.usfca.edu/~galles/visualization/OpenHash.html" target="_blank" rel="noopener">https://www.cs.usfca.edu/~galles/visualization/OpenHash.html</a><br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/HashMap-1-7/2.jpg" alt=""></p>
<h3 id="æˆå‘˜å˜é‡"><a href="#æˆå‘˜å˜é‡" class="headerlink" title="æˆå‘˜å˜é‡"></a>æˆå‘˜å˜é‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// The default initial capacity - MUST be a power of two.</span></span><br><span class="line"><span class="comment">// åˆå§‹åŒ–å®¹é‡ 2çš„å››æ¬¡æ–¹ é»˜è®¤16  whyå¿…é¡»ä¸º2çš„æ¬¡å¹‚ï¼Ÿ ä¸ºäº†ä¿è¯è®¡ç®—æ•°ç»„ä¸‹æ ‡å€¼çš„ä½é‡å¤ç‡ã€‚</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br><span class="line"><span class="comment">// æœ€å¤§å®¹é‡å€¼</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"><span class="comment">// åŠ è½½å› å­ é»˜è®¤0.75</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"><span class="comment">// Entryæ•°ç»„ï¼Œè€ŒEntryæœ¬èº«å®ç°äº†é“¾è¡¨ ï¼Œ æ‰€ä»¥hashMapæœ¬è´¨å°±æ˜¯æ•°ç»„ï¼‹é“¾è¡¨</span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">final</span> Entry&lt;?,?&gt;[] EMPTY_TABLE = &#123;&#125;;</span><br><span class="line"><span class="keyword">transient</span> Entry&lt;K,V&gt;[] table = (Entry&lt;K,V&gt;[]) EMPTY_TABLE;</span><br><span class="line"><span class="comment">// k/væ˜ å°„å…³ç³»çš„æ•°é‡</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> size;</span><br><span class="line"><span class="comment">// é˜ˆå€¼ ï¼ å®¹é‡ï¼ŠåŠ è½½å› å­ ,å½“HashMapçš„ä¸‹ä¸€ä¸ªå…ƒç´ size&gt;=thresholdæ—¶,ä¼šè¿›è¡Œrehashæ“ä½œ</span></span><br><span class="line"><span class="keyword">int</span> threshold;</span><br><span class="line"><span class="comment">// è®°å½• hashMap è£…è½½å› å­</span></span><br><span class="line"><span class="keyword">final</span> <span class="keyword">float</span> loadFactor;</span><br><span class="line"><span class="comment">// è¿™ä¸ªHashMapç»“æ„å˜åŒ–(k\væ˜ å°„å…³ç³»æ•°é‡æ”¹å˜ï¼Œæˆ–è€…rehash)çš„æ¬¡æ•°,</span></span><br><span class="line"><span class="comment">// ç”¨æ¥å®ç°HashMapçš„iteratorçš„fail-fastç‰¹ç‚¹</span></span><br><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br></pre></td></tr></table></figure>
<h3 id="Entryå†…éƒ¨ç±»"><a href="#Entryå†…éƒ¨ç±»" class="headerlink" title="Entryå†…éƒ¨ç±»"></a>Entryå†…éƒ¨ç±»</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">    <span class="keyword">final</span> K key;        <span class="comment">// keyå€¼</span></span><br><span class="line">    V value;            <span class="comment">// valueå€¼</span></span><br><span class="line">    Entry&lt;K,V&gt; next;    <span class="comment">// ä¸‹ä¸€ä¸ªå…ƒç´ </span></span><br><span class="line">    <span class="keyword">int</span> hash;           <span class="comment">// hashå€¼</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//Map.Entryä¿å­˜ä¸€ä¸ªé”®å€¼å¯¹ï¼Œå¹¶æŒæœ‰æŒ‡å‘ä¸‹ä¸€ä¸ªé”®å€¼å¯¹çš„å¼•ç”¨ï¼Œæ„æˆäº†å•å‘é“¾è¡¨äº†ã€‚</span></span><br><span class="line">    Entry(<span class="keyword">int</span> h, K k, V v, Entry&lt;K,V&gt; n) &#123;</span><br><span class="line">        value = v;</span><br><span class="line">        next = n;</span><br><span class="line">        key = k;</span><br><span class="line">        hash = h;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æˆå‘˜æ–¹æ³•"><a href="#æˆå‘˜æ–¹æ³•" class="headerlink" title="æˆå‘˜æ–¹æ³•"></a>æˆå‘˜æ–¹æ³•</h3><h4 id="putå¢åŠ å…ƒç´ "><a href="#putå¢åŠ å…ƒç´ " class="headerlink" title="putå¢åŠ å…ƒç´ "></a>putå¢åŠ å…ƒç´ </h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (table == EMPTY_TABLE) &#123;</span><br><span class="line">        inflateTable(threshold);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">return</span> putForNullKey(value);</span><br><span class="line">    <span class="comment">// 1 è®¡ç®—keyå¯¹åº”çš„hashå€¼</span></span><br><span class="line">    <span class="keyword">int</span> hash = hash(key);</span><br><span class="line">    <span class="comment">// 2 é€šè¿‡hashå€¼&amp;table.length-1è·å¾—è¯¥keyå­˜æ”¾tableä¸­çš„bucketIndex</span></span><br><span class="line">    <span class="keyword">int</span> i = indexFor(hash, table.length);</span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e = table[i]; e != <span class="keyword">null</span>; e = e.next) &#123;</span><br><span class="line">        Object k;</span><br><span class="line">        <span class="comment">// 3 åˆ¤æ–­åŒä¸€ä¸ªæ•°ç»„ä¸‹æ ‡çš„é“¾è¡¨ä¸­çš„keyå…ƒç´ æ˜¯å¦ä¸€è‡´ï¼Œä¸€è‡´åˆ™æ›¿æ¢valyeå€¼ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (e.hash == hash &amp;&amp; ((k = e.key) == key || key.equals(k))) &#123;</span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            e.value = value;</span><br><span class="line">            e.recordAccess(<span class="keyword">this</span>);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 4ã€Mapç»“æ„å˜åŒ–æ¬¡æ•°ç´¯è®¡,fail-fastçš„å®ç°ã€‚  </span></span><br><span class="line">    <span class="comment">// å¦‚æœå¤šä¸ªçº¿ç¨‹è®¿é—®ï¼Œå¾—åˆ°Iteratoråï¼Œå½“å‘ç°modCountå˜åŒ–ï¼ŒæŠ›å‡ºConcurrentModificationException</span></span><br><span class="line">    modCount++;</span><br><span class="line">    <span class="comment">// 5ã€å¦‚æœæ²¡æœ‰è¿™ä¸ªkey  åˆ™æ’å…¥è¯¥å…ƒç´ </span></span><br><span class="line">    addEntry(hash, key, value, i);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 6ã€åˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜€å€¼ï¼Œè¶…è¿‡åˆ™æ‰©å®¹ï¼Œé‡æ–°è®¡ç®—ä¸‹æ ‡</span></span><br><span class="line">    <span class="keyword">if</span> ((size &gt;= threshold) &amp;&amp; (<span class="keyword">null</span> != table[bucketIndex])) &#123;</span><br><span class="line">        resize(<span class="number">2</span> * table.length);</span><br><span class="line">        hash = (<span class="keyword">null</span> != key) ? hash(key) : <span class="number">0</span>;</span><br><span class="line">        bucketIndex = indexFor(hash, table.length);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 7ã€åœ¨æ•°ç»„[bucketIndexï¼½çš„é“¾è¡¨ä¸ŠåŠ å…¥è¯¥keyï¼valueå€¼</span></span><br><span class="line">    createEntry(hash, key, value, bucketIndex);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—æ•°ç»„ä¸‹æ ‡ hï¼hashå€¼ length ï¼ å½“å‰æ•°ç»„çš„é•¿åº¦</span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">int</span> <span class="title">indexFor</span><span class="params">(<span class="keyword">int</span> h, <span class="keyword">int</span> length)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// h&amp; (length-1)è¿ç®—ç­‰ä»·äºå¯¹lengthï¼1 å–æ¨¡</span></span><br><span class="line">    <span class="keyword">return</span> h &amp; (length-<span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¢åŠ ç»“ç‚¹ï¼Œæ€»æ˜¯ä»é“¾è¡¨çš„è¡¨å¤´å¤„æ’å…¥æ–°ç»“ç‚¹ </span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">createEntry</span><span class="params">(<span class="keyword">int</span> hash, K key, V value, <span class="keyword">int</span> bucketIndex)</span> </span>&#123;</span><br><span class="line">    Entry&lt;K,V&gt; e = table[bucketIndex];</span><br><span class="line">    table[bucketIndex] = <span class="keyword">new</span> Entry&lt;&gt;(hash, key, value, e);</span><br><span class="line">    size++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="rehashé‡å»ºæ“ä½œ"><a href="#rehashé‡å»ºæ“ä½œ" class="headerlink" title="rehashé‡å»ºæ“ä½œ"></a>rehashé‡å»ºæ“ä½œ</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1ã€newCapacity æ–°å®¹é‡ ï¼åŸæ¥çš„å®¹é‡ï¼Š2 ï¼Œå³ç¿»å€</span></span><br><span class="line"><span class="comment">// 2ã€æŠŠoldTableé‡Œçš„å…ƒç´ æ‹·è´åˆ° newTable ï¼Œå¹¶èµ‹å€¼åˆ°tableä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">resize</span><span class="params">(<span class="keyword">int</span> newCapacity)</span> </span>&#123;</span><br><span class="line">    Entry[] oldTable = table;</span><br><span class="line">    <span class="keyword">int</span> oldCapacity = oldTable.length;</span><br><span class="line">    <span class="keyword">if</span> (oldCapacity == MAXIMUM_CAPACITY) &#123;</span><br><span class="line">        threshold = Integer.MAX_VALUE;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    Entry[] newTable = <span class="keyword">new</span> Entry[newCapacity];</span><br><span class="line">    transfer(newTable, initHashSeedAsNeeded(newCapacity));</span><br><span class="line">    table = newTable;</span><br><span class="line">    threshold = (<span class="keyword">int</span>)Math.min(newCapacity * loadFactor, MAXIMUM_CAPACITY + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—hashå€¼</span></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">initHashSeedAsNeeded</span><span class="params">(<span class="keyword">int</span> capacity)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">boolean</span> currentAltHashing = hashSeed != <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">boolean</span> useAltHashing = sun.misc.VM.isBooted() &amp;&amp;</span><br><span class="line">            (capacity &gt;= Holder.ALTERNATIVE_HASHING_THRESHOLD);</span><br><span class="line">    <span class="keyword">boolean</span> switching = currentAltHashing ^ useAltHashing;</span><br><span class="line">    <span class="keyword">if</span> (switching) &#123;</span><br><span class="line">        hashSeed = useAltHashing ? sun.misc.Hashing.randomHashSeed(<span class="keyword">this</span>): <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> switching;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 1ã€é‡æ–°ä¿å­˜åŸæ¥tableä¸­çš„å…ƒç´ åˆ°newTableä¸­</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">transfer</span><span class="params">(Entry[] newTable, <span class="keyword">boolean</span> rehash)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> newCapacity = newTable.length;</span><br><span class="line">    <span class="comment">// 2ã€éå†tableæ•°ç»„</span></span><br><span class="line">    <span class="keyword">for</span> (Entry&lt;K,V&gt; e : table) &#123;</span><br><span class="line">        <span class="comment">// 3ã€éå†æ•°ç»„å¯¹åº”çš„å•å‘é“¾è¡¨ä¸­çš„å…ƒç´ </span></span><br><span class="line">        <span class="keyword">while</span>(<span class="keyword">null</span> != e) &#123;</span><br><span class="line">            Entry&lt;K,V&gt; next = e.next;</span><br><span class="line">            <span class="comment">// 4ã€æ˜¯å¦éœ€è¦é‡æ–°è®¡ç®—hashå€¼</span></span><br><span class="line">            <span class="keyword">if</span> (rehash) &#123;</span><br><span class="line">                e.hash = <span class="keyword">null</span> == e.key ? <span class="number">0</span> : hash(e.key);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// 5ã€é‡æ–°è®¡ç®—è¯¥å…ƒç´ å¯¹åº”çš„æ–°æ•°ç»„ä¸‹æ ‡</span></span><br><span class="line">            <span class="keyword">int</span> i = indexFor(e.hash, newCapacity);</span><br><span class="line">            <span class="comment">// 6.1ã€newTable[i]==nullè¡¨ç¤ºé¦–æ¬¡è¿›å…¥è¿™ä¸ªæ¡¶,é‚£ä¹ˆæ¸…ç©ºe.nextçš„å¼•ç”¨ã€‚</span></span><br><span class="line">            <span class="comment">// 6.2ã€newTable[i]!=nullè¡¨ç¤ºè¿™ä¸ªæ¡¶å·²ç»æ”¾å…¥äº†å…ƒç´ ï¼Œé‚£ä¹ˆå¼€å§‹å½¢æˆé“¾è¡¨ã€‚å¹¶ä¸”å‡†å¤‡æŠŠé¦–ç»“ç‚¹åç§»ï¼Œä»å¤´éƒ¨æ’å…¥ä¸€ä¸ªæ–°ç»“ç‚¹</span></span><br><span class="line">            <span class="comment">// ä¼šå‡ºç°æ­»å¾ªç¯ å³ç¯é“¾è¡¨ï¼</span></span><br><span class="line">            e.next = newTable[i];</span><br><span class="line">            newTable[i] = e;</span><br><span class="line">            e = next;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<img src="/chengasd.github.io/2018/01/11/HashMap-1-7/HashMap01.jpg">
<p>å¤šçº¿ç¨‹ä¸‹å½¢æˆç¯é“¾è¡¨çš„æ­¥éª¤å¯è§ï¼š<br><a href="https://coolshell.cn/articles/9606.html" target="_blank" rel="noopener">https://coolshell.cn/articles/9606.html</a></p>
<h4 id="Fast-failæœºåˆ¶ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰"><a href="#Fast-failæœºåˆ¶ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰" class="headerlink" title="Fast-failæœºåˆ¶ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰"></a>Fast-failæœºåˆ¶ï¼ˆå¿«é€Ÿå¤±è´¥ï¼‰</h4><p>åœ¨éå†è¿‡ç¨‹ä¸­ï¼Œåˆ¤æ–­modCountè·ŸexpectedModCountæ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰å°±è¡¨ç¤ºå·²ç»æœ‰å…¶ä»–çº¿ç¨‹ä¿®æ”¹äº†ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">HashIterator() &#123;</span><br><span class="line">        expectedModCount = modCount;</span><br><span class="line">        <span class="keyword">if</span> (size &gt; <span class="number">0</span>) &#123; <span class="comment">// advance to first entry</span></span><br><span class="line">            Entry[] t = table;</span><br><span class="line">            <span class="keyword">while</span> (index &lt; t.length &amp;&amp; (next = t[index++]) == <span class="keyword">null</span>)</span><br><span class="line">                ;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;  </span><br><span class="line"><span class="function"><span class="keyword">final</span> Entry&lt;K,V&gt; <span class="title">nextEntry</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (modCount != expectedModCount)</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> ConcurrentModificationException();</span><br><span class="line">        ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h3><blockquote>
<p>1ã€å½“ä¸¤ä¸ªä¸åŒçš„é”®å¯¹è±¡çš„hashcodeç›¸åŒæ—¶ä¼šæ€æ ·ï¼Ÿ </p>
</blockquote>
<p>å®ƒä»¬ä¼šå‚¨å­˜åœ¨åŒä¸€ä¸ªæ•°ç»„ä¸‹æ ‡ä½ç½®çš„å•å‘é“¾è¡¨ä¸­ï¼ŒååŠ å…¥çš„ä¸ºå¤´å…ƒç´ ã€‚</p>
<blockquote>
<p>2ã€å¦‚æœä¸¤ä¸ªé”®çš„hashcodeç›¸åŒï¼Œä½ å¦‚ä½•è·å–å€¼å¯¹è±¡ï¼Ÿ</p>
</blockquote>
<p>HashMapä¼šä½¿ç”¨é”®å¯¹è±¡çš„hashcodeæ‰¾åˆ°bucketä¸‹æ ‡ä½ç½®ï¼Œå†è°ƒç”¨keys.equals()æ–¹æ³•å»æ‰¾åˆ°é“¾è¡¨ä¸­æ­£ç¡®çš„èŠ‚ç‚¹ã€‚</p>
<blockquote>
<p>3ã€ä»€ä¹ˆæ˜¯ç¢°æ’</p>
</blockquote>
<p>å¦‚æœå‡ºç°äº†é‡å¤çš„hashCodeï¼Œå°±ç§°ä½œç¢°æ’ã€‚</p>
<blockquote>
<p>4ã€ä¸ºä»€ä¹ˆString, Intergerè¿™æ ·çš„åŒ…è£…ç±»é€‚åˆä½œä¸ºé”®ï¼Ÿ</p>
</blockquote>
<p>Stringæ˜¯finalä¸å¯å˜çš„ï¼Œè€Œä¸”å·²ç»é‡å†™äº†equals()å’ŒhashCode()æ–¹æ³•äº†ã€‚å› ä¸ºä¸ºäº†è¦è®¡ç®—hashCode()ï¼Œå°±è¦é˜²æ­¢é”®å€¼æ”¹å˜ã€‚</p>
<blockquote>
<p>5ã€equals() å’Œ hashcode()æ–¹æ³•å…³ç³»</p>
</blockquote>
<p>equals()ç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œhashcode()ä¸€å®šç›¸ç­‰ï¼Œequals()ä¸ç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œå´å¹¶ä¸èƒ½è¯æ˜ä»–ä»¬çš„hashcode()ä¸ç›¸ç­‰ã€‚</p>
<h2 id="å…¶å®ƒ"><a href="#å…¶å®ƒ" class="headerlink" title="å…¶å®ƒ"></a>å…¶å®ƒ</h2><h3 id="transientå…³é”®å­—"><a href="#transientå…³é”®å­—" class="headerlink" title="transientå…³é”®å­—"></a>transientå…³é”®å­—</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br></pre></td></tr></table></figure>
<p>ä¸€ä¸ªå¯¹è±¡åªè¦å®ç°äº†Serilizableæ¥å£ï¼Œè¿™ä¸ªå¯¹è±¡å°±å¯ä»¥è¢«åºåˆ—åŒ–.<br>è€ŒæŸäº›åœºæ™¯æˆ‘ä»¬ä¸å¸Œæœ›æœ‰äº›å±æ€§è¢«åºåˆ—åŒ–ï¼Œè¿™æ—¶å€™æˆ‘ä»¬å°±å¯ä»¥åŠ ä¸Štransientå…³é”®å­—ã€‚æ¢å¥è¯è¯´ï¼Œè¿™ä¸ªå­—æ®µçš„ç”Ÿå‘½å‘¨æœŸä»…å­˜äºè°ƒç”¨è€…çš„å†…å­˜ä¸­è€Œä¸ä¼šå†™åˆ°ç£ç›˜é‡ŒæŒä¹…åŒ–ã€‚<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">     </span><br><span class="line"><span class="keyword">package</span> åºåˆ—åŒ–;</span><br><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@description</span> ä½¿ç”¨transientå…³é”®å­—ä¸åºåˆ—åŒ–æŸä¸ªå˜é‡</span></span><br><span class="line"><span class="comment"> *        æ³¨æ„è¯»å–çš„æ—¶å€™ï¼Œè¯»å–æ•°æ®çš„é¡ºåºä¸€å®šè¦å’Œå­˜æ”¾æ•°æ®çš„é¡ºåºä¿æŒä¸€è‡´</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> yinchengjian</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TransientTest</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        </span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername(<span class="string">"mia"</span>);</span><br><span class="line">        user.setPasswd(<span class="string">"123456"</span>);</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">"read before Serializable: "</span>);</span><br><span class="line">        System.out.println(<span class="string">"username: "</span> + user.getUsername());</span><br><span class="line">        System.out.println(<span class="string">"password: "</span> + user.getPasswd());</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectOutputStream os = <span class="keyword">new</span> ObjectOutputStream(</span><br><span class="line">                    <span class="keyword">new</span> FileOutputStream(<span class="string">"/Users/yinchengjian/å­¦ä¹ /vim/user.txt"</span>));</span><br><span class="line">            os.writeObject(user); <span class="comment">// å°†Userå¯¹è±¡å†™è¿›æ–‡ä»¶</span></span><br><span class="line">            os.flush();</span><br><span class="line">            os.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ObjectInputStream is = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(</span><br><span class="line">                    <span class="string">"/Users/yinchengjian/å­¦ä¹ /vim/user.txt"</span>));</span><br><span class="line">            user = (User) is.readObject(); <span class="comment">// ä»æµä¸­è¯»å–Userçš„æ•°æ®</span></span><br><span class="line">            is.close();</span><br><span class="line">            </span><br><span class="line">            System.out.println(<span class="string">"\nread after Serializable: "</span>);</span><br><span class="line">            System.out.println(<span class="string">"username: "</span> + user.getUsername());</span><br><span class="line">            System.out.println(<span class="string">"password: "</span> + user.getPasswd());</span><br><span class="line">            </span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8294180014912103005L</span>;  </span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">transient</span> String passwd;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPasswd</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> passwd;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPasswd</span><span class="params">(String passwd)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.passwd = passwd;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¾“å‡ºè¯­å¥ï¼š</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">read before Serializable: </span><br><span class="line">username: mia</span><br><span class="line">password: <span class="number">123456</span></span><br><span class="line"></span><br><span class="line">read after Serializable: </span><br><span class="line">username: mia</span><br><span class="line">password: <span class="keyword">null</span></span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> æºç  </tag>
            
            <tag> HashMap </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[vim å¸¸ç”¨å‘½ä»¤æ€»ç»“]]></title>
      <url>/chengasd.github.io/2018/01/01/vim-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/</url>
      <content type="html"><![CDATA[<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/vim-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/2.jpg" alt=""></p>
<h2 id="å¯åŠ¨vim"><a href="#å¯åŠ¨vim" class="headerlink" title="å¯åŠ¨vim"></a>å¯åŠ¨vim</h2><p>åœ¨å‘½ä»¤è¡Œçª—å£è¾“å…¥ä»¥ä¸‹å‘½ä»¤å³å¯<br>vim ç›´æ¥å¯åŠ¨vim<br>vim æ–‡ä»¶å æ‰“å¼€vimå¹¶åˆ›å»ºå¯¹åº”æ–‡ä»¶åçš„æ–‡ä»¶</p>
<a id="more"></a>
<h2 id="æ–‡ä»¶å‘½ä»¤"><a href="#æ–‡ä»¶å‘½ä»¤" class="headerlink" title="æ–‡ä»¶å‘½ä»¤"></a>æ–‡ä»¶å‘½ä»¤</h2><p>vim file æ‰“å¼€å•ä¸ªæ–‡ä»¶<br>vim file1 file2 file3 åŒæ—¶æ‰“å¼€å¤šä¸ªæ–‡ä»¶<br>:open file åœ¨vimçª—å£ä¸­æ‰“å¼€æ–°æ–‡ä»¶<br>:bn åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæ–‡ä»¶<br>:bp åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªæ–‡ä»¶<br>:args æŸ¥çœ‹å½“å‰æ‰“å¼€çš„æ–‡ä»¶åˆ—è¡¨<br>:e ftp://192.168.0.1/aaa.txt æ‰“å¼€è¿œç¨‹æ–‡ä»¶</p>
<h2 id="vimæ¨¡å¼"><a href="#vimæ¨¡å¼" class="headerlink" title="vimæ¨¡å¼"></a>vimæ¨¡å¼</h2><p>å‘½ä»¤æ¨¡å¼ï¼ˆvi æ–‡ä»¶å è¿›å…¥ï¼‰<br>æ’å…¥æ¨¡å¼ï¼ˆæŒ‰ié”®è¿›å…¥ï¼‰ å·¦ä¸‹è§’æ˜¾ç¤ºâ€“INSERTâ€“<br>ç¼–è¾‘æ¨¡å¼ï¼ˆæŒ‰:é”®è¿›å…¥ï¼‰ </p>
<h2 id="åŸºæœ¬ç¼–è¾‘"><a href="#åŸºæœ¬ç¼–è¾‘" class="headerlink" title="åŸºæœ¬ç¼–è¾‘"></a>åŸºæœ¬ç¼–è¾‘</h2><p>a       åœ¨å½“å‰å…‰æ ‡åæ’å…¥æ–‡æœ¬<br>A       åœ¨æœ¬è¡Œè¡Œå°¾æ’å…¥æ–‡æœ¬<br>i       åœ¨å½“å‰å…‰æ ‡å‰æ’å…¥æ–‡æœ¬<br>I       åœ¨æœ¬è¡Œè¡Œå‰æ’å…¥æ–‡æœ¬<br>o       åœ¨å…‰æ ‡ä¸‹æ’å…¥æ–°è¡Œ<br>O       åœ¨å…‰æ ‡ä¸Šæ’å…¥æ–°è¡Œ</p>
<h2 id="ç§»åŠ¨å…‰æ ‡"><a href="#ç§»åŠ¨å…‰æ ‡" class="headerlink" title="ç§»åŠ¨å…‰æ ‡"></a>ç§»åŠ¨å…‰æ ‡</h2><p>hjkl    å…‰æ ‡ç§»åŠ¨1ä½ï¼Œåˆ†åˆ«ä»£è¡¨ä¸Šã€ä¸‹ã€å·¦ã€å³<br>æ•°å­—0    å…‰æ ‡ç§»åŠ¨åˆ°æœ¬è¡Œå¼€å¤´<br>^       å…‰æ ‡ç§»åŠ¨åˆ°ç¬¬ä¸€ä¸ªéç©ºå­—ç¬¦<br>$       å…‰æ ‡ç§»åŠ¨åˆ°æœ¬è¡Œè¡Œå°¾<br>w       å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯æˆ–æ ‡ç‚¹å¼€å¤´<br>W       å…‰æ ‡ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªå•è¯å¼€å¤´ å¿½ç•¥æ ‡ç‚¹<br>b       å…‰æ ‡ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªå•è¯æˆ–æ ‡ç‚¹å¼€å¤´<br>B       å…‰æ ‡ç§»åŠ¨åˆ°ä¸Šä¸€ä¸ªå•è¯å¼€å¤´ å¿½ç•¥æ ‡ç‚¹<br>ctrl+f  å…‰æ ‡ä¸‹ç¿»ä¸€é¡µ<br>ctrl+b  å…‰æ ‡ä¸Šç¿»ä¸€é¡µ<br>ctrl+d  å…‰æ ‡ä¸‹ç¿»åŠé¡µ<br>ctrl+u  å…‰æ ‡ä¸Šç¿»åŠé¡µ<br>nG      å…‰æ ‡ç§»è‡³ç¬¬nè¡Œ<br>G       å…‰æ ‡ç§»è‡³æœ€åä¸€è¡Œ<br>n+      å…‰æ ‡å‘ä¸‹è·³nè¡Œ<br>n-      å…‰æ ‡å‘ä¸Šè·³nè¡Œ<br>H       å…‰æ ‡ç§»è‡³å½“å‰å±å¹•çš„ç¬¬ä¸€è¡Œ<br>L       å…‰æ ‡ç§»è‡³å½“å‰å±å¹•çš„æœ€åä¸€è¡Œ</p>
<h2 id="åˆ é™¤å’Œæ’¤é”€"><a href="#åˆ é™¤å’Œæ’¤é”€" class="headerlink" title="åˆ é™¤å’Œæ’¤é”€"></a>åˆ é™¤å’Œæ’¤é”€</h2><p>x       åˆ é™¤å½“å‰å­—ç¬¦ï¼ˆå‰ªåˆ‡ï¼‰<br>nx      å‘ååˆ é™¤å½“å‰è¡Œå†…çš„nä¸ªå­—ç¬¦ï¼ˆå‰ªåˆ‡ï¼‰<br>dd      åˆ é™¤å½“å‰è¡Œï¼ˆå‰ªåˆ‡ï¼‰<br>ndd     å‘ä¸‹åˆ é™¤å½“å‰è¡Œåœ¨å†…çš„nè¡Œï¼ˆå‰ªåˆ‡ï¼‰<br>dW      åˆ é™¤å½“å‰å•è¯ï¼ˆå‰ªåˆ‡ï¼‰<br>d$      åˆ é™¤å½“å‰å­—ç¬¦åˆ°å½“å‰è¡Œçš„æœ«å°¾ï¼ˆå‰ªåˆ‡ï¼‰<br>d0      åˆ é™¤å½“å‰å­—ç¬¦åˆ°å½“å‰è¡Œçš„è¡Œå¤´ï¼ˆå‰ªåˆ‡ï¼‰<br>d^      åˆ é™¤å½“å‰å­—ç¬¦åˆ°ä¸‹ä¸€ä¸ªéç©ºå­—ç¬¦ï¼ˆå‰ªåˆ‡ï¼‰<br>dG      åˆ é™¤å½“å‰è¡Œåˆ°æ–‡ä»¶æœ«å°¾ï¼ˆå‰ªåˆ‡ï¼‰<br>u       æ’¤é”€ä¸Šä¸€æ¬¡æ“ä½œ<br>U       æ’¤é”€å½“å‰è¡Œçš„æ‰€æœ‰æ“ä½œ<br>ctrl+r  æ’¤é”€çš„æ’¤é”€</p>
<h2 id="å‰ªåˆ‡ã€å¤åˆ¶å’Œç²˜è´´"><a href="#å‰ªåˆ‡ã€å¤åˆ¶å’Œç²˜è´´" class="headerlink" title="å‰ªåˆ‡ã€å¤åˆ¶å’Œç²˜è´´"></a>å‰ªåˆ‡ã€å¤åˆ¶å’Œç²˜è´´</h2><blockquote>
<p>xå’Œdé”®å®è´¨ä¸Šæ˜¯å‰ªåˆ‡é”®ã€‚ yæ˜¯å¤åˆ¶é”®ï¼Œpæ˜¯ç²˜è´´é”®</p>
</blockquote>
<p>p       ç²˜è´´åˆ°å½“å‰è¡Œåé¢<br>P       ç²˜è´´åˆ°å½“å‰è¡Œå‰é¢<br>yy      å¤åˆ¶å½“å‰è¡Œ<br>nyy     å‘ä¸‹å¤åˆ¶å½“å‰è¡Œåœ¨å†…çš„nè¡Œ<br>yw      å½“å‰å­—ç¬¦åˆ°ä¸‹ä¸€å•è¯çš„èµ·å§‹å¤„<br>y$      å½“å‰å­—ç¬¦åˆ°å½“å‰è¡Œçš„æœ«å°¾<br>y^      å½“å‰å­—ç¬¦åˆ°å½“å‰è¡Œä¸‹ä¸€ä¸ªéç©ºå­—ç¬¦<br>y0      å½“å‰å­—ç¬¦åˆ°å½“å‰è¡Œçš„è¡Œé¦–<br>yG      å½“å‰è¡Œåˆ°æ–‡ä»¶æœ«å°¾</p>
<h2 id="æŸ¥æ‰¾å’Œæ›¿æ¢"><a href="#æŸ¥æ‰¾å’Œæ›¿æ¢" class="headerlink" title="æŸ¥æ‰¾å’Œæ›¿æ¢"></a>æŸ¥æ‰¾å’Œæ›¿æ¢</h2><p>fx      å…‰æ ‡ç§»è‡³æœ¬è¡Œä¸‹ä¸€å¤„å‡ºç°å­—ç¬¦xçš„ä½ç½®ï¼Œè¾“å…¥åˆ†å·é‡å¤ä¸Šä¸€æ¬¡æœç´¢<br>/       ä½¿ç”¨/å‘½ä»¤åï¼Œè¾“å…¥è¦æœç´¢çš„å•è¯æˆ–çŸ­è¯­ï¼Œenterç»“æŸ, nå¾€ä¸‹æŸ¥è¯¢,Nå¾€ä¸ŠæŸ¥è¯¢<br>:s/old/new      ç”¨newæ›¿æ¢è¡Œä¸­é¦–æ¬¡å‡ºç°çš„oldï¼ˆ:åˆ†å·ç”¨äºå¯åŠ¨ä¸€æ¡exå‘½ä»¤ï¼‰<br>:s/old/new/g    ç”¨newæ›¿æ¢è¡Œä¸­æ‰€æœ‰çš„old<br>:n,m s/old/new/gç”¨newæ›¿æ¢ä»nåˆ°mè¡Œé‡Œæ‰€æœ‰çš„old<br>:%s/old/new/g   ç”¨newæ›¿æ¢å½“å‰æ–‡ä»¶é‡Œæ‰€æœ‰çš„old<br>:set nu         æ˜¾ç¤ºè¡Œå·<br>:set nonu       å–æ¶ˆæ˜¾ç¤ºè¡Œå·</p>
<h2 id="ä¿å­˜é€€å‡º"><a href="#ä¿å­˜é€€å‡º" class="headerlink" title="ä¿å­˜é€€å‡º"></a>ä¿å­˜é€€å‡º</h2><p>:w      ä»…ä¿å­˜æ–‡ä»¶<br>:q      é€€å‡ºæ–‡ä»¶ï¼Œæ²¡æœ‰ä¿®æ”¹<br>:q!     æ”¾å¼ƒä¿®æ”¹å¹¶æ¨å‡ºæ–‡ä»¶<br>:wq     ä¿å­˜å¹¶é€€å‡ºæ–‡ä»¶<br>:w file1æ–‡ä»¶å¦å­˜ä¸ºfile1<br>ZZ      ä¿å­˜å¹¶é€€å‡ºæ–‡ä»¶</p>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/vim-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E6%80%BB%E7%BB%93/1.png" alt=""></p>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> å‘½ä»¤ </tag>
            
            <tag> vim </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[å†è§2017ï¼Œä½ å¥½2018]]></title>
      <url>/chengasd.github.io/2017/12/31/%E5%86%8D%E8%A7%812017%EF%BC%8C%E4%BD%A0%E5%A5%BD2018/</url>
      <content type="html"><![CDATA[<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/%E5%86%8D%E8%A7%812017%EF%BC%8C%E4%BD%A0%E5%A5%BD2018/3753.JPG" alt=""></p>
<h2 id="å†è§2017"><a href="#å†è§2017" class="headerlink" title="å†è§2017"></a>å†è§2017</h2><p>çœ¨çœ¼é—´ï¼Œå³å°†å‘Šåˆ«2017ã€‚<br>è¿™ä¸€å¹´ç»å†çš„å¤ªå¤šï¼Œæœ‰æ‚²æœ‰å–œã€‚<br>æˆ‘è¿˜æ˜¯é‚£ä¸ªæˆ‘ï¼Œå‘¨å›´çš„äººå´å˜äº†ä¸€éï¼Œ<br>æœ‰è€æœ‹å‹çš„è¾èŒé«˜å°±ï¼Œä¹Ÿæœ‰äº²äººå¯¿ç»ˆç¦»å»ã€‚<br>å”¯ä¸€ä¸å˜çš„æ˜¯2016å¹´è¦æ±‚è‡ªå·±åšåˆ°çš„äº‹è¿˜æ˜¯æ²¡å®Œæˆï¼Œ<br>åªèƒ½æ”¾åˆ°2018å¹´ç»§ç»­äº†ã€‚<br><a id="more"></a></p>
<h3 id="è·³äº†ç¬¬ä¸€æ¬¡æ§½"><a href="#è·³äº†ç¬¬ä¸€æ¬¡æ§½" class="headerlink" title="è·³äº†ç¬¬ä¸€æ¬¡æ§½"></a>è·³äº†ç¬¬ä¸€æ¬¡æ§½</h3><p>4æœˆä»½ä»è€ä¸œå®¶è¾èŒäº†ã€‚<br>ä»ç°åœ¨æœ€å›çœ‹ä¸¤å¹´ä¸­çš„è‡ªå·±ï¼ŒæŠ€æœ¯è°ˆä¸ä¸Šæœ‰å¤šå°‘è¿›æ­¥ï¼Œ<br>ä¸€æ–¹é¢æ˜¯è‡ªå·±åœ¨å­¦ä¹ è·¯çº¿ä¸Šç»•äº†å¾ˆå¤šå¼¯å¯¼è‡´ä¸­é€”æ”¾å¼ƒï¼Œ<br>å¦ä¸€æ–¹é¢æ˜¯æ¥è§¦çš„éƒ½æ˜¯æˆå‹çš„ç³»ç»Ÿï¼Œåšçš„æ›´å¤šçš„æ˜¯ä¸šåŠ¡ç›¸å…³çš„äºŒæ¬¡å¼€å‘ã€‚<br>æ‰€ä»¥æ¯…ç„¶é€‰æ‹©è¾èŒï¼Œé€‰æ‹©è·³åˆ°æ›´åŠ åäº’è”ç½‘çš„å…¬å¸ã€‚<br>ä¹Ÿè¦æ„Ÿè°¢è€ä¸œå®¶ï¼Œä¸¤å¹´çš„ç»å†è®©åˆšæ¯•ä¸šçš„è‡ªå·±ç£¨ç»ƒå‡ºäº†å¦‚ä½•å¿«é€Ÿå®šä½é—®é¢˜ã€‚</p>
<p>åœ¨æ–°çš„å…¬å¸æ‰¿å—äº†æ›´å¤§çš„å‹åŠ›ï¼Œä»è€Œæ›´å¥½çš„æ¿€å‘è‡ªå·±çš„æ½œèƒ½ï¼Œ<br>ä¹Ÿæ¥è§¦æ›´åŠ å‰æ²¿çš„æŠ€æœ¯ï¼Œå¼€é˜”äº†è§†é‡ã€‚<br>å½“ç„¶æœ€é‡è¦çš„è¿˜æ˜¯é’±å¤šäº†ï½ï½ï½</p>
<h3 id="è¯»äº†å‡ æœ¬å°è¯´"><a href="#è¯»äº†å‡ æœ¬å°è¯´" class="headerlink" title="è¯»äº†å‡ æœ¬å°è¯´"></a>è¯»äº†å‡ æœ¬å°è¯´</h3><p>äº¬ä¸œ618æ´»åŠ¨æ»¡äº†ä¸€å †ä¹¦ï¼ŒæŠ€æœ¯ä¹¦è¿˜æ²¡æ€ä¹ˆç¿»ï¼Œ<br>å°è¯´å€’çœ‹å®Œä¸¤æœ¬äº†ï¼Œæ‚è„¸ã€‚<br>æ¸æ¸å–œæ¬¢å»å›¾ä¹¦é¦†åä¸Šä¸€ä¸‹åˆï¼Œçœ‹çœ‹å°è¯´ã€‚<br>æ¯•ç«Ÿä¹¦ä¸­è‡ªæœ‰é»„é‡‘å±‹ï¼Œçœ‹ä¹¦çš„æ—¶å€™ä¹Ÿèƒ½ä¸°å¯Œæ›´å¤šçš„çŸ¥è¯†ï¼Œ<br>ä¹Ÿå¯ä»¥æŠŠæµ®èºçš„è‡ªå·±æ²‰æ·€ä¸‹æ¥ã€‚</p>
<p>åˆ—ä¸‹ä»Šå¹´çœ‹å®Œçš„ä¹¦ï¼š</p>
<blockquote>
<p><strong>ã€Šç™½é¹¿åŸã€‹ â™¥â™¥â™¥â™¥â™¥</strong><br>èµ¶åœ¨ç”µè§†åœæ’­çš„æ—¶å€™çœ‹çš„ï¼Œå‰å‰ååèŠ±äº†16ä¸ªå°æ—¶çœ‹å®Œã€‚ä¸–ç•Œé‚£ä¹ˆå¤§ï¼Œå°±æ€•çœ‹ä¸è¿œï¼Œåœ¨ç™½é¹¿ä¸¤å®¶ä¸­ï¼Œæ¯”èµ·ä¿å®ˆä¸¥è°¨çš„ç™½å®¶æ¥è¯´ï¼Œæ›´åŠ é’¦ä½©æ¿€è¿›çš„é¹¿å®¶ï¼Œå¤„äºæˆ˜äº‰çš„æ¼©æ¶¡ï¼Œæˆ–è¿›æˆ–é€€ï¼Œå¼•èµ·ä¸€åœºåœºé£æ…é›ªã€‚</p>
<p><strong>ã€Šä¹–ï¼Œæ‘¸æ‘¸å¤´ã€‹ â™¥â™¥â™¥</strong><br>è¯´å®è¯ï¼Œä¹¦ä¸­çš„å‡ ä¸ªæ•…äº‹å†…å®¹å·²ç„¶è®°ä¸å¤ªæ¸…äº†ï¼Œåé¢æ¯æ¬¡çœ‹ä¹¦è¿˜æ˜¯è¦å†™å¥½è¯»ä¹¦ç¬”è®°ã€‚</p>
<p><strong>ã€Šæˆ‘æœ‰æ•…äº‹ï¼Œä½ æœ‰é…’å—ï¼Ÿã€‹ â™¥â™¥â™¥</strong><br>å¾ˆå¯æƒœè¿™ä¹ˆå¤šæ•…äº‹æ²¡æœ‰ä¸€ä¸ªæ„ŸåŒèº«å—çš„ï¼Œæ¯•ç«Ÿå•èº«å¾ˆä¹…äº†ï¼ŒORZ.</p>
<p><strong>ã€Šå¼‚ä¹¡äººã€‹ â™¥â™¥â™¥</strong><br>è®¢é˜…çš„Bç«™upä¸»æ¨èï¼Œä¹Ÿè¢«ä¹¦åå¸å¼•ï¼Œçœ‹ä¸‹æ¥å´æ„Ÿè§‰å’Œè¿™ä¸ªä¹¦åä¸æ˜¯å¾ˆåŒ¹é…ï¼Œæ•…äº‹ä¹Ÿä¸æ˜¯é‚£ä¹ˆçš„å¤§èµ·å¤§è½ï¼Œæ¯”è¾ƒå¹³æ·¡ã€‚ ä¸è¿‡å°é¢çš„ä¸€æ®µè¯è¿˜æ˜¯æ¯”è¾ƒæœ‰æ·±æ„çš„ã€‚<br><strong>æˆ‘çŸ¥é“è¿™ä¸–ç•Œæˆ‘æ— å¤„å®¹èº«ï¼Œåªæ˜¯ï¼Œä½ å‡­ä»€ä¹ˆå®¡åˆ¤æˆ‘çš„çµé­‚ï¼Ÿ</strong></p>
<p><strong>ã€Šæ‘†æ¸¡äººã€‹ â™¥â™¥â™¥</strong><br>äº¬ä¸œä¸Šé¢æ¨èçš„çƒ­é—¨ä¹¦ç±ï¼Œæ•´ä½“çœ‹ä¸‹æ¥ï¼Œæ•…äº‹æ¯”è¾ƒé€šä¿—æ˜“æ‡‚ï¼Œä½†æ„Ÿè§‰è¿™æœ¬ä¹¦å¹¶ä¸åƒå…¶å®£ä¼ çš„é‚£ä¹ˆå¥½ï¼Œä¹Ÿè®¸æœ‰çš„æ—¶å€™å¥½ä¹¦çš„ç•Œå®šå› äººè€Œå¼‚å§ã€‚</p>
<p><strong>ã€Šæˆ‘çš„åº”è®¸ä¹‹åœ°ã€‹ â™¥â™¥â™¥â™¥</strong><br>ä¸€æœ¬å…³äºä»¥è‰²åˆ—çš„ä¹¦ç±ï¼Œè®²è¿°äº†ä»¥è‰²åˆ—è¿™ä¸ªå›½å®¶çš„å‰èº«ä»¥åŠå·´ä»¥å†²çªçš„æ¥æºï¼Œ<br>è¿˜æœªçœ‹å®Œï¼Œä¸ªäººæ¯”è¾ƒæ¨èã€‚</p>
</blockquote>
<h3 id="é€èµ°äº†ä¸‰ä½è€äºº"><a href="#é€èµ°äº†ä¸‰ä½è€äºº" class="headerlink" title="é€èµ°äº†ä¸‰ä½è€äºº"></a>é€èµ°äº†ä¸‰ä½è€äºº</h3><p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/%E5%86%8D%E8%A7%812017%EF%BC%8C%E4%BD%A0%E5%A5%BD2018/3752.JPG" alt=""><br>ä¸€å¹´é€èµ°äº†ä¸‰ä½è€äººã€‚<br>3æœˆ7å·ï¼Œå¥¶å¥¶å› ç—…ç¦»ä¸–ã€‚<br>12æœˆ22å·ï¼Œçˆ·çˆ·ä¹Ÿç¦»å»ã€‚<br>12æœˆ28å·ï¼Œå¤–å…¬å¯¿ç»ˆã€‚</p>
<p>åœ¨å¥¶å¥¶å’Œå¤–å…¬èµ°ä¹‹å‰éƒ½å›å»çœ‹åˆ°æœ€åä¸€é¢ã€‚<br>æ¼‚æ³Šåœ¨å¤–ï¼Œèƒ½åšåˆ°çš„ä¹Ÿåªæœ‰åƒé‡Œå¥”ä¸§ï¼Œèµ¶å›å®¶é€è€äººä¸‹è‘¬ã€‚<br>è™½è¯´ç”Ÿè€ç—…æ­»ä¹ƒäººä¹‹å¸¸æƒ…ï¼Œä½†å½“è¿™ä¸€åˆ‡å‘ç”Ÿåœ¨è‡ªå·±èº«ä¸Šæ—¶ï¼Œæ‚²ä¼¤è¿˜æ˜¯æ­¢ä¸ä½çš„ã€‚<br>çˆ¶è¾ˆé‚£ä»£éƒ½æ˜¯å¥½å‡ ä¸ªå…„å¼Ÿå§å¦¹æ“æŒä¸§äº‹ï¼Œ<br>ä¸æ•¢æƒ³è±¡å°†æ¥æˆ‘ä»¬ç‹¬ç”Ÿè¿™ä¸€ä»£è¯¥å¦‚ä½•é¢å¯¹è¿™ç§äº‹ã€‚<br>å¹³æ—¶å¤§å®¶è¿˜æ˜¯å¤šé”»ç‚¼èº«ä½“ã€‚</p>
<h3 id="ç‹¬è‡ªè‡ªç”±è¡Œ"><a href="#ç‹¬è‡ªè‡ªç”±è¡Œ" class="headerlink" title="ç‹¬è‡ªè‡ªç”±è¡Œ"></a>ç‹¬è‡ªè‡ªç”±è¡Œ</h3><p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/%E5%86%8D%E8%A7%812017%EF%BC%8C%E4%BD%A0%E5%A5%BD2018/3754.JPG" alt=""></p>
<p>16å¹´æœ«å®ç°äº†è‡ªå·±ç¬¬ä¸€æ¬¡å‡ºå¢ƒè‡ªç”±è¡Œï¼Œåœ¨æ›¼è°·è·¨å¹´ï¼Œå®‰æ’è¡Œç¨‹çš„æ—¶å€™ä¹Ÿå°½é‡å»è¿‡äººä¸å¸¸å»çš„æ™¯ç‚¹å’ŒåŸå¸‚ï¼Œç°åœ¨æƒ³æƒ³è¿˜æ˜¯æŒºä½©æœè‡ªå·±çš„ã€‚<br>æ¸¸è®°ï¼š<a href="http://www.mafengwo.cn/i/6621839.html" target="_blank" rel="noopener">http://www.mafengwo.cn/i/6621839.html</a></p>
<h2 id="ä½ å¥½2018"><a href="#ä½ å¥½2018" class="headerlink" title="ä½ å¥½2018"></a>ä½ å¥½2018</h2><p>18å¹´çš„æ„¿æœ›ï¼š<br>1ã€ä¿æŒæ¯å‘¨è¯»ä¹¦çš„ä¹ æƒ¯<br>2ã€å¤šæ·±ç©¶æŠ€æœ¯ï¼Œå¼€å§‹å¤šå†™äº›æŠ€æœ¯åšå®¢<br>3ã€ä¿æŒæ¯å‘¨2æ¬¡è·‘æ­¥<br>4ã€äº²äºº&amp;è‡ªå·±éƒ½å¥å¥åº·åº·<br>5ã€ä¹Ÿæ˜¯æœ€å¤§çš„æ„¿æœ› å‘Šåˆ«å•èº«ï¼ï¼</p>
]]></content>
      
        <categories>
            
            <category> ç”Ÿæ´» </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[è§£æComparableä¸Comparator]]></title>
      <url>/chengasd.github.io/2017/12/28/%E8%A7%A3%E6%9E%90Comparable%E4%B8%8EComparator/</url>
      <content type="html"><![CDATA[<h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å¯¹è±¡ç±»å®ç°äº†Comparableæ¥å£æ˜¯å…·æœ‰å¯æ¯”è¾ƒæ€§çš„ç±»ï¼Œè¯¥ç±»çš„å¤šä¸ªå¯¹è±¡ä¹‹å°±é—´å¯ä»¥ç›¸äº’æ¯”è¾ƒå¤§å°ã€‚</p>
<p>å®ç°äº†Comparatoræ¥å£çš„ç±»ä¸»è¦åœ¨ä¸¤ç§æƒ…å†µä¸‹ä½¿ç”¨ï¼š</p>
<ol>
<li>ä½œä¸ºç­–ç•¥å¯¹è±¡ä¼ é€’ç»™æ’åºæ–¹æ³•ï¼Œç²¾ç¡®æ§åˆ¶æ’åºæ–¹æ³•çš„æ’åºç»“æœã€‚æ¯”å¦‚ Collections.sort() å’Œ Arrays.sort() ã€‚</li>
<li>ä½œä¸ºç­–ç•¥å¯¹è±¡ä¼ é€’ç»™é›†åˆå®¹å™¨ï¼Œç²¾ç¡®æ§åˆ¶å®¹å™¨çš„æ’åºç®—æ³•ã€‚æ¯”å¦‚ æœ‰åºSet(TreeSet) å’Œ æœ‰åºMap(TreeMap)ã€‚</li>
</ol>
<a id="more"></a>
<h2 id="Comparable"><a href="#Comparable" class="headerlink" title="Comparable"></a>Comparable</h2><p>å½“ä¸€ä¸ªç±»å¸Œæœ›ä½¿å¾—è‡ªå·±çš„å¯¹è±¡å¯ä»¥ç›´æ¥ä¸å…¶ä»–çš„å¯¹è±¡æ¯”è¾ƒæ—¶ï¼Œå¯ä»¥ implements(å®ç°) Comparableæ¥å£ã€‚Comparableæ¥å£ä¸­åªæœ‰ä¸€ä¸ª compareTo() æ–¹æ³•ï¼Œå®ç°Comparableæ¥å£çš„compareToæ–¹æ³•ï¼Œå°±å¯ä»¥å®ç°å®šåˆ¶åŒ–æ¯”è¾ƒç­–ç•¥ã€‚</p>
<p>Demo:<br>å®šä¹‰å¯¹è±¡ç±»Userå¹¶å®ç°Comparableæ¥å£<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> <span class="keyword">implements</span> <span class="title">Comparable</span>&lt;<span class="title">User</span>&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> age;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//....</span></span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compareTo</span><span class="params">(User o)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//è‡ªå®šä¹‰å¦‚ä½•æ¯”è¾ƒ</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.username.equals(o.getUsername()) &amp;&amp; <span class="keyword">this</span>.age == o.getAge())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>æµ‹è¯•ï¼š<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> List&lt;User&gt; userList = Arrays.asList(</span><br><span class="line">        <span class="keyword">new</span> User(<span class="string">"å¼ ä¸‰"</span>,<span class="number">20</span>,<span class="number">19.9</span>),</span><br><span class="line">        <span class="keyword">new</span> User(<span class="string">"æå››"</span>,<span class="number">30</span>,<span class="number">30.5</span>),</span><br><span class="line">        <span class="keyword">new</span> User(<span class="string">"ç‹äº”"</span>,<span class="number">50</span>,<span class="number">29.9</span>),</span><br><span class="line">        <span class="keyword">new</span> User(<span class="string">"èµµå…­"</span>,<span class="number">40</span>,<span class="number">40.5</span>),</span><br><span class="line">        <span class="keyword">new</span> User(<span class="string">"ç”°ä¸ƒ"</span>,<span class="number">45</span>,<span class="number">70.2</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User(<span class="string">"ç”°ä¸ƒ"</span>,<span class="number">46</span>,<span class="number">200</span>);</span><br><span class="line">    userList.stream()</span><br><span class="line">            .forEach((o)-&gt;&#123;</span><br><span class="line">                <span class="keyword">if</span>(<span class="number">0</span> == o.compareTo(user))</span><br><span class="line">                    System.out.println(o+<span class="string">"å­˜åœ¨ç”¨æˆ·è¡¨ä¸­"</span>);</span><br><span class="line">                System.out.println(o+<span class="string">"ä¸ç­‰äºè¯¥ç”¨æˆ·"</span>);</span><br><span class="line">            &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Comparator"><a href="#Comparator" class="headerlink" title="Comparator"></a>Comparator</h2><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ æ— æ³•ä¿®æ”¹åŸºç¡€ç±»çš„æºä»£ç ã€‚åŒæ—¶ï¼Œä½ åˆå¸Œæœ›å¯ä»¥åŸºäºå¯¹è±¡çš„æŸäº›å±æ€§æˆ–å­—æ®µå»æ¯”è¾ƒå¯¹è±¡çš„å¤§å°ï¼Œæ­¤æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥è®©è¯¥æŸç±»å®ç°Comparatoræ¥å£ã€‚<br>Demo:<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyComparator</span> <span class="keyword">implements</span> <span class="title">Comparator</span>&lt;<span class="title">User</span>&gt;</span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">compare</span><span class="params">(User o1, User o2)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//å…ˆæŒ‰å¹´é¾„æ¯”è¾ƒ ç›¸ç­‰æƒ…å†µä¸‹æ¯”è¾ƒè–ªæ°´ã€‚</span></span><br><span class="line">        <span class="keyword">if</span> (o1.getAge() &gt; o2.getAge())</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (o1.getAge() == o2.getAge())</span><br><span class="line">            <span class="keyword">if</span> (o1.getSalary() &gt; o2.getSalary())</span><br><span class="line">                <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>é€šè¿‡é›†åˆå·¥å…·ç±»è¿›è¡Œæ’åº<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testuserListsCollection</span><span class="params">()</span></span>&#123;</span><br><span class="line">    List&lt;User&gt; userLists = Arrays.asList(</span><br><span class="line">            <span class="keyword">new</span> User(<span class="string">"å¼ ä¸‰"</span>,<span class="number">20</span>,<span class="number">19.9</span>),</span><br><span class="line">            <span class="keyword">new</span> User(<span class="string">"æå››"</span>,<span class="number">30</span>,<span class="number">30.5</span>),</span><br><span class="line">            <span class="keyword">new</span> User(<span class="string">"ç‹äº”"</span>,<span class="number">30</span>,<span class="number">29.9</span>),</span><br><span class="line">            <span class="keyword">new</span> User(<span class="string">"èµµå…­"</span>,<span class="number">40</span>,<span class="number">40.5</span>),</span><br><span class="line">            <span class="keyword">new</span> User(<span class="string">"ç”°ä¸ƒ"</span>,<span class="number">45</span>,<span class="number">70.2</span>)</span><br><span class="line">    );</span><br><span class="line">    Collections.sort(userLists,<span class="keyword">new</span> MyComparator());</span><br><span class="line">    userLists.stream()</span><br><span class="line">            .forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Javaè¿›é˜¶åŸºç¡€ </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[èŠ±æœ‰é‡å¼€æ—¥ï¼Œäººæ— å†å°‘å¹´]]></title>
      <url>/chengasd.github.io/2017/12/22/%E8%8A%B1%E6%9C%89%E9%87%8D%E5%BC%80%E6%97%A5%EF%BC%8C%E4%BA%BA%E6%97%A0%E5%86%8D%E5%B0%91%E5%B9%B4/</url>
      <content type="html"><![CDATA[<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/%E8%8A%B1%E6%9C%89%E9%87%8D%E5%BC%80%E6%97%A5%EF%BC%8C%E4%BA%BA%E6%97%A0%E5%86%8D%E5%B0%91%E5%B9%B4/1222.jpeg" alt=""></p>
<p>ä»æ¥æ²¡æƒ³åˆ°ä¸€åˆ‡æ¥çš„è¿™ä¹ˆçš„çªç„¶ï¼Œ3æœˆæ‰é€èµ°äº²çˆ±çš„å¥¶å¥¶ï¼Œçˆ·çˆ·ä¹Ÿä»æ­¤åˆ»ç¦»å¼€äº†ã€‚</p>
<p>7å¹´æ¼‚æ³Šåœ¨å¤–ï¼Œæ¯å¹´æ˜¥èŠ‚å›å»åªçŸ¥é“å‘†åœ¨å®¶é‡Œç©ç”µè„‘ï¼Œå’Œæœ‹å‹èšä¼šï¼Œå»çœ‹æœ›çˆ·çˆ·å¥¶å¥¶çš„æ¬¡æ•°çœŸçš„å°‘ä¹‹åˆå°‘ï¼Œç°åœ¨çœŸçš„æƒ³å›æŠ¥æ‚¨ä»¬å´æ²¡æœ‰æœºä¼šäº†ã€‚</p>
<a id="more"></a>
<p>å°æ—¶å€™åœ¨çˆ·çˆ·å¥¶å¥¶å®¶ç©ï¼Œå¥¶å¥¶æ€»æ˜¯åŒ…ç€é¦„é¥¨ï¼Œåšå›¢å­ï¼Œçˆ·çˆ·ä¸‹åœ°ç§èœåˆ†ç»™å„å®¶çƒ§èœåƒï¼Œä¸€å®¶äººåœ¨é—¨å£åˆ®ä¸ç“œçš®ï¼Œç”»é¢éƒ½æ˜¯é‚£ä¹ˆçš„ç†Ÿæ‚‰ã€‚æˆ‘å¼€å§‹å¯„å®¿ä¸Šé«˜ä¸­ï¼Œå¥¶å¥¶ä¼šå¡é’±ç»™æˆ‘è®©æˆ‘è‡ªå·±ä¹°ä¸œè¥¿åƒï¼Œçœ‹ç€æ‰‹é‡Œé›¶æ•£çš„çº¸ç¥¨é’±ï¼Œæˆ‘çŸ¥é“è¿™æ˜¯æ‚¨ä»¬å¤©å¤©èµ·æ—©è·‘åˆ°å¸‚åœºå–èœæŒ£å¾—è¡€æ±—é’±ï¼Œçœåƒä¿­ç”¨åœ°è¿‡æ—¥å­ï¼Œæ¯å¹´è¿‡å¹´è¿˜æ˜¯åŒ…çº¢åŒ…ç»™æ¯ä¸ªå­™å­ï¼Œèµ°çš„æ—¶å€™ä¹Ÿæ²¡äº«å—ä»€ä¹ˆç¦ï¼Œæ¥ä¸åŠå‘æ‚¨ä»¬è¯´å£°é“è°¢ï¼Œä»ä¸æ›¾å¯¹æ‚¨ä»¬è¯´è¿‡ä¸€å£°è°¢è°¢ï¼Œåªå¸Œæœ›åœ¨å¦å¤–ä¸€ä¸ªä¸–ç•Œï¼Œæ‚¨ä»¬å¯ä»¥ä¸ç”¨å†å—è‹¦äº†ã€‚</p>
<p>å¯¹ä¸èµ·ã€‚</p>
<pre><code>â€”â€”â€”â€”è®°äº 23å·å®å®‰æœºåœº
</code></pre>]]></content>
      
        <categories>
            
            <category> ç”Ÿæ´» </category>
            
        </categories>
        
        
        <tags>
            
            <tag> ç”Ÿæ´» </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[æ´»åŠ¨å…¬å…±ç³»ç»Ÿè®¾è®¡]]></title>
      <url>/chengasd.github.io/2017/12/19/%E6%B4%BB%E5%8A%A8%E5%85%AC%E5%85%B1%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/</url>
      <content type="html"><![CDATA[<h2 id="ç°çŠ¶"><a href="#ç°çŠ¶" class="headerlink" title="ç°çŠ¶"></a>ç°çŠ¶</h2><p>â‘ å•å“ã€æ»¡å‡ã€æ­å”®ç­‰å„ä¸ªæ´»åŠ¨ä¿¡æ¯éƒ½æ˜¯ç‹¬ç«‹çš„ä¸€å¥—æ´»åŠ¨è¡¨ã€‚<br>â‘¡æ¯æ¬¡æ–°å¢ä¿ƒé”€æ´»åŠ¨éœ€è¦é‡æ–°å¼€å‘æ´»åŠ¨ç›¸å…³crudä»£ç ã€‚<br>â‘¢ä¸åˆ©äºç»´æŠ¤ï¼Œä»£ç å†—ä½™ï¼Œæ— æ„ä¹‰çš„é‡å¤å¼€å‘è¾ƒå¤šã€‚</p>
<h2 id="1ã€æ•´ç†åçš„æ´»åŠ¨å…¬å…±å­—æ®µ"><a href="#1ã€æ•´ç†åçš„æ´»åŠ¨å…¬å…±å­—æ®µ" class="headerlink" title="1ã€æ•´ç†åçš„æ´»åŠ¨å…¬å…±å­—æ®µ"></a>1ã€æ•´ç†åçš„æ´»åŠ¨å…¬å…±å­—æ®µ</h2><h3 id="æ•´ç†åæ´»åŠ¨å¯ä»¥åˆ†ä¸ºäº”ä¸ªç»´åº¦"><a href="#æ•´ç†åæ´»åŠ¨å¯ä»¥åˆ†ä¸ºäº”ä¸ªç»´åº¦" class="headerlink" title="æ•´ç†åæ´»åŠ¨å¯ä»¥åˆ†ä¸ºäº”ä¸ªç»´åº¦"></a>æ•´ç†åæ´»åŠ¨å¯ä»¥åˆ†ä¸ºäº”ä¸ªç»´åº¦</h3><table>
<thead>
<tr>
<th style="text-align:left">ç»´åº¦</th>
<th style="text-align:left">å­—æ®µ</th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
<th style="text-align:left"></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">æ´»åŠ¨åŸºæœ¬ä¿¡æ¯</td>
<td style="text-align:left">æ´»åŠ¨åç§°</td>
<td style="text-align:left">æ´»åŠ¨æ—¶é—´</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">æ´»åŠ¨ä½œç”¨åŸŸ</td>
<td style="text-align:left">Sku</td>
<td style="text-align:left">Spu</td>
<td style="text-align:left">å“ç‰Œ</td>
<td style="text-align:left">ç±»ç›®</td>
<td style="text-align:left">åº—é“º</td>
<td style="text-align:left">æ’é™¤ä¿¡æ¯</td>
</tr>
<tr>
<td style="text-align:left">ä¿ƒé”€æ¡ä»¶</td>
<td style="text-align:left">æ¨å¹¿å¹³å°</td>
<td style="text-align:left">è®¢å•é‡‘é¢</td>
<td style="text-align:left">è®¢å•æ•°é‡</td>
<td style="text-align:left">ç”¨æˆ·ç­‰çº§</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">ä¿ƒé”€è§„åˆ™</td>
<td style="text-align:left">åº“å­˜é™è´­è§„åˆ™</td>
<td style="text-align:left">ä¼˜æƒ é‡‘é¢é™åˆ¶</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">ä¿ƒé”€ä¼˜æƒ </td>
<td style="text-align:left">å‡Nå…ƒ</td>
<td style="text-align:left">æ‰“NæŠ˜</td>
<td style="text-align:left">é€èµ å“</td>
<td style="text-align:left">Nå…ƒä¿ƒé”€</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
<a id="more"></a>
<img src="/chengasd.github.io/2017/12/19/æ´»åŠ¨å…¬å…±ç³»ç»Ÿè®¾è®¡/æ´»åŠ¨å…¬å…±ç³»ç»Ÿ.png" title="æ´»åŠ¨å…¬å…±ç³»ç»Ÿ">
<h3 id="æ´»åŠ¨å…¬å…±ç³»ç»Ÿå­—æ®µè®¾è®¡"><a href="#æ´»åŠ¨å…¬å…±ç³»ç»Ÿå­—æ®µè®¾è®¡" class="headerlink" title="æ´»åŠ¨å…¬å…±ç³»ç»Ÿå­—æ®µè®¾è®¡"></a>æ´»åŠ¨å…¬å…±ç³»ç»Ÿå­—æ®µè®¾è®¡</h3><img src="/chengasd.github.io/2017/12/19/æ´»åŠ¨å…¬å…±ç³»ç»Ÿè®¾è®¡/æ´»åŠ¨å…¬å…±ç³»ç»Ÿ1.png" title="æ´»åŠ¨å…¬å…±ç³»ç»Ÿå­—æ®µè®¾è®¡">
]]></content>
      
        <categories>
            
            <category> ç³»ç»Ÿè®¾è®¡ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> è®¾è®¡ </tag>
            
            <tag> æ´»åŠ¨å…¬å…± </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Linux å¸¸ç”¨å‘½ä»¤ä¹‹wcã€sort]]></title>
      <url>/chengasd.github.io/2017/12/11/Linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E4%B9%8Bwc/</url>
      <content type="html"><![CDATA[<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E4%B9%8Bwc/1.jpeg" alt=""><br><a id="more"></a></p>
<h2 id="wcå‘½ä»¤"><a href="#wcå‘½ä»¤" class="headerlink" title="wcå‘½ä»¤"></a>wcå‘½ä»¤</h2><blockquote>
<p>wcå‘½ä»¤ç”¨äºç»Ÿè®¡ç»™å®šæ–‡ä»¶ä¸­çš„å­—èŠ‚æ•°ã€å­—æ•°ã€è¡Œæ•°ã€‚</p>
</blockquote>
<h3 id="å‘½ä»¤å‚æ•°"><a href="#å‘½ä»¤å‚æ•°" class="headerlink" title="å‘½ä»¤å‚æ•°"></a>å‘½ä»¤å‚æ•°</h3><ul>
<li>c ç»Ÿè®¡å­—èŠ‚æ•°ã€‚</li>
<li>l ç»Ÿè®¡è¡Œæ•°ã€‚</li>
<li>w ç»Ÿè®¡å•è¯æ•°ã€‚</li>
<li>m ç»Ÿè®¡å­—ç¬¦æ•°</li>
</ul>
<p>-lcw ç»„åˆä½¿ç”¨æŒ‰è¡Œæ•°ã€å­—æ•°ã€å­—èŠ‚æ•°ã€æ–‡ä»¶å<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wc ï¼lcw filename1</span><br></pre></td></tr></table></figure></p>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E4%B9%8Bwc/wc.png" alt=""></p>
<h3 id="å¸¸ç”¨åœºæ™¯"><a href="#å¸¸ç”¨åœºæ™¯" class="headerlink" title="å¸¸ç”¨åœºæ™¯"></a>å¸¸ç”¨åœºæ™¯</h3><p>1ã€ç»Ÿè®¡vimç›®å½•ä¸‹ï¼Œ.txtæ–‡ä»¶çš„æ•°é‡<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find vim/ -name &quot;*.txt&quot; | wc -l</span><br></pre></td></tr></table></figure></p>
<p>2ã€ç»Ÿè®¡vimç›®å½•ä¸‹æ‰€æœ‰txtæ–‡ä»¶çš„è¡Œæ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find vim/ -name &quot;*.txt&quot; | xargs cat | wc -l</span><br></pre></td></tr></table></figure></p>
<p>3ã€ç»Ÿè®¡vimç›®å½•ä¸‹æ‰€æœ‰txtæ–‡ä»¶æ’é™¤ä»¥1å¼€å¤´çš„è¡Œæ•°<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find vim/ -name &quot;*.txt&quot; | xargs cat | grep -v ^1 | wc -l</span><br></pre></td></tr></table></figure></p>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E4%B9%8Bwc/wc1.png" alt=""></p>
<h2 id="sortå‘½ä»¤"><a href="#sortå‘½ä»¤" class="headerlink" title="sortå‘½ä»¤"></a>sortå‘½ä»¤</h2><blockquote>
<p>sortå‘½ä»¤å¯ä»¥è¿›è¡Œæ’åºï¼Œå¹¶å°†æ’åºç»“æœæ ‡å‡†è¾“å‡º</p>
</blockquote>
<h3 id="å‘½ä»¤å‚æ•°-1"><a href="#å‘½ä»¤å‚æ•°-1" class="headerlink" title="å‘½ä»¤å‚æ•°"></a>å‘½ä»¤å‚æ•°</h3><ul>
<li>u æ’åºå¹¶ä¸”æ’é™¤é‡å¤é¡¹</li>
<li>r åå‘æ’åºï¼Œå³é™åº</li>
<li>o å¯ä»¥å°†æ’åºç»“æœè¾“å‡ºåˆ°æºæ–‡ä»¶ä¸­</li>
<li>n åŸæ¥æ•°å­—æ˜¯æŒ‰ç…§å­—ç¬¦ä¸²è¿›è¡Œæ’åºï¼Œï¼né‡‡ç”¨æ•°å­—å¤§å°è¿›è¡Œæ’åº</li>
<li>t æŒ‡å®šåˆ†éš”ç¬¦</li>
<li>k æŒ‡å®šå“ªä¸€ä¸ªåˆ†å‰²åŒºåŸŸè¿›è¡Œæ’åº</li>
</ul>
<h3 id="å¸¸ç”¨åœºæ™¯-1"><a href="#å¸¸ç”¨åœºæ™¯-1" class="headerlink" title="å¸¸ç”¨åœºæ™¯"></a>å¸¸ç”¨åœºæ™¯</h3><p>1ã€å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ’åº  é¡ºåº   sort filename<br>2ã€é‡‡ç”¨æ•°å­—è§„åˆ™å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œæ’åº  é¡ºåº  sort -n filename<br>3ã€é‡‡ç”¨æ•°å­—è§„åˆ™å¯¹æ–‡ä»¶å†…å®¹è¿›è¡Œé™åºæ’åº    sort -n -r filename<br>4ã€æŒ‰ç…§ï¼šåˆ†å·è¿›è¡Œåˆ†å‰²åå–ç¬¬å››å—æ•°å­—è¿›è¡Œæ’åº  sort -n -k 4 -t : filename<br>5ã€å°†æ’åºç»“æœä¿å­˜åˆ°æºæ–‡ä»¶ä¸­  sort -n filename -o filename </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sort filename</span><br><span class="line">sort -n filename</span><br><span class="line">sort -n -r filename</span><br><span class="line">sort -n -k 4 -t : filename</span><br><span class="line">sort -n -k 4 -t : filename -o filename</span><br></pre></td></tr></table></figure>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E4%B9%8Bwc/sort.png" alt=""></p>
<p>1ã€æŒ‰æ•°å­—ç»Ÿè®¡sort.txt å¹¶åˆ—å‡ºæ²¡è¡Œçš„é‡å¤æ¬¡æ•°ã€‚<br>2ã€æŒ‰é‡å¤æ¬¡æ•° é™åº ç»Ÿè®¡sort.txtä¸­çš„æ’åº<br>3ã€å–2ä¸­çš„ç»Ÿè®¡ç»“æœçš„å‰3æ¡æ•°æ®</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sort -n sort.txt | uniq -c </span><br><span class="line">sort -n sort.txt | uniq -c | sort -k 1 -n -r</span><br><span class="line">sort -n sort.txt | uniq -c | sort -k 1 -n -r | head -3</span><br></pre></td></tr></table></figure>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux-%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4%E4%B9%8Bwc/sort2.png" alt=""></p>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> å‘½ä»¤ </tag>
            
            <tag> Linux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Linux å¸¸ç”¨å‘½ä»¤ä¹‹grepã€ps]]></title>
      <url>/chengasd.github.io/2017/12/10/Linux%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      <content type="html"><![CDATA[<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/1.jpeg" alt=""><br><a id="more"></a></p>
<p>Linuxå‘½ä»¤å·¥ä½œåç»å¸¸ç”¨åˆ°ï¼Œæ¯”å¦‚å®šä½é—®é¢˜æŸ¥çœ‹çº¿ä¸Šæ—¥å¿—ã€shellè„šæœ¬ç­‰ï¼Œæ‰€ä»¥å­¦å¥½Linuxå‘½ä»¤è¿˜æ˜¯å¾ˆé‡è¦çš„ï¼Œæ­¤ç¯‡åªè®°å½•å·¥ä½œåæ¯”è¾ƒå¸¸ç”¨çš„å‘½ä»¤ã€‚</p>
<h2 id="grepå‘½ä»¤"><a href="#grepå‘½ä»¤" class="headerlink" title="grepå‘½ä»¤"></a>grepå‘½ä»¤</h2><blockquote>
<p>grepæ˜¯ä¸€ç§å¼ºå¤§çš„æ–‡æœ¬æœç´¢å·¥å…·ï¼Œå®ƒèƒ½ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼æœç´¢æ–‡æœ¬ï¼Œå¹¶æŠŠåŒ¹é…çš„è¡Œæ‰“å°å‡ºæ¥ã€‚</p>
</blockquote>
<p>1ã€åœ¨æ–‡ä»¶ä¸­æœç´¢å•è¯ï¼Œè¿”å›åŒ…å«â€testâ€çš„æ–‡æœ¬è¡Œ<br>2ã€ç»Ÿè®¡æ–‡ä»¶æˆ–è€…æ–‡æœ¬ä¸­åŒ…å«åŒ¹é…å­—ç¬¦ä¸²çš„è¡Œæ•° -c<br>3ã€è¾“å‡ºåŒ…å«åŒ¹é…å­—ç¬¦ä¸²çš„è¡Œæ•° -n<br>4ã€æœç´¢å¤šä¸ªæ–‡ä»¶å¹¶æŸ¥æ‰¾åŒ¹é…æ–‡æœ¬åœ¨å“ªäº›æ–‡ä»¶ä¸­ -l<br>5ã€è¾“å‡ºé™¤ä¹‹å¤–çš„æ‰€æœ‰è¡Œ -v<br>6ã€ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼ -E<br>7ã€å¿½ç•¥å¤§å°å†™ -i</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">grep test filename1 filename2 filename3 --color</span><br><span class="line">grep -c test filename1=</span><br><span class="line">grep -n test filename1</span><br><span class="line">grep -l test filename1 filename2</span><br><span class="line">grep -v test filename1</span><br><span class="line">grep -E &quot;[1-9]+&quot; filename1</span><br><span class="line">grep -i TEST filename1</span><br></pre></td></tr></table></figure>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/grep.png" alt=""></p>
<h3 id="å¸¸ç”¨åœºæ™¯"><a href="#å¸¸ç”¨åœºæ™¯" class="headerlink" title="å¸¸ç”¨åœºæ™¯"></a>å¸¸ç”¨åœºæ™¯</h3><p>1ã€æŸ¥æ‰¾åˆ¶å®šè¿›ç¨‹            ps -ef|grep heso<br>2ã€æŸ¥æ‰¾æŒ‡å®šè¿›ç¨‹ä¸ªæ•°         ps -ef|grep heso -c<br>3ã€æ‰¾å‡ºä»¥1å¼€å¤´çš„è¡Œå†…å®¹      cat test.txt | grep ^1<br>4ã€æ‰¾å‡ºä»¥aç»“å°¾çš„è¡Œå†…å®¹      cat test.txt | grep a$<br>5ã€æ˜¾ç¤ºåŒ…å«1231æˆ–è€…1234å­—ç¬¦çš„å†…å®¹è¡Œ      cat test.txt | grep -E â€œ1231|1234â€</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ps -ef|grep heso</span><br><span class="line">ps -ef|grep java -c</span><br><span class="line">cat test.txt | grep ^1</span><br><span class="line">cat test.txt | grep a$</span><br><span class="line">cat test.txt | grep -E &quot;1231|1234&quot;</span><br></pre></td></tr></table></figure>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/grep2.png" alt=""></p>
<p>1ã€æ˜¾ç¤ºåŒ¹é…çš„ånè¡Œ    grep  -A n<br>2ã€æ˜¾ç¤ºåŒ¹é…çš„å‰nè¡Œ    grep  -B n<br>3ã€æ˜¾ç¤ºåŒ¹é…çš„å‰ånè¡Œ   grep -C n</p>
<p><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/grep3.png" alt=""></p>
<h2 id="pså‘½ä»¤"><a href="#pså‘½ä»¤" class="headerlink" title="pså‘½ä»¤"></a>pså‘½ä»¤</h2><blockquote>
<p>pså‘½ä»¤ç”¨æ¥åˆ—å‡ºç³»ç»Ÿä¸­å½“å‰è¿è¡Œçš„é‚£äº›è¿›ç¨‹ã€‚pså‘½ä»¤åˆ—å‡ºçš„æ˜¯å½“å‰é‚£äº›è¿›ç¨‹çš„å¿«ç…§ï¼Œå°±æ˜¯æ‰§è¡Œpså‘½ä»¤çš„é‚£ä¸ªæ—¶åˆ»çš„é‚£äº›è¿›ç¨‹ï¼Œå¦‚æœæƒ³è¦åŠ¨æ€çš„æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ï¼Œå°±å¯ä»¥ä½¿ç”¨topå‘½ä»¤ã€‚</p>
</blockquote>
<h3 id="å‘½ä»¤å‚æ•°"><a href="#å‘½ä»¤å‚æ•°" class="headerlink" title="å‘½ä»¤å‚æ•°"></a>å‘½ä»¤å‚æ•°</h3><p>a  æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹<br>-a æ˜¾ç¤ºåŒä¸€ç»ˆç«¯ä¸‹çš„æ‰€æœ‰ç¨‹åº<br>-A æ˜¾ç¤ºæ‰€æœ‰è¿›ç¨‹<br>c  æ˜¾ç¤ºè¿›ç¨‹çš„çœŸå®åç§°<br>-N åå‘é€‰æ‹©<br>-e ç­‰äºâ€œ-Aâ€<br>e  æ˜¾ç¤ºç¯å¢ƒå˜é‡<br>f  æ˜¾ç¤ºç¨‹åºé—´çš„å…³ç³»<br>-H æ˜¾ç¤ºæ ‘çŠ¶ç»“æ„<br>r  æ˜¾ç¤ºå½“å‰ç»ˆç«¯çš„è¿›ç¨‹<br>T  æ˜¾ç¤ºå½“å‰ç»ˆç«¯çš„æ‰€æœ‰ç¨‹åº<br>u  æŒ‡å®šç”¨æˆ·çš„æ‰€æœ‰è¿›ç¨‹<br>-au æ˜¾ç¤ºè¾ƒè¯¦ç»†çš„èµ„è®¯<br>-aux æ˜¾ç¤ºæ‰€æœ‰åŒ…å«å…¶ä»–ä½¿ç”¨è€…çš„è¡Œç¨‹<br>-C&lt;å‘½ä»¤&gt; åˆ—å‡ºæŒ‡å®šå‘½ä»¤çš„çŠ¶å†µ<br>â€“lines&lt;è¡Œæ•°&gt; æ¯é¡µæ˜¾ç¤ºçš„è¡Œæ•°<br>â€“width&lt;å­—ç¬¦æ•°&gt; æ¯é¡µæ˜¾ç¤ºçš„å­—ç¬¦æ•°<br>â€“help æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯<br>â€“version æ˜¾ç¤ºç‰ˆæœ¬æ˜¾ç¤º</p>
<h3 id="ä½¿ç”¨åœºæ™¯"><a href="#ä½¿ç”¨åœºæ™¯" class="headerlink" title="ä½¿ç”¨åœºæ™¯"></a>ä½¿ç”¨åœºæ™¯</h3><h4 id="æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯-aux"><a href="#æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯-aux" class="headerlink" title="æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ aux"></a>æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ aux</h4><p>ps aux æ˜¯ç”¨BSDçš„æ ¼å¼æ¥æ˜¾ç¤º javaè¿™ä¸ªè¿›ç¨‹<br>è¾“å‡ºï¼š<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ps1.png" alt=""></p>
<p>æ˜¾ç¤ºçš„é¡¹ç›®æœ‰ï¼šUSER , PID , %CPU , %MEM , VSZ , RSS , TTY , STAT , START , TIME , COMMAND</p>
<p>è¯´æ˜ï¼š<br>USERï¼šè¯¥ process å±äºé‚£ä¸ªä½¿ç”¨è€…è´¦å·çš„<br>PID ï¼šè¯¥ process çš„å·ç <br>%CPUï¼šè¯¥ process ä½¿ç”¨æ‰çš„ CPU èµ„æºç™¾åˆ†æ¯”<br>%MEMï¼šè¯¥ process æ‰€å ç”¨çš„ç‰©ç†å†…å­˜ç™¾åˆ†æ¯”<br>VSZ ï¼šè¯¥ process ä½¿ç”¨æ‰çš„è™šæ‹Ÿå†…å­˜é‡ (Kbytes)<br>RSS ï¼šè¯¥ process å ç”¨çš„å›ºå®šçš„å†…å­˜é‡ (Kbytes)<br>TTY ï¼šè¯¥ process æ˜¯åœ¨é‚£ä¸ªç»ˆç«¯æœºä¸Šé¢è¿ä½œï¼Œè‹¥ä¸ç»ˆç«¯æœºæ— å…³ï¼Œåˆ™æ˜¾ç¤º ?ï¼Œå¦å¤–ï¼Œ tty1-tty6 æ˜¯æœ¬æœºä¸Šé¢çš„ç™»å…¥è€…ç¨‹åºï¼Œè‹¥ä¸º pts/0 ç­‰ç­‰çš„ï¼Œåˆ™è¡¨ç¤ºä¸ºç”±ç½‘ç»œè¿æ¥è¿›ä¸»æœºçš„ç¨‹åºã€‚<br>STATï¼šè¯¥ç¨‹åºç›®å‰çš„çŠ¶æ€ï¼Œä¸»è¦çš„çŠ¶æ€æœ‰<br>R ï¼šè¯¥ç¨‹åºç›®å‰æ­£åœ¨è¿ä½œï¼Œæˆ–è€…æ˜¯å¯è¢«è¿ä½œ<br>S ï¼šè¯¥ç¨‹åºç›®å‰æ­£åœ¨ç¡çœ å½“ä¸­ (å¯è¯´æ˜¯ idle çŠ¶æ€)ï¼Œä½†å¯è¢«æŸäº›è®¯å· (signal) å”¤é†’ã€‚<br>T ï¼šè¯¥ç¨‹åºç›®å‰æ­£åœ¨ä¾¦æµ‹æˆ–è€…æ˜¯åœæ­¢äº†<br>Z ï¼šè¯¥ç¨‹åºåº”è¯¥å·²ç»ç»ˆæ­¢ï¼Œä½†æ˜¯å…¶çˆ¶ç¨‹åºå´æ— æ³•æ­£å¸¸çš„ç»ˆæ­¢ä»–ï¼Œé€ æˆ zombie (ç–†å°¸) ç¨‹åºçš„çŠ¶æ€<br>STARTï¼šè¯¥ process è¢«è§¦å‘å¯åŠ¨çš„æ—¶é—´<br>TIME ï¼šè¯¥ process å®é™…ä½¿ç”¨ CPU è¿ä½œçš„æ—¶é—´<br>COMMANDï¼šè¯¥ç¨‹åºçš„å®é™…æŒ‡ä»¤</p>
<h4 id="æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯-ef"><a href="#æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯-ef" class="headerlink" title="æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ -ef"></a>æ˜¾ç¤ºè¿›ç¨‹ä¿¡æ¯ -ef</h4><p>ps -ef æ˜¯ç”¨æ ‡å‡†çš„æ ¼å¼æ˜¾ç¤ºjavaè¿™ä¸ªè¿›ç¨‹<br>è¾“å‡ºï¼š<br><img src="https://lg-q0k3yx0g-1257042339.cos.ap-shanghai.myqcloud.com/Linux%20%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/ps2.png" alt=""><br>æ˜¾ç¤ºçš„é¡¹ç›®æœ‰ï¼šUID , PID , PPID , C , STIME , TTY , TIME , CMD</p>
]]></content>
      
        <categories>
            
            <category> æŠ€æœ¯ </category>
            
        </categories>
        
        
        <tags>
            
            <tag> å‘½ä»¤ </tag>
            
            <tag> Linux </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
